
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>1.电商用户行为数据分析 · 日常笔记</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="liufeihua">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-chapter-fold/chapter-fold.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-back-to-top-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-tbfed-pagefooter/footer.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-page-treeview/style.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-pageview-count/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-prism/prism-okaidia.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-theme-comscore/test.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    
    <link rel="prev" href="./" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    前言
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../java/">
            
                <a href="../java/">
            
                    
                    java
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../java/4_JVM垃圾回收与调优.html">
            
                <a href="../java/4_JVM垃圾回收与调优.html">
            
                    
                    二级
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1" data-path="../java/1_JVM整体结构介绍.html">
            
                <a href="../java/1_JVM整体结构介绍.html">
            
                    
                    1.JVM整体结构介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2" data-path="../java/2_JVM性能调优监控工具.html">
            
                <a href="../java/2_JVM性能调优监控工具.html">
            
                    
                    2.JVM性能调优监控工具
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.3" data-path="../java/3_JVM垃圾回收与调优.html">
            
                <a href="../java/3_JVM垃圾回收与调优.html">
            
                    
                    3.JVM垃圾回收与调优
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../java/tomcat/4_JVM垃圾回收与调优.html">
            
                <a href="../java/tomcat/4_JVM垃圾回收与调优.html">
            
                    
                    tomcat
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../hadoop/">
            
                <a href="../hadoop/">
            
                    
                    hadoop
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../hadoop/1.集群同步脚本.html">
            
                <a href="../hadoop/1.集群同步脚本.html">
            
                    
                    1.集群同步脚本
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../spark/">
            
                <a href="../spark/">
            
                    
                    spark
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../spark/1.spark安装和使用.html">
            
                <a href="../spark/1.spark安装和使用.html">
            
                    
                    1.spark安装和使用
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="./">
            
                <a href="./">
            
                    
                    flink
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.5.1" data-path="电商用户行为数据分析.html">
            
                <a href="电商用户行为数据分析.html">
            
                    
                    1.电商用户行为数据分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >1.电商用户行为数据分析</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <p><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</p>
<p>&#x7B2C;1&#x7AE0; &#x9879;&#x76EE;&#x6574;&#x4F53;&#x4ECB;&#x7ECD;</p>
<p>1.1 &#x7535;&#x5546;&#x7684;&#x7528;&#x6237;&#x884C;&#x4E3A;</p>
<p>&#x7535;&#x5546;&#x5E73;&#x53F0;&#x4E2D;&#x7684;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x9891;&#x7E41;&#x4E14;&#x8F83;&#x590D;&#x6742;&#xFF0C;&#x7CFB;&#x7EDF;&#x4E0A;&#x7EBF;&#x8FD0;&#x884C;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x6536;&#x96C6;&#x5230;&#x5927;&#x91CF;&#x7684;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x6570;&#x636E;&#xFF0C;&#x8FDB;&#x800C;&#x5229;&#x7528;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x8FDB;&#x884C;&#x6DF1;&#x5165;&#x6316;&#x6398;&#x548C;&#x5206;&#x6790;&#xFF0C;&#x5F97;&#x5230;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x5546;&#x4E1A;&#x6307;&#x6807;&#x5E76;&#x589E;&#x5F3A;&#x5BF9;&#x98CE;&#x9669;&#x7684;&#x63A7;&#x5236;&#x3002;</p>
<p>&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x6570;&#x636E;&#x591A;&#x6837;&#xFF0C;&#x6574;&#x4F53;&#x53EF;&#x4EE5;&#x5206;&#x4E3A;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x4E60;&#x60EF;&#x6570;&#x636E;&#x548C;&#x4E1A;&#x52A1;&#x884C;&#x4E3A;&#x6570;&#x636E;&#x4E24;&#x5927;&#x7C7B;&#x3002;&#x7528;&#x6237;&#x7684;&#x884C;&#x4E3A;&#x4E60;&#x60EF;&#x6570;&#x636E;&#x5305;&#x62EC;&#x4E86;&#x7528;&#x6237;&#x7684;&#x767B;&#x5F55;&#x65B9;&#x5F0F;&#x3001;&#x4E0A;&#x7EBF;&#x7684;&#x65F6;&#x95F4;&#x70B9;&#x53CA;&#x65F6;&#x957F;&#x3001;&#x70B9;&#x51FB;&#x548C;&#x6D4F;&#x89C8;&#x9875;&#x9762;&#x3001;&#x9875;&#x9762;&#x505C;&#x7559;&#x65F6;&#x95F4;&#x4EE5;&#x53CA;&#x9875;&#x9762;&#x8DF3;&#x8F6C;&#x7B49;&#x7B49;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4ECE;&#x4E2D;&#x8FDB;&#x884C;&#x6D41;&#x91CF;&#x7EDF;&#x8BA1;&#x548C;&#x70ED;&#x95E8;&#x5546;&#x54C1;&#x7684;&#x7EDF;&#x8BA1;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x6DF1;&#x5165;&#x6316;&#x6398;&#x7528;&#x6237;&#x7684;&#x7279;&#x5F81;&#xFF1B;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#x5F80;&#x5F80;&#x53EF;&#x4EE5;&#x4ECE;web&#x670D;&#x52A1;&#x5668;&#x65E5;&#x5FD7;&#x4E2D;&#x76F4;&#x63A5;&#x8BFB;&#x53D6;&#x5230;&#x3002;&#x800C;&#x4E1A;&#x52A1;&#x884C;&#x4E3A;&#x6570;&#x636E;&#x5C31;&#x662F;&#x7528;&#x6237;&#x5728;&#x7535;&#x5546;&#x5E73;&#x53F0;&#x4E2D;&#x9488;&#x5BF9;&#x6BCF;&#x4E2A;&#x4E1A;&#x52A1;&#xFF08;&#x901A;&#x5E38;&#x662F;&#x67D0;&#x4E2A;&#x5177;&#x4F53;&#x5546;&#x54C1;&#xFF09;&#x6240;&#x4F5C;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x6211;&#x4EEC;&#x4E00;&#x822C;&#x4F1A;&#x5728;&#x4E1A;&#x52A1;&#x7CFB;&#x7EDF;&#x4E2D;&#x76F8;&#x5E94;&#x7684;&#x4F4D;&#x7F6E;&#x57CB;&#x70B9;&#xFF0C;&#x7136;&#x540E;&#x6536;&#x96C6;&#x65E5;&#x5FD7;&#x8FDB;&#x884C;&#x5206;&#x6790;&#x3002;&#x4E1A;&#x52A1;&#x884C;&#x4E3A;&#x6570;&#x636E;&#x53C8;&#x53EF;&#x4EE5;&#x7B80;&#x5355;&#x5206;&#x4E3A;&#x4E24;&#x7C7B;&#xFF1A;&#x4E00;&#x7C7B;&#x662F;&#x80FD;&#x591F;&#x660E;&#x663E;&#x5730;&#x8868;&#x73B0;&#x51FA;&#x7528;&#x6237;&#x5174;&#x8DA3;&#x7684;&#x884C;&#x4E3A;&#xFF0C;&#x6BD4;&#x5982;&#x5BF9;&#x5546;&#x54C1;&#x7684;&#x6536;&#x85CF;&#x3001;&#x559C;&#x6B22;&#x3001;&#x8BC4;&#x5206;&#x548C;&#x8BC4;&#x4EF7;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4ECE;&#x4E2D;&#x5BF9;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x6DF1;&#x5165;&#x5206;&#x6790;&#xFF0C;&#x5F97;&#x5230;&#x7528;&#x6237;&#x753B;&#x50CF;&#xFF0C;&#x8FDB;&#x800C;&#x5BF9;&#x7528;&#x6237;&#x7ED9;&#x51FA;&#x4E2A;&#x6027;&#x5316;&#x7684;&#x63A8;&#x8350;&#x5546;&#x54C1;&#x5217;&#x8868;&#xFF0C;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x5F80;&#x5F80;&#x4F1A;&#x7528;&#x5230;&#x673A;&#x5668;&#x5B66;&#x4E60;&#x76F8;&#x5173;&#x7684;&#x7B97;&#x6CD5;&#xFF1B;&#x53E6;&#x4E00;&#x7C7B;&#x5219;&#x662F;&#x5E38;&#x89C4;&#x7684;&#x4E1A;&#x52A1;&#x64CD;&#x4F5C;&#xFF0C;&#x4F46;&#x9700;&#x8981;&#x7740;&#x91CD;&#x5173;&#x6CE8;&#x4E00;&#x4E9B;&#x5F02;&#x5E38;&#x72B6;&#x51B5;&#x4EE5;&#x505A;&#x597D;&#x98CE;&#x63A7;&#xFF0C;&#x6BD4;&#x5982;&#x767B;&#x5F55;&#x548C;&#x8BA2;&#x5355;&#x652F;&#x4ED8;&#x3002;</p>
<p><img src="https://uploader.shimo.im/f/QChguu3f7Pqs3Q5G.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/aNwLtYWJPTQSPOEZ.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong>1.2&#x9879;&#x76EE;&#x4E3B;&#x8981;&#x6A21;&#x5757;</p>
<p>&#x57FA;&#x4E8E;&#x5BF9;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x6570;&#x636E;&#x7684;&#x57FA;&#x672C;&#x5206;&#x7C7B;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#x4E3B;&#x8981;&#x6709;&#x4EE5;&#x4E0B;&#x4E09;&#x4E2A;&#x5206;&#x6790;&#x65B9;&#x5411;&#xFF1A;</p>
<ol>
<li>&#x70ED;&#x95E8;&#x7EDF;&#x8BA1;</li>
</ol>
<p>&#x5229;&#x7528;&#x7528;&#x6237;&#x7684;&#x70B9;&#x51FB;&#x6D4F;&#x89C8;&#x884C;&#x4E3A;&#xFF0C;&#x8FDB;&#x884C;&#x6D41;&#x91CF;&#x7EDF;&#x8BA1;&#x3001;&#x8FD1;&#x671F;&#x70ED;&#x95E8;&#x5546;&#x54C1;&#x7EDF;&#x8BA1;&#x7B49;&#x3002;</p>
<pre class="language-"><code>2. &#x504F;&#x597D;&#x7EDF;&#x8BA1;
</code></pre><ul>
<li>&#x7528;&#x7528;&#x6237;&#x7684;&#x504F;&#x597D;&#x884C;&#x4E3A;&#xFF0C;&#x6BD4;&#x5982;&#x6536;&#x85CF;&#x3001;&#x559C;&#x6B22;&#x3001;&#x8BC4;&#x5206;&#x7B49;&#xFF0C;&#x8FDB;&#x884C;&#x7528;&#x6237;&#x753B;&#x50CF;&#x5206;&#x6790;&#xFF0C;&#x7ED9;&#x51FA;&#x4E2A;&#x6027;&#x5316;&#x7684;&#x5546;&#x54C1;&#x63A8;&#x8350;&#x5217;&#x8868;&#x3002;<ol>
<li>&#x98CE;&#x9669;&#x63A7;&#x5236;</li>
</ol>
</li>
<li>&#x7528;&#x7528;&#x6237;&#x7684;&#x5E38;&#x89C4;&#x4E1A;&#x52A1;&#x884C;&#x4E3A;&#xFF0C;&#x6BD4;&#x5982;&#x767B;&#x5F55;&#x3001;&#x4E0B;&#x5355;&#x3001;&#x652F;&#x4ED8;&#x7B49;&#xFF0C;&#x5206;&#x6790;&#x6570;&#x636E;&#xFF0C;&#x5BF9;&#x5F02;&#x5E38;&#x60C5;&#x51B5;&#x8FDB;&#x884C;&#x62A5;&#x8B66;&#x63D0;&#x793A;&#x3002;</li>
</ul>
<p>&#x672C;&#x9879;&#x76EE;&#x9650;&#x4E8E;&#x6570;&#x636E;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x5B9E;&#x73B0;&#x70ED;&#x95E8;&#x7EDF;&#x8BA1;&#x548C;&#x98CE;&#x9669;&#x63A7;&#x5236;&#x4E2D;&#x7684;&#x90E8;&#x5206;&#x5185;&#x5BB9;&#xFF0C;&#x5C06;&#x5305;&#x62EC;&#x4EE5;&#x4E0B;&#x56DB;&#x5927;&#x6A21;&#x5757;&#xFF1A;&#x5B9E;&#x65F6;&#x70ED;&#x95E8;&#x5546;&#x54C1;&#x7EDF;&#x8BA1;&#x3001;&#x5B9E;&#x65F6;&#x6D41;&#x91CF;&#x7EDF;&#x8BA1;&#x3001;&#x6076;&#x610F;&#x767B;&#x5F55;&#x76D1;&#x63A7;&#x548C;&#x8BA2;&#x5355;&#x652F;&#x4ED8;&#x5931;&#x6548;&#x76D1;&#x63A7;&#x3002;</p>
<p><img src="https://uploader.shimo.im/f/sRla8ahSD69rbeyu.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p>&#x7531;&#x4E8E;&#x5BF9;&#x5B9E;&#x65F6;&#x6027;&#x8981;&#x6C42;&#x8F83;&#x9AD8;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x7528;flink&#x4F5C;&#x4E3A;&#x6570;&#x636E;&#x5904;&#x7406;&#x7684;&#x6846;&#x67B6;&#x3002;&#x5728;&#x9879;&#x76EE;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x7EFC;&#x5408;&#x8FD0;&#x7528;flink&#x7684;&#x5404;&#x79CD;API&#xFF0C;&#x57FA;&#x4E8E;EventTime&#x53BB;&#x5904;&#x7406;&#x57FA;&#x672C;&#x7684;&#x4E1A;&#x52A1;&#x9700;&#x6C42;&#xFF0C;&#x5E76;&#x4E14;&#x7075;&#x6D3B;&#x5730;&#x4F7F;&#x7528;&#x5E95;&#x5C42;&#x7684;processFunction&#xFF0C;&#x57FA;&#x4E8E;&#x72B6;&#x6001;&#x7F16;&#x7A0B;&#x548C;CEP&#x53BB;&#x5904;&#x7406;&#x66F4;&#x52A0;&#x590D;&#x6742;&#x7684;&#x60C5;&#x5F62;&#x3002;</p>
<p>1.3&#x6570;&#x636E;&#x6E90;&#x89E3;&#x6790;</p>
<p>&#x6211;&#x4EEC;&#x51C6;&#x5907;&#x4E86;&#x4E00;&#x4EFD;&#x6DD8;&#x5B9D;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x6570;&#x636E;&#x96C6;&#xFF0C;&#x4FDD;&#x5B58;&#x4E3A;csv&#x6587;&#x4EF6;&#x3002;&#x672C;&#x6570;&#x636E;&#x96C6;&#x5305;&#x542B;&#x4E86;&#x6DD8;&#x5B9D;&#x4E0A;&#x67D0;&#x4E00;&#x5929;&#x968F;&#x673A;&#x4E00;&#x767E;&#x4E07;&#x7528;&#x6237;&#x7684;&#x6240;&#x6709;&#x884C;&#x4E3A;&#xFF08;&#x5305;&#x62EC;&#x70B9;&#x51FB;&#x3001;&#x8D2D;&#x4E70;&#x3001;&#x6536;&#x85CF;&#x3001;&#x559C;&#x6B22;&#xFF09;&#x3002;&#x6570;&#x636E;&#x96C6;&#x7684;&#x6BCF;&#x4E00;&#x884C;&#x8868;&#x793A;&#x4E00;&#x6761;&#x7528;&#x6237;&#x884C;&#x4E3A;&#xFF0C;&#x7531;&#x7528;&#x6237;ID&#x3001;&#x5546;&#x54C1;ID&#x3001;&#x5546;&#x54C1;&#x7C7B;&#x76EE;ID&#x3001;&#x884C;&#x4E3A;&#x7C7B;&#x578B;&#x548C;&#x65F6;&#x95F4;&#x6233;&#x7EC4;&#x6210;&#xFF0C;&#x5E76;&#x4EE5;&#x9017;&#x53F7;&#x5206;&#x9694;&#x3002;&#x5173;&#x4E8E;&#x6570;&#x636E;&#x96C6;&#x4E2D;&#x6BCF;&#x4E00;&#x5217;&#x7684;&#x8BE6;&#x7EC6;&#x63CF;&#x8FF0;&#x5982;&#x4E0B;&#xFF1A;</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/dqzLZOuvJ1toy1nj.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p>&#x53E6;&#x5916;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x62FF;&#x5230;web&#x670D;&#x52A1;&#x5668;&#x7684;&#x65E5;&#x5FD7;&#x6570;&#x636E;&#xFF0C;&#x8FD9;&#x91CC;&#x4EE5;apache&#x670D;&#x52A1;&#x5668;&#x7684;&#x4E00;&#x4EFD;log&#x4E3A;&#x4F8B;&#xFF0C;&#x6BCF;&#x4E00;&#x884C;&#x65E5;&#x5FD7;&#x8BB0;&#x5F55;&#x4E86;&#x8BBF;&#x95EE;&#x8005;&#x7684;IP&#x3001;userId&#x3001;&#x8BBF;&#x95EE;&#x65F6;&#x95F4;&#x3001;&#x8BBF;&#x95EE;&#x65B9;&#x6CD5;&#x4EE5;&#x53CA;&#x8BBF;&#x95EE;&#x7684;url&#xFF0C;&#x5177;&#x4F53;&#x63CF;&#x8FF0;&#x5982;&#x4E0B;&#xFF1A;</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/SYHWmIGf3pWo39do.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p>&#x7531;&#x4E8E;&#x884C;&#x4E3A;&#x6570;&#x636E;&#x6709;&#x9650;&#xFF0C;&#x5728;&#x5B9E;&#x65F6;&#x70ED;&#x95E8;&#x5546;&#x54C1;&#x7EDF;&#x8BA1;&#x6A21;&#x5757;&#x4E2D;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;UserBehavior&#x6570;&#x636E;&#x96C6;&#xFF0C;&#x800C;&#x5BF9;&#x4E8E;&#x6076;&#x610F;&#x767B;&#x5F55;&#x76D1;&#x63A7;&#x548C;&#x8BA2;&#x5355;&#x652F;&#x4ED8;&#x5931;&#x6548;&#x76D1;&#x63A7;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x4EE5;&#x793A;&#x4F8B;&#x6570;&#x636E;&#x6765;&#x505A;&#x6F14;&#x793A;&#x3002;</p>
<p>&#x7B2C;2&#x7AE0; &#x5B9E;&#x65F6;&#x70ED;&#x95E8;&#x5546;&#x54C1;&#x7EDF;&#x8BA1;</p>
<p>&#x9996;&#x5148;&#x8981;&#x5B9E;&#x73B0;&#x7684;&#x662F;&#x5B9E;&#x65F6;&#x70ED;&#x95E8;&#x5546;&#x54C1;&#x7EDF;&#x8BA1;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x4F1A;&#x57FA;&#x4E8E;UserBehavior&#x6570;&#x636E;&#x96C6;&#x6765;&#x8FDB;&#x884C;&#x5206;&#x6790;&#x3002;</p>
<p>&#x9879;&#x76EE;&#x4E3B;&#x4F53;&#x7528;Scala&#x7F16;&#x5199;&#xFF0C;&#x91C7;&#x7528;IDEA&#x4F5C;&#x4E3A;&#x5F00;&#x53D1;&#x73AF;&#x5883;&#x8FDB;&#x884C;&#x9879;&#x76EE;&#x7F16;&#x5199;&#xFF0C;&#x91C7;&#x7528;maven&#x4F5C;&#x4E3A;&#x9879;&#x76EE;&#x6784;&#x5EFA;&#x548C;&#x7BA1;&#x7406;&#x5DE5;&#x5177;&#x3002;&#x9996;&#x5148;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x642D;&#x5EFA;&#x9879;&#x76EE;&#x6846;&#x67B6;&#x3002;</p>
<p>2.1&#x521B;&#x5EFA;Maven&#x9879;&#x76EE;</p>
<p><strong>2.1.1**</strong>&#x9879;&#x76EE;&#x6846;&#x67B6;&#x642D;&#x5EFA;**</p>
<p>&#x6253;&#x5F00;IDEA&#xFF0C;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;maven&#x9879;&#x76EE;&#xFF0C;&#x547D;&#x540D;&#x4E3A;UserBehaviorAnalysis&#x3002;&#x7531;&#x4E8E;&#x5305;&#x542B;&#x4E86;&#x591A;&#x4E2A;&#x6A21;&#x5757;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4EE5;UserBehaviorAnalysis&#x4F5C;&#x4E3A;&#x7236;&#x9879;&#x76EE;&#xFF0C;&#x5E76;&#x5728;&#x5176;&#x4E0B;&#x5EFA;&#x4E00;&#x4E2A;&#x540D;&#x4E3A;HotItemsAnalysis&#x7684;&#x5B50;&#x9879;&#x76EE;&#xFF0C;&#x7528;&#x4E8E;&#x5B9E;&#x65F6;&#x7EDF;&#x8BA1;&#x70ED;&#x95E8;top N&#x5546;&#x54C1;&#x3002;</p>
<p>&#x5728;UserBehaviorAnalysis&#x4E0B;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;maven module&#x4F5C;&#x4E3A;&#x5B50;&#x9879;&#x76EE;&#xFF0C;&#x547D;&#x540D;&#x4E3A;HotItemsAnalysis&#x3002;</p>
<p>&#x7236;&#x9879;&#x76EE;&#x53EA;&#x662F;&#x4E3A;&#x4E86;&#x89C4;&#x8303;&#x5316;&#x9879;&#x76EE;&#x7ED3;&#x6784;&#xFF0C;&#x65B9;&#x4FBF;&#x4F9D;&#x8D56;&#x7BA1;&#x7406;&#xFF0C;&#x672C;&#x8EAB;&#x662F;&#x4E0D;&#x9700;&#x8981;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x6240;&#x4EE5;UserBehaviorAnalysis&#x4E0B;&#x7684;src&#x6587;&#x4EF6;&#x5939;&#x53EF;&#x4EE5;&#x5220;&#x6389;&#x3002;</p>
<p><strong>2.1.2**</strong>&#x58F0;&#x660E;&#x9879;&#x76EE;&#x4E2D;&#x5DE5;&#x5177;&#x7684;&#x7248;&#x672C;&#x4FE1;&#x606F;**</p>
<p>&#x6211;&#x4EEC;&#x6574;&#x4E2A;&#x9879;&#x76EE;&#x9700;&#x8981;&#x7684;&#x5DE5;&#x5177;&#x7684;&#x4E0D;&#x540C;&#x7248;&#x672C;&#x53EF;&#x80FD;&#x4F1A;&#x5BF9;&#x7A0B;&#x5E8F;&#x8FD0;&#x884C;&#x9020;&#x6210;&#x5F71;&#x54CD;&#xFF0C;&#x6240;&#x4EE5;&#x5E94;&#x8BE5;&#x5728;&#x6700;&#x5916;&#x5C42;&#x7684;UserBehaviorAnalysis&#x4E2D;&#x58F0;&#x660E;&#x6240;&#x6709;&#x5B50;&#x6A21;&#x5757;&#x5171;&#x7528;&#x7684;&#x7248;&#x672C;&#x4FE1;&#x606F;&#x3002;</p>
<p>&#x5728;pom.xml&#x4E2D;&#x52A0;&#x5165;&#x4EE5;&#x4E0B;&#x914D;&#x7F6E;&#xFF1A;</p>
<p><em>UserBehaviorAnalysis/pom.xml</em></p>
<p>&lt;<strong>properties</strong>&gt;</p>
<p>&lt;<strong>flink.version</strong>&gt;1.7.2&lt;/<strong>flink.version</strong>&gt;</p>
<p>&lt;<strong>scala.binary.version</strong>&gt;2.11&lt;/<strong>scala.binary.version</strong>&gt;</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/CTIftlZ5m7mfcNAl.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p>&lt;<strong>kafka.version</strong>&gt;2.2.0&lt;/<strong>kafka.version</strong>&gt;</p>
<p>&lt;/<strong>properties</strong>&gt;</p>
<p><strong>2.1.3**</strong>&#x6DFB;&#x52A0;&#x9879;&#x76EE;&#x4F9D;&#x8D56;**</p>
<p>&#x5BF9;&#x4E8E;&#x6574;&#x4E2A;&#x9879;&#x76EE;&#x800C;&#x8A00;&#xFF0C;&#x6240;&#x6709;&#x6A21;&#x5757;&#x90FD;&#x4F1A;&#x7528;&#x5230;flink&#x76F8;&#x5173;&#x7684;&#x7EC4;&#x4EF6;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5728;</p>
<p>UserBehaviorAnalysis&#x4E2D;&#x5F15;&#x5165;&#x516C;&#x6709;&#x4F9D;&#x8D56;&#xFF1A;</p>
<p><em>UserBehaviorAnalysis/pom.xml</em></p>
<p>&lt;<strong>dependencies</strong>&gt;</p>
<p>&lt;<strong>dependency</strong>&gt;</p>
<p>&lt;<strong>groupId</strong>&gt;org.apache.flink&lt;/<strong>groupId</strong>&gt;</p>
<p>&lt;<strong>artifactId</strong>&gt;flink-scala_${scala.binary.version}&lt;/<strong>artifactId</strong>&gt;</p>
<p>&lt;<strong>version</strong>&gt;${flink.version}&lt;/<strong>version</strong>&gt;</p>
<p>&lt;/<strong>dependency</strong>&gt;</p>
<p>&lt;<strong>dependency</strong>&gt;</p>
<p>&lt;<strong>groupId</strong>&gt;org.apache.flink&lt;/<strong>groupId</strong>&gt;</p>
<p>&lt;<strong>artifactId</strong>&gt;flink-streaming-scala_${scala.binary.version}&lt;/<strong>artifactId</strong>&gt;</p>
<p>&lt;<strong>version</strong>&gt;${flink.version}&lt;/<strong>version</strong>&gt;</p>
<p>&lt;/<strong>dependency</strong>&gt;</p>
<p>&lt;<strong>dependency</strong>&gt;</p>
<p>&lt;<strong>groupId</strong>&gt;org.apache.kafka&lt;/<strong>groupId</strong>&gt;</p>
<p>&lt;<strong>artifactId</strong>&gt;kafka_${scala.binary.version}&lt;/<strong>artifactId</strong>&gt;</p>
<p>&lt;<strong>version</strong>&gt;${kafka.version}&lt;/<strong>version</strong>&gt;</p>
<p>&lt;/<strong>dependency</strong>&gt;</p>
<p>&lt;<strong>dependency</strong>&gt;</p>
<p>&lt;<strong>groupId</strong>&gt;org.apache.flink&lt;/<strong>groupId</strong>&gt;</p>
<p>&lt;<strong>artifactId</strong>&gt;flink-connector-kafka_${scala.binary.version}&lt;/<strong>artifactId</strong>&gt;</p>
<p>&lt;<strong>version</strong>&gt;${flink.version}&lt;/<strong>version</strong>&gt;</p>
<p>&lt;/<strong>dependency</strong>&gt;</p>
<p>&lt;/<strong>dependencies</strong>&gt;</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/egjrnvKmcH7qC7Bd.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p>&#x540C;&#x6837;&#xFF0C;&#x5BF9;&#x4E8E;maven&#x9879;&#x76EE;&#x7684;&#x6784;&#x5EFA;&#xFF0C;&#x53EF;&#x4EE5;&#x5F15;&#x5165;&#x516C;&#x6709;&#x7684;&#x63D2;&#x4EF6;&#xFF1A;</p>
<p>&lt;<strong>build</strong>&gt;</p>
<p>&lt;<strong>plugins</strong>&gt;</p>
<p><em><!--**该插件用于将**Scala**代码编译成**class**文件**--></em></p>
<p>&lt;<strong>plugin</strong>&gt;</p>
<p>&lt;<strong>groupId</strong>&gt;net.alchim31.maven&lt;/<strong>groupId</strong>&gt;</p>
<p>&lt;<strong>artifactId</strong>&gt;scala-maven-plugin&lt;/<strong>artifactId</strong>&gt;</p>
<p>&lt;<strong>version</strong>&gt;3.4.6&lt;/<strong>version</strong>&gt;</p>
<p>&lt;<strong>executions</strong>&gt;</p>
<p>&lt;<strong>execution</strong>&gt;</p>
<p><em><!--**声明绑定到**maven**的**compile**阶段**--></em></p>
<p>&lt;<strong>goals</strong>&gt;</p>
<p>&lt;<strong>goal</strong>&gt;testCompile&lt;/<strong>goal</strong>&gt;</p>
<p>&lt;/<strong>goals</strong>&gt;</p>
<p>&lt;/<strong>execution</strong>&gt;</p>
<p>&lt;/<strong>executions</strong>&gt;</p>
<p>&lt;/<strong>plugin</strong>&gt;</p>
<p>&lt;<strong>plugin</strong>&gt;</p>
<p>&lt;<strong>groupId</strong>&gt;org.apache.maven.plugins&lt;/<strong>groupId</strong>&gt;</p>
<p>&lt;<strong>artifactId</strong>&gt;maven-assembly-plugin&lt;/<strong>artifactId</strong>&gt;</p>
<p>&lt;<strong>version</strong>&gt;3.0.0&lt;/<strong>version</strong>&gt;</p>
<p>&lt;<strong>configuration</strong>&gt;</p>
<p>&lt;<strong>descriptorRefs</strong>&gt;</p>
<p>&lt;<strong>descriptorRef</strong>&gt;</p>
<p>jar-with-dependencies</p>
<p>&lt;/<strong>descriptorRef</strong>&gt;</p>
<p>&lt;/<strong>descriptorRefs</strong>&gt;</p>
<p>&lt;/<strong>configuration</strong>&gt;</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/AiHRpwhZdM3hz1mT.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p>&lt;<strong>executions</strong>&gt;</p>
<p>&lt;<strong>execution</strong>&gt;</p>
<p>&lt;<strong>id</strong>&gt;make-assembly&lt;/<strong>id</strong>&gt;</p>
<p>&lt;<strong>phase</strong>&gt;package&lt;/<strong>phase</strong>&gt;</p>
<p>&lt;<strong>goals</strong>&gt;</p>
<p>&lt;<strong>goal</strong>&gt;single&lt;/<strong>goal</strong>&gt;</p>
<p>&lt;/<strong>goals</strong>&gt;</p>
<p>&lt;/<strong>execution</strong>&gt;</p>
<p>&lt;/<strong>executions</strong>&gt;</p>
<p>&lt;/<strong>plugin</strong>&gt;</p>
<p>&lt;/<strong>plugins</strong>&gt;</p>
<p>&lt;/<strong>build</strong>&gt;</p>
<p>&#x5728;HotItemsAnalysis&#x5B50;&#x6A21;&#x5757;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5E76;&#x6CA1;&#x6709;&#x5F15;&#x5165;&#x66F4;&#x591A;&#x7684;&#x4F9D;&#x8D56;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x9700;&#x8981;&#x6539;&#x52A8;pom&#x6587;&#x4EF6;&#x3002;</p>
<p><strong>2.1.4**</strong>&#x6570;&#x636E;&#x51C6;&#x5907;**</p>
<ul>
<li>src/main/&#x76EE;&#x5F55;&#x4E0B;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5DF2;&#x6709;&#x7684;&#x9ED8;&#x8BA4;&#x6E90;&#x6587;&#x4EF6;&#x76EE;&#x5F55;&#x662F;java&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5C06;&#x5176;&#x6539;&#x540D;&#x4E3A;scala&#x3002;&#x5C06;&#x6570;&#x636E;&#x6587;&#x4EF6;UserBehavior.csv&#x590D;&#x5236;&#x5230;&#x8D44;&#x6E90;&#x6587;&#x4EF6;&#x76EE;&#x5F55;src/main/resources&#x4E0B;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x4ECE;&#x8FD9;&#x91CC;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#x3002;</li>
</ul>
<p>&#x81F3;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x51C6;&#x5907;&#x5DE5;&#x4F5C;&#x90FD;&#x5DF2;&#x5B8C;&#x6210;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x53EF;&#x4EE5;&#x5199;&#x4EE3;&#x7801;&#x4E86;&#x3002;</p>
<p>2.2&#x6A21;&#x5757;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;</p>
<p>&#x6211;&#x4EEC;&#x5C06;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x201C;&#x5B9E;&#x65F6;&#x70ED;&#x95E8;&#x5546;&#x54C1;&#x201D;&#x7684;&#x9700;&#x6C42;&#xFF0C;&#x53EF;&#x4EE5;&#x5C06;&#x201C;&#x5B9E;&#x65F6;&#x70ED;&#x95E8;&#x5546;&#x54C1;&#x201D;&#x7FFB;&#x8BD1;&#x6210;&#x7A0B;&#x5E8F;&#x5458;&#x66F4;&#x597D;&#x7406;&#x89E3;&#x7684;&#x9700;&#x6C42;&#xFF1A;&#x6BCF;&#x9694;5&#x5206;&#x949F;&#x8F93;&#x51FA;&#x6700;&#x8FD1;&#x4E00;&#x5C0F;&#x65F6;&#x5185;&#x70B9;&#x51FB;&#x91CF;&#x6700;&#x591A;&#x7684;&#x524D;N&#x4E2A;&#x5546;&#x54C1;&#x3002;&#x5C06;&#x8FD9;&#x4E2A;&#x9700;&#x6C42;&#x8FDB;&#x884C;&#x5206;&#x89E3;&#x6211;&#x4EEC;&#x5927;&#x6982;&#x8981;&#x505A;&#x8FD9;&#x4E48;&#x51E0;&#x4EF6;&#x4E8B;&#x60C5;&#xFF1A;</p>
<ul>
<li>&#x62BD;&#x53D6;&#x51FA;&#x4E1A;&#x52A1;&#x65F6;&#x95F4;&#x6233;&#xFF0C;&#x544A;&#x8BC9;Flink&#x6846;&#x67B6;&#x57FA;&#x4E8E;&#x4E1A;&#x52A1;&#x65F6;&#x95F4;&#x505A;&#x7A97;&#x53E3;</li>
<li>&#x8FC7;&#x6EE4;&#x51FA;&#x70B9;&#x51FB;&#x884C;&#x4E3A;&#x6570;&#x636E;</li>
<li>&#x6309;&#x4E00;&#x5C0F;&#x65F6;&#x7684;&#x7A97;&#x53E3;&#x5927;&#x5C0F;&#xFF0C;&#x6BCF;5&#x5206;&#x949F;&#x7EDF;&#x8BA1;&#x4E00;&#x6B21;&#xFF0C;&#x505A;&#x6ED1;&#x52A8;&#x7A97;&#x53E3;&#x805A;&#x5408;&#xFF08;Sliding Window&#xFF09;</li>
<li>&#x6309;&#x6BCF;&#x4E2A;&#x7A97;&#x53E3;&#x805A;&#x5408;&#xFF0C;&#x8F93;&#x51FA;&#x6BCF;&#x4E2A;&#x7A97;&#x53E3;&#x4E2D;&#x70B9;&#x51FB;&#x91CF;&#x524D;N&#x540D;&#x7684;&#x5546;&#x54C1;</li>
</ul>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/aJaNXBy3JsR0WtM0.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><strong>2.2.1**</strong>&#x7A0B;&#x5E8F;&#x4E3B;&#x4F53;**</p>
<ul>
<li>src/main/scala&#x4E0B;&#x521B;&#x5EFA;HotItems.scala&#x6587;&#x4EF6;&#xFF0C;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#x5355;&#x4F8B;&#x5BF9;&#x8C61;&#x3002;&#x5B9A;&#x4E49;&#x6837;&#x4F8B;&#x7C7B;</li>
</ul>
<p>UserBehavior&#x548C;ItemViewCount&#xFF0C;&#x5728;main&#x51FD;&#x6570;&#x4E2D;&#x521B;&#x5EFA;StreamExecutionEnvironment&#x5E76;</p>
<p>&#x505A;&#x914D;&#x7F6E;&#xFF0C;&#x7136;&#x540E;&#x4ECE;UserBehavior.csv&#x6587;&#x4EF6;&#x4E2D;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#xFF0C;&#x5E76;&#x5305;&#x88C5;&#x6210;UserBehavior&#x7C7B;&#x578B;&#x3002;</p>
<p>&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><em>HotItemsAnalysis/src/main/scala/HotItems.scala</em></p>
<p><img src="https://uploader.shimo.im/f/kcqbSbufXezRVVT9.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p><strong>case class</strong>UserBehavior(userId: Long, itemId: Long, categoryId: Int, behavior:<em>**</em>String,</p>
<p>timestamp: Long)</p>
<p><strong>case class</strong>ItemViewCount(itemId: Long, windowEnd: Long, count: Long)</p>
<p><strong>object</strong>HotItems {</p>
<p><strong>def</strong>main(args: Array[String]): Unit = {</p>
<p><em>//<strong>&#x521B;&#x5EFA;&#x4E00;&#x4E2A;</strong>StreamExecutionEnvironment</em></p>
<p><strong>val</strong>env = StreamExecutionEnvironment.<em>getExecutionEnvironment</em></p>
<p><em>//<strong>&#x8BBE;&#x5B9A;</strong>Time<strong>&#x7C7B;&#x578B;&#x4E3A;</strong>EventTime</em></p>
<p>env.setStreamTimeCharacteristic(TimeCharacteristic.<em>EventTime</em>)</p>
<ul>
<li><em>&#x4E3A;&#x4E86;&#x6253;&#x5370;&#x5230;&#x63A7;&#x5236;&#x53F0;&#x7684;&#x7ED3;&#x679C;&#x4E0D;&#x4E71;&#x5E8F;&#xFF0C;&#x6211;&#x4EEC;&#x914D;&#x7F6E;&#x5168;&#x5C40;&#x7684;&#x5E76;&#x53D1;&#x4E3A;<strong>1</strong>&#xFF0C;&#x8FD9;&#x91CC;&#x6539;&#x53D8;&#x5E76;&#x53D1;&#x5BF9;&#x7ED3;&#x679C;&#x6B63;&#x786E;&#x6027;&#x6CA1;&#x6709;&#x5F71;&#x54CD;</em></li>
</ul>
<p>env.setParallelism(1)</p>
<p><strong>val</strong>stream = env</p>
<ul>
<li><em>&#x4EE5;<strong>window</strong>&#x4E0B;&#x4E3A;&#x4F8B;&#xFF0C;&#x9700;&#x66FF;&#x6362;&#x6210;&#x81EA;&#x5DF1;&#x7684;&#x8DEF;&#x5F84;</em></li>
</ul>
<p>.readTextFile(<strong>&quot;YOUR_PATH**</strong>\<strong><strong>resources</strong></strong>\<strong>**UserBehavior.csv&quot;</strong>)</p>
<p>.map(line =&gt; {</p>
<p><strong>val</strong>linearray = line.split(<strong>&quot;,&quot;</strong>)</p>
<p><em>UserBehavior</em>(linearray(0).toLong, linearray(1).toLong, linearray(2).toInt,**linearray(3), linearray(4).toLong)</p>
<p>})</p>
<p><em>//<strong>&#x6307;&#x5B9A;&#x65F6;&#x95F4;&#x6233;&#x548C;</strong>watermark</em></p>
<p>.assignAscendingTimestamps(_.timestamp *1000)</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/hmWfbPqfLrObBk6Z.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><img src="https://uploader.shimo.im/f/RWWnWNN11LHhdbsE.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p>env.execute(<strong>&quot;Hot Items Job&quot;</strong>)</p>
<p>}</p>
<p>&#x8FD9;&#x91CC;&#x6CE8;&#x610F;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x7EDF;&#x8BA1;&#x4E1A;&#x52A1;&#x65F6;&#x95F4;&#x4E0A;&#x7684;&#x6BCF;&#x5C0F;&#x65F6;&#x7684;&#x70B9;&#x51FB;&#x91CF;&#xFF0C;&#x6240;&#x4EE5;&#x8981;&#x57FA;&#x4E8E;EventTime&#x6765;&#x5904;&#x7406;&#x3002;&#x90A3;&#x4E48;&#x5982;&#x679C;&#x8BA9;Flink&#x6309;&#x7167;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x7684;&#x4E1A;&#x52A1;&#x65F6;&#x95F4;&#x6765;&#x5904;&#x7406;&#x5462;&#xFF1F;&#x8FD9;&#x91CC;&#x4E3B;&#x8981;&#x6709;&#x4E24;&#x4EF6;&#x4E8B;&#x60C5;&#x8981;&#x505A;&#x3002;</p>
<p>&#x7B2C;&#x4E00;&#x4EF6;&#x662F;&#x544A;&#x8BC9;Flink&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x6309;&#x7167;EventTime&#x6A21;&#x5F0F;&#x8FDB;&#x884C;&#x5904;&#x7406;&#xFF0C;Flink&#x9ED8;&#x8BA4;&#x4F7F;&#x7528;ProcessingTime&#x5904;&#x7406;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x8981;&#x663E;&#x5F0F;&#x8BBE;&#x7F6E;&#x5982;&#x4E0B;&#xFF1A;env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime);</p>
<p>&#x7B2C;&#x4E8C;&#x4EF6;&#x4E8B;&#x60C5;&#x662F;&#x6307;&#x5B9A;&#x5982;&#x4F55;&#x83B7;&#x5F97;&#x4E1A;&#x52A1;&#x65F6;&#x95F4;&#xFF0C;&#x4EE5;&#x53CA;&#x751F;&#x6210;Watermark&#x3002;Watermark&#x662F;&#x7528;&#x6765;&#x8FFD;&#x8E2A;&#x4E1A;&#x52A1;&#x4E8B;&#x4EF6;&#x7684;&#x6982;&#x5FF5;&#xFF0C;&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x6210;EventTime&#x4E16;&#x754C;&#x4E2D;&#x7684;&#x65F6;&#x949F;&#xFF0C;&#x7528;&#x6765;&#x6307;&#x793A;&#x5F53;&#x524D;&#x5904;&#x7406;&#x5230;&#x4EC0;&#x4E48;&#x65F6;&#x523B;&#x7684;&#x6570;&#x636E;&#x4E86;&#x3002;&#x7531;&#x4E8E;&#x6211;&#x4EEC;&#x7684;&#x6570;&#x636E;&#x6E90;&#x7684;&#x6570;&#x636E;&#x5DF2;&#x7ECF;&#x7ECF;&#x8FC7;&#x6574;&#x7406;&#xFF0C;&#x6CA1;&#x6709;&#x4E71;&#x5E8F;&#xFF0C;&#x5373;&#x4E8B;&#x4EF6;&#x7684;&#x65F6;&#x95F4;&#x6233;&#x662F;&#x5355;&#x8C03;&#x9012;&#x589E;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x5C06;&#x6BCF;&#x6761;&#x6570;&#x636E;&#x7684;&#x4E1A;&#x52A1;&#x65F6;&#x95F4;&#x5C31;&#x5F53;&#x505A;Watermark&#x3002;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x7528;assignAscendingTimestamps&#x6765;&#x5B9E;&#x73B0;&#x65F6;&#x95F4;&#x6233;&#x7684;&#x62BD;&#x53D6;&#x548C;Watermark&#x7684;&#x751F;&#x6210;&#x3002;</p>
<p><em>&#x6CE8;&#xFF1A;&#x771F;&#x5B9E;&#x4E1A;&#x52A1;&#x573A;&#x666F;&#x4E00;&#x822C;&#x90FD;&#x662F;&#x4E71;&#x5E8F;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x4E00;&#x822C;&#x4E0D;&#x7528;<strong>assignAscendingTimestamps</strong>&#xFF0C;</em>&#x800C;&#x662F;<em>&#x4F7F;&#x7528;<strong>BoundedOutOfOrdernessTimestampExtractor</strong>&#x3002;</em></p>
<p>.assignAscendingTimestamps(_.timestamp*1000)</p>
<p>&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x5C31;&#x5F97;&#x5230;&#x4E86;&#x4E00;&#x4E2A;&#x5E26;&#x6709;&#x65F6;&#x95F4;&#x6807;&#x8BB0;&#x7684;&#x6570;&#x636E;&#x6D41;&#x4E86;&#xFF0C;&#x540E;&#x9762;&#x5C31;&#x80FD;&#x505A;&#x4E00;&#x4E9B;&#x7A97;&#x53E3;&#x7684;&#x64CD;&#x4F5C;&#x3002;</p>
<p><strong>2.2.2**</strong>&#x8FC7;&#x6EE4;&#x51FA;&#x70B9;&#x51FB;&#x4E8B;&#x4EF6;**</p>
<p>&#x5728;&#x5F00;&#x59CB;&#x7A97;&#x53E3;&#x64CD;&#x4F5C;&#x4E4B;&#x524D;&#xFF0C;&#x5148;&#x56DE;&#x987E;&#x4E0B;&#x9700;&#x6C42;&#x201C;&#x6BCF;&#x9694;5&#x5206;&#x949F;&#x8F93;&#x51FA;&#x8FC7;&#x53BB;&#x4E00;&#x5C0F;&#x65F6;&#x5185;&#x70B9;&#x51FB;&#x91CF;&#x6700;&#x591A;&#x7684;&#x524D;N&#x4E2A;&#x5546;&#x54C1;&#x201D;&#x3002;&#x7531;&#x4E8E;&#x539F;&#x59CB;&#x6570;&#x636E;&#x4E2D;&#x5B58;&#x5728;&#x70B9;&#x51FB;&#x3001;&#x8D2D;&#x4E70;&#x3001;&#x6536;&#x85CF;&#x3001;&#x559C;&#x6B22;&#x5404;&#x79CD;&#x884C;&#x4E3A;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x7EDF;&#x8BA1;&#x70B9;&#x51FB;&#x91CF;&#xFF0C;&#x6240;&#x4EE5;&#x5148;&#x4F7F;&#x7528;filter&#x5C06;&#x70B9;&#x51FB;&#x884C;&#x4E3A;&#x6570;&#x636E;&#x8FC7;&#x6EE4;&#x51FA;&#x6765;&#x3002;</p>
<p>.filter(_.behavior ==&quot;pv&quot;)</p>
<p><strong>2.2.3**</strong>&#x8BBE;&#x7F6E;&#x6ED1;&#x52A8;&#x7A97;&#x53E3;&#xFF0C;&#x7EDF;&#x8BA1;&#x70B9;&#x51FB;&#x91CF;**</p>
<p>&#x7531;&#x4E8E;&#x8981;&#x6BCF;&#x9694;5&#x5206;&#x949F;&#x7EDF;&#x8BA1;&#x4E00;&#x6B21;&#x6700;&#x8FD1;&#x4E00;&#x5C0F;&#x65F6;&#x6BCF;&#x4E2A;&#x5546;&#x54C1;&#x7684;&#x70B9;&#x51FB;&#x91CF;&#xFF0C;&#x6240;&#x4EE5;&#x7A97;&#x53E3;&#x5927;&#x5C0F;&#x662F;&#x4E00;&#x5C0F;&#x65F6;&#xFF0C;&#x6BCF;&#x9694;5&#x5206;&#x949F;&#x6ED1;&#x52A8;&#x4E00;&#x6B21;&#x3002;&#x5373;&#x5206;&#x522B;&#x8981;&#x7EDF;&#x8BA1;[09:00, 10:00), [09:05, 10:05), [09:10, 10:10)&#x2026;&#x7B49;&#x7A97;&#x53E3;&#x7684;&#x5546;&#x54C1;&#x70B9;&#x51FB;&#x91CF;&#x3002;&#x662F;&#x4E00;&#x4E2A;&#x5E38;&#x89C1;&#x7684;&#x6ED1;&#x52A8;&#x7A97;&#x53E3;&#x9700;&#x6C42;&#xFF08;Sliding Window&#xFF09;&#x3002;</p>
<p>.keyBy(&quot;itemId&quot;)</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/iCKQdNOkXiQeqQpf.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p>.timeWindow(Time.minutes(60), Time.minutes(5))</p>
<p>.aggregate(newCountAgg(),newWindowResultFunction());</p>
<p>&#x6211;&#x4EEC;&#x4F7F;&#x7528;<em>.keyBy(&quot;itemId&quot;)</em>&#x5BF9;&#x5546;&#x54C1;&#x8FDB;&#x884C;&#x5206;&#x7EC4;&#xFF0C;&#x4F7F;&#x7528;<em>.timeWindow(Time size, Time slide)</em>&#x5BF9;&#x6BCF;&#x4E2A;&#x5546;&#x54C1;&#x505A;&#x6ED1;&#x52A8;&#x7A97;&#x53E3;&#xFF08;<strong>1</strong>&#x5C0F;&#x65F6;&#x7A97;&#x53E3;&#xFF0C;<strong>5</strong>&#x5206;&#x949F;&#x6ED1;&#x52A8;&#x4E00;&#x6B21;&#xFF09;<strong>&#x3002;</strong>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x4F7F;</p>
<ul>
<li><em>.aggregate(AggregateFunction af, WindowFunction wf)</em>&#x505A;&#x589E;&#x91CF;&#x7684;&#x805A;&#x5408;&#x64CD;&#x4F5C;&#xFF0C;&#x5B83;&#x80FD;&#x4F7F;</li>
<li>AggregateFunction&#x63D0; &#x524D; &#x805A; &#x5408; &#x6389; &#x6570; &#x636E; &#xFF0C; &#x51CF; &#x5C11;state&#x7684; &#x5B58; &#x50A8; &#x538B; &#x529B;&#x3002;&#x8F83;&#x4E4B;<em>.apply(WindowFunction wf)</em>&#x4F1A;&#x5C06;&#x7A97;&#x53E3;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x90FD;&#x5B58;&#x50A8;&#x4E0B;&#x6765;&#xFF0C;&#x6700;&#x540E;&#x4E00;&#x8D77;&#x8BA1;&#x7B97;&#x8981;&#x9AD8;&#x6548;&#x5730;&#x591A;&#x3002;&#x8FD9;&#x91CC;&#x7684;CountAgg&#x5B9E;&#x73B0;&#x4E86;AggregateFunction&#x63A5;&#x53E3;&#xFF0C;&#x529F;&#x80FD;&#x662F;&#x7EDF;&#x8BA1;&#x7A97;&#x53E3;&#x4E2D;&#x7684;&#x6761;&#x6570;&#xFF0C;&#x5373;&#x9047;&#x5230;&#x4E00;&#x6761;&#x6570;&#x636E;&#x5C31;&#x52A0;&#x4E00;&#x3002;</li>
</ul>
<p><img src="https://uploader.shimo.im/f/qCVN7ewZqjHtql35.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<ul>
<li><em>COUNT**&#x7EDF;&#x8BA1;&#x7684;&#x805A;&#x5408;&#x51FD;&#x6570;&#x5B9E;&#x73B0;&#xFF0C;&#x6BCF;&#x51FA;&#x73B0;&#x4E00;&#x6761;&#x8BB0;&#x5F55;&#x5C31;&#x52A0;&#x4E00;</em></li>
</ul>
<p><strong>class</strong>CountAgg<strong>extends</strong>AggregateFunction[UserBehavior, Long, Long] {<strong>override def</strong>createAccumulator(): Long =<em>**</em>0L</p>
<p><strong>override def</strong>add(userBehavior: UserBehavior, acc: Long): Long = acc +<em>**</em>1</p>
<p><strong>override def</strong>getResult(acc: Long): Long = acc</p>
<p><strong>override def</strong>merge(acc1: Long, acc2: Long): Long = acc1 + acc2</p>
<p>}</p>
<p>&#x805A;&#x5408;&#x64CD;&#x4F5C;<em>.aggregate(AggregateFunction af, WindowFunction wf)</em>&#x7684;&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;**WindowFunction&#x5C06;&#x6BCF;&#x4E2A;key&#x6BCF;&#x4E2A;&#x7A97;&#x53E3;&#x805A;&#x5408;&#x540E;&#x7684;&#x7ED3;&#x679C;&#x5E26;&#x4E0A;&#x5176;&#x4ED6;&#x4FE1;&#x606F;&#x8FDB;&#x884C;&#x8F93;&#x51FA;&#x3002;&#x6211;&#x4EEC;&#x8FD9;&#x91CC;&#x5B9E;&#x73B0;&#x7684;WindowResultFunction&#x5C06;&lt;&#x4E3B;&#x952E;&#x5546;&#x54C1;ID&#xFF0C;&#x7A97;&#x53E3;&#xFF0C;&#x70B9;&#x51FB;&#x91CF;&gt;&#x5C01;&#x88C5;&#x6210;&#x4E86;ItemViewCount&#x8FDB;&#x884C;&#x8F93;&#x51FA;&#x3002;</p>
<ul>
<li>&#x5546;&#x54C1;&#x70B9;&#x51FB;&#x91CF;(&#x7A97;&#x53E3;&#x64CD;&#x4F5C;&#x7684;&#x8F93;&#x51FA;&#x7C7B;&#x578B;)</li>
</ul>
<p>caseclassItemViewCount(itemId: Long, windowEnd: Long, count: Long)</p>
<p>&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="https://uploader.shimo.im/f/i2EsDD2Q2dZlS7QS.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<ul>
<li><em>&#x7528;&#x4E8E;&#x8F93;&#x51FA;&#x7A97;&#x53E3;&#x7684;&#x7ED3;&#x679C;</em></li>
</ul>
<p><strong>class</strong>WindowResultFunction<strong>extends</strong>WindowFunction[Long, ItemViewCount, Tuple,</p>
<p>TimeWindow] {</p>
<p><strong>override def</strong>apply(key: Tuple, window: TimeWindow, aggregateResult:<em>**</em>Iterable[Long],</p>
<p>collector: Collector[ItemViewCount]) : Unit = {</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/Jz7YlAMe1IKd89zR.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><img src="https://uploader.shimo.im/f/jyDnof233bCM0o2J.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p><strong>val</strong>itemId: Long = key.asInstanceOf[Tuple1[Long]].<em>f0</em></p>
<p><strong>val</strong>count = aggregateResult.iterator.next</p>
<p>collector.collect(<em>ItemViewCount</em>(itemId, window.getEnd, count))</p>
<p>}</p>
<p>}</p>
<p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x5C31;&#x5F97;&#x5230;&#x4E86;&#x6BCF;&#x4E2A;&#x5546;&#x54C1;&#x5728;&#x6BCF;&#x4E2A;&#x7A97;&#x53E3;&#x7684;&#x70B9;&#x51FB;&#x91CF;&#x7684;&#x6570;&#x636E;&#x6D41;&#x3002;</p>
<p><strong>2.2.4**</strong>&#x8BA1;&#x7B97;&#x6700;&#x70ED;&#x95E8;<strong><strong>Top N</strong></strong>&#x5546;&#x54C1;**</p>
<p>&#x4E3A;&#x4E86;&#x7EDF;&#x8BA1;&#x6BCF;&#x4E2A;&#x7A97;&#x53E3;&#x4E0B;&#x6700;&#x70ED;&#x95E8;&#x7684;&#x5546;&#x54C1;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x518D;&#x6B21;&#x6309;&#x7A97;&#x53E3;&#x8FDB;&#x884C;&#x5206;&#x7EC4;&#xFF0C;&#x8FD9;&#x91CC;&#x6839;&#x636E;ItemViewCount&#x4E2D;&#x7684;windowEnd&#x8FDB;&#x884C;keyBy()&#x64CD;&#x4F5C;&#x3002;&#x7136;&#x540E;&#x4F7F;&#x7528;ProcessFunction&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49;&#x7684;TopN&#x51FD;&#x6570;TopNHotItems&#x6765;&#x8BA1;&#x7B97;&#x70B9;&#x51FB;&#x91CF;&#x6392;&#x540D;&#x524D;3&#x540D;&#x7684;&#x5546;&#x54C1;&#xFF0C;&#x5E76;&#x5C06;&#x6392;&#x540D;&#x7ED3;&#x679C;&#x683C;&#x5F0F;&#x5316;&#x6210;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x4FBF;&#x4E8E;&#x540E;&#x7EED;&#x8F93;&#x51FA;&#x3002;</p>
<p>.keyBy(&quot;windowEnd&quot;)</p>
<p>.process(newTopNHotItems(3));//&#x6C42;&#x70B9;&#x51FB;&#x91CF;&#x524D;3&#x540D;&#x7684;&#x5546;&#x54C1;</p>
<p>ProcessFunction&#x662F;Flink&#x63D0;&#x4F9B;&#x7684;&#x4E00;&#x4E2A;low-level API&#xFF0C;&#x7528;&#x4E8E;&#x5B9E;&#x73B0;&#x66F4;&#x9AD8;&#x7EA7;&#x7684;&#x529F;&#x80FD;&#x3002;&#x5B83;&#x4E3B;&#x8981;&#x63D0;&#x4F9B;&#x4E86;&#x5B9A;&#x65F6;&#x5668;timer&#x7684;&#x529F;&#x80FD;&#xFF08;&#x652F;&#x6301;EventTime&#x6216;ProcessingTime&#xFF09;&#x3002;&#x672C;&#x6848;&#x4F8B;&#x4E2D;&#x6211;&#x4EEC;&#x5C06;&#x5229;&#x7528;timer&#x6765;&#x5224;&#x65AD;&#x4F55;&#x65F6;&#x6536;&#x9F50;&#x4E86;&#x67D0;&#x4E2A;window&#x4E0B;&#x6240;&#x6709;&#x5546;&#x54C1;&#x7684;&#x70B9;&#x51FB;&#x91CF;&#x6570;&#x636E;&#x3002;&#x7531;&#x4E8E;Watermark&#x7684;&#x8FDB;&#x5EA6;&#x662F;&#x5168;&#x5C40;&#x7684;&#xFF0C;&#x5728;processElement&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x6BCF;&#x5F53;&#x6536;&#x5230;&#x4E00;&#x6761;&#x6570;&#x636E;ItemViewCount&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x6CE8;&#x518C;&#x4E00;&#x4E2A;windowEnd+1&#x7684;&#x5B9A;&#x65F6;&#x5668;&#xFF08;Flink&#x6846;&#x67B6;&#x4F1A;&#x81EA;&#x52A8;&#x5FFD;&#x7565;&#x540C;&#x4E00;&#x65F6;&#x95F4;&#x7684;&#x91CD;&#x590D;&#x6CE8;&#x518C;&#xFF09;&#x3002;windowEnd+1&#x7684;&#x5B9A;&#x65F6;&#x5668;&#x88AB;&#x89E6;&#x53D1;&#x65F6;&#xFF0C;&#x610F;&#x5473;&#x7740;&#x6536;&#x5230;&#x4E86;windowEnd+1</p>
<ul>
<li>Watermark&#xFF0C;&#x5373;&#x6536;&#x9F50;&#x4E86;&#x8BE5;windowEnd&#x4E0B;&#x7684;&#x6240;&#x6709;&#x5546;&#x54C1;&#x7A97;&#x53E3;&#x7EDF;&#x8BA1;&#x503C;&#x3002;&#x6211;&#x4EEC;&#x5728;onTimer()</li>
</ul>
<p>&#x4E2D;&#x5904;&#x7406;&#x5C06;&#x6536;&#x96C6;&#x7684;&#x6240;&#x6709;&#x5546;&#x54C1;&#x53CA;&#x70B9;&#x51FB;&#x91CF;&#x8FDB;&#x884C;&#x6392;&#x5E8F;&#xFF0C;&#x9009;&#x51FA;TopN&#xFF0C;&#x5E76;&#x5C06;&#x6392;&#x540D;&#x4FE1;&#x606F;&#x683C;&#x5F0F;&#x5316;&#x6210;&#x5B57;&#x7B26;&#x4E32;&#x540E;&#x8FDB;&#x884C;&#x8F93;&#x51FA;&#x3002;</p>
<ul>
<li>Java  List&#x63A5;&#x53E3;&#x7684;State  API&#xFF0C;&#x5B83;&#x96C6;&#x6210;&#x4E86;&#x6846;&#x67B6;&#x7684;checkpoint&#x673A;&#x5236;&#xFF0C;&#x81EA;&#x52A8;&#x505A;&#x5230;&#x4E86;</li>
</ul>
<p>exactly-once&#x7684;&#x8BED;&#x4E49;&#x4FDD;&#x8BC1;&#x3002;</p>
<p><img src="https://uploader.shimo.im/f/1DNoDlJbp1knjMEG.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<ul>
<li><em>&#x6C42;&#x67D0;&#x4E2A;&#x7A97;&#x53E3;&#x4E2D;&#x524D;<strong>N</strong>&#x540D;&#x7684;&#x70ED;&#x95E8;&#x70B9;&#x51FB;&#x5546;&#x54C1;&#xFF0C;<strong>key</strong>&#x4E3A;&#x7A97;&#x53E3;&#x65F6;&#x95F4;&#x6233;&#xFF0C;&#x8F93;&#x51FA;&#x4E3A;<strong>TopN</strong>&#x7684;&#x7ED3;&#x679C;&#x5B57;&#x7B26;&#x4E32;</em></li>
</ul>
<p><strong>class</strong>TopNHotItems(topSize: Int)<strong>extends</strong>KeyedProcessFunction[Tuple, ItemViewCount,</p>
<p>String] {</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/E3P2r8H5LQMO8hwi.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><img src="https://uploader.shimo.im/f/Qb0YwlSkVTtpR6Fj.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><img src="https://uploader.shimo.im/f/ljYJaxgot7o6B1Tf.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p><strong>private var*</strong>itemState<strong>*</strong>: ListState[ItemViewCount] = _</p>
<p><strong>override def</strong>open(parameters: Configuration): Unit = {</p>
<p><strong>super</strong>.open(parameters)</p>
<ul>
<li><em>&#x547D;&#x540D;&#x72B6;&#x6001;&#x53D8;&#x91CF;&#x7684;&#x540D;&#x5B57;&#x548C;&#x72B6;&#x6001;&#x53D8;&#x91CF;&#x7684;&#x7C7B;&#x578B;</em></li>
</ul>
<p><strong>val</strong>itemsStateDesc =<strong>new</strong>ListStateDescriptor[ItemViewCount](<strong>&quot;itemState-state&quot;</strong>,</p>
<p><em>classOf</em>[ItemViewCount])</p>
<ul>
<li><em>&#x5B9A;&#x4E49;&#x72B6;&#x6001;&#x53D8;&#x91CF;</em></li>
</ul>
<p><em>itemState</em>= getRuntimeContext.getListState(itemsStateDesc)</p>
<p>}</p>
<p><strong>override def</strong>processElement(input: ItemViewCount, context:<em>**</em>KeyedProcessFunction[Tuple, ItemViewCount,String]#Context, collector: Collector[String]): Unit = {</p>
<ul>
<li><em>&#x6BCF;&#x6761;&#x6570;&#x636E;&#x90FD;&#x4FDD;&#x5B58;&#x5230;&#x72B6;&#x6001;&#x4E2D;</em></li>
</ul>
<p><em>itemState</em>.add(input)</p>
<ul>
<li><em>&#x6CE8;&#x518C;<strong>windowEnd+1</strong>&#x7684;<strong>EventTime Timer,</strong>&#x5F53;&#x89E6;&#x53D1;&#x65F6;&#xFF0C;&#x8BF4;&#x660E;&#x6536;&#x9F50;&#x4E86;&#x5C5E;&#x4E8E;<strong>windowEnd</strong>&#x7A97;&#x53E3;&#x7684;&#x6240;&#x6709;&#x5546;&#x54C1;&#x6570;&#x636E;</em></li>
<li><em>&#x4E5F;&#x5C31;&#x662F;&#x5F53;&#x7A0B;&#x5E8F;&#x770B;&#x5230;<strong>windowend + 1</strong>&#x7684;&#x6C34;&#x4F4D;&#x7EBF;<strong>watermark</strong>&#x65F6;&#xFF0C;&#x89E6;&#x53D1;<strong>onTimer</strong>&#x56DE;&#x8C03;&#x51FD;&#x6570;</em></li>
</ul>
<p>context.timerService.registerEventTimeTimer(input.windowEnd +1)</p>
<p>}</p>
<p><strong>override def</strong>onTimer(timestamp: Long, ctx: KeyedProcessFunction[Tuple,</p>
<p>ItemViewCount,String]#OnTimerContext, out: Collector[String]): Unit = {</p>
<ul>
<li><em>&#x83B7;&#x53D6;&#x6536;&#x5230;&#x7684;&#x6240;&#x6709;&#x5546;&#x54C1;&#x70B9;&#x51FB;&#x91CF;</em></li>
</ul>
<p><strong>val</strong>allItems: ListBuffer[ItemViewCount] = ListBuffer()</p>
<p><strong>import</strong>scala.collection.JavaConversions._</p>
<p><strong>for</strong>(item &lt;-<strong>*</strong>itemState*.get) {</p>
<p>allItems += item</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/x8DATUmmzVw5n2rT.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><img src="https://uploader.shimo.im/f/KUhTXbVDCwsUP7KC.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p>}</p>
<ul>
<li><em>&#x63D0;&#x524D;&#x6E05;&#x9664;&#x72B6;&#x6001;&#x4E2D;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x91CA;&#x653E;&#x7A7A;&#x95F4;</em></li>
</ul>
<p><em>itemState</em>.clear()</p>
<ul>
<li><em>&#x6309;&#x7167;&#x70B9;&#x51FB;&#x91CF;&#x4ECE;&#x5927;&#x5230;&#x5C0F;&#x6392;&#x5E8F;</em></li>
</ul>
<p><strong>val</strong>sortedItems = allItems.sortBy(_.count)(<em>Ordering</em>.Long.reverse).take(<em>topSize</em>)</p>
<ul>
<li><em>&#x5C06;&#x6392;&#x540D;&#x4FE1;&#x606F;&#x683C;&#x5F0F;&#x5316;&#x6210;<strong>String,</strong>&#x4FBF;&#x4E8E;&#x6253;&#x5370;</em></li>
</ul>
<p><strong>val</strong>result:<strong><strong>StringBuilder</strong></strong>=<strong>new</strong>StringBuilder</p>
<p>result.append(<strong>&quot;====================================**</strong>\n<strong>**&quot;</strong>)</p>
<p>result.append(<strong>&quot;**</strong>&#x65F6;&#x95F4;<strong>**: &quot;</strong>).append(<strong>new</strong>Timestamp(timestamp -1)).append(<strong>&quot;**</strong>\n<strong>**&quot;</strong>)</p>
<p><strong>for</strong>(i &lt;- sortedItems.indices){</p>
<p><strong>val</strong>currentItem: ItemViewCount = sortedItems(i)</p>
<p><em>// e.g.<strong>**No1</strong>&#xFF1A;<strong>&#x5546;&#x54C1;</strong>ID=12224<strong>**&#x6D4F;&#x89C8;&#x91CF;</strong>=2413</em></p>
<p>result.append(<strong>&quot;No&quot;</strong>).append(i+1).append(<strong>&quot;:&quot;</strong>)</p>
<p>.append(<strong>&quot;**</strong>&#x5546;&#x54C1;<strong>**ID=&quot;</strong>).append(currentItem.itemId)</p>
<p>.append(<strong>&quot;**</strong>&#x6D4F;&#x89C8;&#x91CF;<strong>**=&quot;</strong>).append(currentItem.count).append(<strong>&quot;**</strong>\n<strong>**&quot;</strong>)</p>
<p>}</p>
<p>result.append(<strong>&quot;====================================**</strong>\n\n<strong>**&quot;</strong>)</p>
<ul>
<li><em>&#x63A7;&#x5236;&#x8F93;&#x51FA;&#x9891;&#x7387;&#xFF0C;&#x6A21;&#x62DF;&#x5B9E;&#x65F6;&#x6EDA;&#x52A8;&#x7ED3;&#x679C;</em></li>
</ul>
<p>Thread.<em>sleep</em>(1000)</p>
<p>out.collect(result.toString)</p>
<p>}</p>
<p>}</p>
<p>&#x6700;&#x540E;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;main&#x51FD;&#x6570;&#x4E2D;&#x5C06;&#x7ED3;&#x679C;&#x6253;&#x5370;&#x8F93;&#x51FA;&#x5230;&#x63A7;&#x5236;&#x53F0;&#xFF0C;&#x65B9;&#x4FBF;&#x5B9E;&#x65F6;&#x89C2;&#x6D4B;&#xFF1A;</p>
<p>.print();</p>
<p>&#x81F3;&#x6B64;&#x6574;&#x4E2A;&#x7A0B;&#x5E8F;&#x4EE3;&#x7801;&#x5168;&#x90E8;&#x5B8C;&#x6210;&#xFF0C;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x8FD0;&#x884C;main&#x51FD;&#x6570;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5728;&#x63A7;&#x5236;&#x53F0;&#x770B;&#x5230;&#x4E0D;&#x65AD;&#x8F93;&#x51FA;&#x7684;&#x5404;&#x4E2A;&#x65F6;&#x95F4;&#x70B9;&#x7EDF;&#x8BA1;&#x51FA;&#x7684;&#x70ED;&#x95E8;&#x5546;&#x54C1;&#x3002;</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/KugJBu1nMI2I72Ph.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;**</strong>2.2.5<strong>**&#x5B8C;&#x6574;&#x4EE3;&#x7801;</strong></p>
<p>&#x6700;&#x7EC8;&#x5B8C;&#x6574;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="https://uploader.shimo.im/f/9LA7uqAi3KEswh28.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p><strong>case class</strong>UserBehavior(userId: Long, itemId: Long, categoryId: Int, behavior:<em>**</em>String,</p>
<p>timestamp: Long)</p>
<p><strong>case class</strong>ItemViewCount(itemId: Long, windowEnd: Long, count: Long)</p>
<p><strong>object</strong>HotItems {</p>
<p><strong>def</strong>main(args: Array[String]): Unit = {</p>
<p><strong>val</strong>env = StreamExecutionEnvironment.<em>getExecutionEnvironment</em></p>
<p>env.setStreamTimeCharacteristic(TimeCharacteristic.<em>EventTime</em>)</p>
<p>env.setParallelism(1)</p>
<p><strong>val</strong>stream = env</p>
<p>.readTextFile(<strong>&quot;YOUR_PATH**</strong>\<strong><strong>resources</strong></strong>\<strong>**UserBehavior.csv&quot;</strong>)</p>
<p>.map(line =&gt; {</p>
<p><strong>val</strong>linearray = line.split(<strong>&quot;,&quot;</strong>)</p>
<p><em>UserBehavior</em>(linearray(0).toLong, linearray(1).toLong, linearray(2).toInt,</p>
<p>linearray(3), linearray(4).toLong)</p>
<p>})</p>
<p>.assignAscendingTimestamps(_.timestamp *1000)</p>
<p>.filter(_.behavior==<strong>&quot;pv&quot;</strong>)</p>
<p>.keyBy(<strong>&quot;itemId&quot;</strong>)</p>
<p>.timeWindow(Time.<em>minutes</em>(60), Time.<em>minutes</em>(5))</p>
<p>.aggregate(<strong>new</strong>CountAgg(),<strong>new</strong>WindowResultFunction())</p>
<p>.keyBy(1)</p>
<p>.process(<strong>new</strong>TopNHotItems(3))</p>
<p>.print()</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/3Xq4oXJVIquQWPr9.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><img src="https://uploader.shimo.im/f/6WQhtSdLFWG8Up4k.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><img src="https://uploader.shimo.im/f/qBHVD6OPeYIgVrTr.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p>env.execute(<strong>&quot;Hot Items Job&quot;</strong>)</p>
<p>}</p>
<ul>
<li><em>COUNT**&#x7EDF;&#x8BA1;&#x7684;&#x805A;&#x5408;&#x51FD;&#x6570;&#x5B9E;&#x73B0;&#xFF0C;&#x6BCF;&#x51FA;&#x73B0;&#x4E00;&#x6761;&#x8BB0;&#x5F55;&#x52A0;&#x4E00;</em></li>
</ul>
<p><strong>class</strong>CountAgg<strong>extends</strong>AggregateFunction[UserBehavior, Long, Long] {<strong>override def</strong>createAccumulator(): Long =<em>**</em>0L</p>
<p><strong>override def</strong>add(userBehavior: UserBehavior, acc: Long): Long = acc +<em>**</em>1</p>
<p><strong>override def</strong>getResult(acc: Long): Long = acc</p>
<p><strong>override def</strong>merge(acc1: Long, acc2: Long): Long = acc1 + acc2</p>
<p>}</p>
<ul>
<li><em>&#x7528;&#x4E8E;&#x8F93;&#x51FA;&#x7A97;&#x53E3;&#x7684;&#x7ED3;&#x679C;</em></li>
</ul>
<p><strong>class</strong>WindowResultFunction<strong>extends</strong>WindowFunction[Long, ItemViewCount, Tuple,</p>
<p>TimeWindow] {</p>
<p><strong>override def</strong>apply(key: Tuple, window: TimeWindow, aggregateResult:<em>**</em>Iterable[Long],</p>
<p>collector: Collector[ItemViewCount]) : Unit = {</p>
<p><strong>val</strong>itemId: Long = key.asInstanceOf[Tuple1[Long]].<em>f0</em></p>
<p><strong>val</strong>count = aggregateResult.iterator.next</p>
<p>collector.collect(<em>ItemViewCount</em>(itemId, window.getEnd, count))</p>
<p>}</p>
<p>}</p>
<ul>
<li><em>&#x6C42;&#x67D0;&#x4E2A;&#x7A97;&#x53E3;&#x4E2D;&#x524D;<strong>N</strong>&#x540D;&#x7684;&#x70ED;&#x95E8;&#x70B9;&#x51FB;&#x5546;&#x54C1;&#xFF0C;<strong>key</strong>&#x4E3A;&#x7A97;&#x53E3;&#x65F6;&#x95F4;&#x6233;&#xFF0C;&#x8F93;&#x51FA;&#x4E3A;<strong>TopN</strong>&#x7684;&#x7ED3;&#x679C;&#x5B57;&#x7B26;&#x4E32;</em></li>
</ul>
<p><strong>class</strong>TopNHotItems(topSize: Int)<strong>extends</strong>KeyedProcessFunction[Tuple, ItemViewCount,</p>
<p>String] {</p>
<p><strong>private var*</strong>itemState<strong>*</strong>: ListState[ItemViewCount] = _</p>
<p><strong>override def</strong>open(parameters: Configuration): Unit = {</p>
<p><strong>super</strong>.open(parameters)</p>
<ul>
<li><em>&#x547D;&#x540D;&#x72B6;&#x6001;&#x53D8;&#x91CF;&#x7684;&#x540D;&#x5B57;&#x548C;&#x72B6;&#x6001;&#x53D8;&#x91CF;&#x7684;&#x7C7B;&#x578B;</em></li>
</ul>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/zRAkArAh7LyhYUv2.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><img src="https://uploader.shimo.im/f/OkZXyCAMiJUnPliS.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><img src="https://uploader.shimo.im/f/EmcKFEDKet3JpRFP.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p><strong>val</strong>itemsStateDesc =<strong>new</strong>ListStateDescriptor[ItemViewCount](<strong>&quot;itemState-state&quot;</strong>,</p>
<p><em>classOf</em>[ItemViewCount])</p>
<ul>
<li><em>&#x4ECE;&#x8FD0;&#x884C;&#x65F6;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x83B7;&#x53D6;&#x72B6;&#x6001;&#x5E76;&#x8D4B;&#x503C;</em></li>
</ul>
<p><em>itemState</em>= getRuntimeContext.getListState(itemsStateDesc)</p>
<p>}</p>
<p><strong>override def</strong>processElement(input: ItemViewCount, context:</p>
<p>KeyedProcessFunction[Tuple, ItemViewCount,String]#Context, collector:</p>
<p>Collector[String]): Unit = {</p>
<ul>
<li><em>&#x6BCF;&#x6761;&#x6570;&#x636E;&#x90FD;&#x4FDD;&#x5B58;&#x5230;&#x72B6;&#x6001;&#x4E2D;</em></li>
</ul>
<p><em>itemState</em>.add(input)</p>
<ul>
<li><em>&#x6CE8;&#x518C;<strong>windowEnd+1</strong>&#x7684;<strong>EventTime Timer,</strong>&#x5F53;&#x89E6;&#x53D1;&#x65F6;&#xFF0C;&#x8BF4;&#x660E;&#x6536;&#x9F50;&#x4E86;&#x5C5E;&#x4E8E;<strong>windowEnd</strong>&#x7A97;&#x53E3;&#x7684;&#x6240;&#x6709;&#x5546;&#x54C1;&#x6570;&#x636E;</em></li>
<li><em>&#x4E5F;&#x5C31;&#x662F;&#x5F53;&#x7A0B;&#x5E8F;&#x770B;&#x5230;<strong>windowend + 1</strong>&#x7684;&#x6C34;&#x4F4D;&#x7EBF;<strong>watermark</strong>&#x65F6;&#xFF0C;&#x89E6;&#x53D1;<strong>onTimer</strong>&#x56DE;&#x8C03;&#x51FD;&#x6570;</em></li>
</ul>
<p>context.timerService.registerEventTimeTimer(input.windowEnd +1)</p>
<p>}</p>
<p><strong>override def</strong>onTimer(timestamp: Long, ctx: KeyedProcessFunction[Tuple,</p>
<p>ItemViewCount,String]#OnTimerContext, out: Collector[String]): Unit = {</p>
<ul>
<li><em>&#x83B7;&#x53D6;&#x6536;&#x5230;&#x7684;&#x6240;&#x6709;&#x5546;&#x54C1;&#x70B9;&#x51FB;&#x91CF;</em></li>
</ul>
<p><strong>val</strong>allItems: ListBuffer[ItemViewCount] = ListBuffer()</p>
<p><strong>import</strong>scala.collection.JavaConversions._</p>
<p><strong>for</strong>(item &lt;-<strong>*</strong>itemState*.get) {</p>
<p>allItems += item</p>
<p>}</p>
<ul>
<li><em>&#x63D0;&#x524D;&#x6E05;&#x9664;&#x72B6;&#x6001;&#x4E2D;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x91CA;&#x653E;&#x7A7A;&#x95F4;</em></li>
</ul>
<p><em>itemState</em>.clear()</p>
<ul>
<li><em>&#x6309;&#x7167;&#x70B9;&#x51FB;&#x91CF;&#x4ECE;&#x5927;&#x5230;&#x5C0F;&#x6392;&#x5E8F;</em></li>
</ul>
<p><strong>val</strong>sortedItems = allItems.sortBy(_.count)(<em>Ordering</em>.Long.reverse).take(<em>topSize</em>)</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/dFYH0L1SFuYIKTaa.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><img src="https://uploader.shimo.im/f/qvo5f5evmRJOvqch.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<ul>
<li><em>&#x5C06;&#x6392;&#x540D;&#x4FE1;&#x606F;&#x683C;&#x5F0F;&#x5316;&#x6210;<strong>String,</strong>&#x4FBF;&#x4E8E;&#x6253;&#x5370;</em></li>
</ul>
<p><strong>val</strong>result:<strong><strong>StringBuilder</strong></strong>=<strong>new</strong>StringBuilder</p>
<p>result.append(<strong>&quot;====================================**</strong>\n<strong>**&quot;</strong>)</p>
<p>result.append(<strong>&quot;**</strong>&#x65F6;&#x95F4;<strong>**: &quot;</strong>).append(<strong>new</strong>Timestamp(timestamp -1)).append(<strong>&quot;**</strong>\n<strong>**&quot;</strong>)</p>
<p><strong>for</strong>(i &lt;- sortedItems.indices){</p>
<p><strong>val</strong>currentItem: ItemViewCount = sortedItems(i)</p>
<p><em>// e.g.<strong>**No1</strong>&#xFF1A;<strong>&#x5546;&#x54C1;</strong>ID=12224<strong>**&#x6D4F;&#x89C8;&#x91CF;</strong>=2413</em></p>
<p>result.append(<strong>&quot;No&quot;</strong>).append(i+1).append(<strong>&quot;:&quot;</strong>)</p>
<p>.append(<strong>&quot;**</strong>&#x5546;&#x54C1;<strong>**ID=&quot;</strong>).append(currentItem.itemId)</p>
<p>.append(<strong>&quot;**</strong>&#x6D4F;&#x89C8;&#x91CF;<strong>**=&quot;</strong>).append(currentItem.count).append(<strong>&quot;**</strong>\n<strong>**&quot;</strong>)</p>
<p>}</p>
<p>result.append(<strong>&quot;====================================**</strong>\n\n<strong>**&quot;</strong>)</p>
<ul>
<li><em>&#x63A7;&#x5236;&#x8F93;&#x51FA;&#x9891;&#x7387;&#xFF0C;&#x6A21;&#x62DF;&#x5B9E;&#x65F6;&#x6EDA;&#x52A8;&#x7ED3;&#x679C;</em></li>
</ul>
<p>Thread.<em>sleep</em>(1000)</p>
<p>out.collect(result.toString)</p>
<p>}</p>
<p>}</p>
<p>}</p>
<p><strong>2.2.6**</strong>&#x66F4;&#x6362;<strong><strong>Kafka</strong></strong>&#x4F5C;&#x4E3A;&#x6570;&#x636E;&#x6E90;**</p>
<p>&#x5B9E;&#x9645;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x6570;&#x636E;&#x6D41;&#x5F80;&#x5F80;&#x662F;&#x4ECE;Kafka&#x83B7;&#x53D6;&#x5230;&#x7684;&#x3002;&#x5982;&#x679C;&#x8981;&#x8BA9;&#x4EE3;&#x7801;&#x66F4;&#x8D34;&#x8FD1;&#x751F;&#x4EA7;&#x5B9E;&#x9645;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x5C06;source&#x66F4;&#x6362;&#x4E3A;Kafka&#x5373;&#x53EF;&#xFF1A;</p>
<p><img src="https://uploader.shimo.im/f/Ni8ph2rtU54VxIon.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p><strong>val</strong>properties =<strong>new</strong>Properties()</p>
<p>properties.setProperty(<strong>&quot;bootstrap.servers&quot;</strong>,<strong>&quot;localhost:9092&quot;</strong>)</p>
<p>properties.setProperty(<strong>&quot;group.id&quot;</strong>,<strong>&quot;consumer-group&quot;</strong>)</p>
<p>properties.setProperty(<strong>&quot;key.deserializer&quot;</strong>,</p>
<p><strong>&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</strong>)</p>
<p>properties.setProperty(<strong>&quot;value.deserializer&quot;</strong>,</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/gr3YUYrbnQsX0j5s.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><img src="https://uploader.shimo.im/f/lzfrciMWele8rAZU.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p><strong>&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</strong>)</p>
<p>properties.setProperty(<strong>&quot;auto.offset.reset&quot;</strong>,<strong>&quot;latest&quot;</strong>)</p>
<p><strong>val</strong>env = StreamExecutionEnvironment.<em>getExecutionEnvironment<em>**</em></em>env.setStreamTimeCharacteristic(TimeCharacteristic.<em>EventTime</em>) env.setParallelism(1)</p>
<p><strong>val</strong>stream = env</p>
<p>.addSource(<strong>new</strong>FlinkKafkaConsumer<a href="**%22hotitems%22**,**new**SimpleStringSchema(">String</a>,</p>
<p>properties))</p>
<p>&#x5F53;&#x7136;&#xFF0C;&#x6839;&#x636E;&#x5B9E;&#x9645;&#x7684;&#x9700;&#x8981;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x5C06;Sink&#x6307;&#x5B9A;&#x4E3A;Kafka&#x3001;ES&#x3001;Redis&#x6216;&#x5176;&#x5B83;&#x5B58;&#x50A8;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x4E00;&#x4E00;&#x5C55;&#x5F00;&#x5B9E;&#x73B0;&#x4E86;&#x3002;</p>
<p>&#x7B2C;3&#x7AE0; &#x5B9E;&#x65F6;&#x6D41;&#x91CF;&#x7EDF;&#x8BA1;</p>
<p>3.1&#x6A21;&#x5757;&#x521B;&#x5EFA;&#x548C;&#x6570;&#x636E;&#x51C6;&#x5907;</p>
<p>&#x5728;UserBehaviorAnalysis&#x4E0B;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;maven module&#x4F5C;&#x4E3A;&#x5B50;&#x9879;&#x76EE;&#xFF0C;&#x547D;&#x540D;&#x4E3A;NetworkFlowAnalysis&#x3002;&#x5728;&#x8FD9;&#x4E2A;&#x5B50;&#x6A21;&#x5757;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x540C;&#x6837;&#x5E76;&#x6CA1;&#x6709;&#x5F15;&#x5165;&#x66F4;&#x591A;&#x7684;&#x4F9D;&#x8D56;&#xFF0C;&#x6240;&#x4EE5;&#x4E5F;&#x4E0D;&#x9700;&#x8981;&#x6539;&#x52A8;pom&#x6587;&#x4EF6;&#x3002;</p>
<ul>
<li>src/main/&#x76EE;&#x5F55;&#x4E0B;&#xFF0C;&#x5C06;&#x9ED8;&#x8BA4;&#x6E90;&#x6587;&#x4EF6;&#x76EE;&#x5F55;java&#x6539;&#x540D;&#x4E3A;scala&#x3002;&#x5C06;apache&#x670D;&#x52A1;&#x5668;&#x7684;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;apache.log&#x590D;&#x5236;&#x5230;&#x8D44;&#x6E90;&#x6587;&#x4EF6;&#x76EE;&#x5F55;src/main/resources&#x4E0B;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x4ECE;&#x8FD9;&#x91CC;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#x3002;</li>
</ul>
<p>&#x5F53;&#x7136;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x4ECD;&#x7136;&#x7528;UserBehavior.csv&#x4F5C;&#x4E3A;&#x6570;&#x636E;&#x6E90;&#xFF0C;&#x8FD9;&#x65F6;&#x6211;&#x4EEC;&#x5206;&#x6790;&#x7684;&#x5C31;&#x4E0D;&#x662F;&#x6BCF;&#x4E00;&#x6B21;&#x5BF9;&#x670D;&#x52A1;&#x5668;&#x7684;&#x8BBF;&#x95EE;&#x8BF7;&#x6C42;&#x4E86;&#xFF0C;&#x800C;&#x662F;&#x5177;&#x4F53;&#x7684;&#x9875;&#x9762;&#x6D4F;&#x89C8;&#xFF08;&#x201C;pv&#x201D;&#xFF09;&#x64CD;&#x4F5C;&#x3002;</p>
<p>3.2&#x57FA;&#x4E8E;&#x670D;&#x52A1;&#x5668;log&#x7684;&#x70ED;&#x95E8;&#x9875;&#x9762;&#x6D4F;&#x89C8;&#x91CF;&#x7EDF;&#x8BA1;</p>
<p>&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x8981;&#x5B9E;&#x73B0;&#x7684;&#x6A21;&#x5757;&#x662F; &#x201C;&#x5B9E;&#x65F6;&#x6D41;&#x91CF;&#x7EDF;&#x8BA1;&#x201D;&#x3002;&#x5BF9;&#x4E8E;&#x4E00;&#x4E2A;&#x7535;&#x5546;&#x5E73;&#x53F0;&#x800C;&#x8A00;&#xFF0C;&#x7528;&#x6237;&#x767B;&#x5F55;&#x7684;&#x5165;&#x53E3;&#x6D41;&#x91CF;&#x3001;&#x4E0D;&#x540C;&#x9875;&#x9762;&#x7684;&#x8BBF;&#x95EE;&#x6D41;&#x91CF;&#x90FD;&#x662F;&#x503C;&#x5F97;&#x5206;&#x6790;&#x7684;&#x91CD;&#x8981;&#x6570;&#x636E;&#xFF0C;&#x800C;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#xFF0C;&#x53EF;&#x4EE5;&#x7B80;&#x5355;&#x5730;&#x4ECE;web&#x670D;&#x52A1;&#x5668;&#x7684;&#x65E5;&#x5FD7;&#x4E2D;&#x63D0;&#x53D6;&#x51FA;&#x6765;&#x3002;</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/POeDNrGnW0Y89J7i.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p>&#x6211;&#x4EEC;&#x5728;&#x8FD9;&#x91CC;&#x5148;&#x5B9E;&#x73B0;&#x201C;&#x70ED;&#x95E8;&#x9875;&#x9762;&#x6D4F;&#x89C8;&#x6570;&#x201D;&#x7684;&#x7EDF;&#x8BA1;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BFB;&#x53D6;&#x670D;&#x52A1;&#x5668;&#x65E5;&#x5FD7;&#x4E2D;&#x7684;&#x6BCF;&#x4E00;&#x884C;log&#xFF0C;&#x7EDF;&#x8BA1;&#x5728;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x5185;&#x7528;&#x6237;&#x8BBF;&#x95EE;&#x6BCF;&#x4E00;&#x4E2A;url&#x7684;&#x6B21;&#x6570;&#xFF0C;&#x7136;&#x540E;&#x6392;&#x5E8F;&#x8F93;&#x51FA;&#x663E;&#x793A;&#x3002;</p>
<p>&#x5177;&#x4F53;&#x505A;&#x6CD5;&#x4E3A;&#xFF1A;&#x6BCF;&#x9694;5&#x79D2;&#xFF0C;&#x8F93;&#x51FA;&#x6700;&#x8FD1;10&#x5206;&#x949F;&#x5185;&#x8BBF;&#x95EE;&#x91CF;&#x6700;&#x591A;&#x7684;&#x524D;N&#x4E2A;URL&#x3002;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x8FD9;&#x4E2A;&#x9700;&#x6C42;&#x4E0E;&#x4E4B;&#x524D;&#x201C;&#x5B9E;&#x65F6;&#x70ED;&#x95E8;&#x5546;&#x54C1;&#x7EDF;&#x8BA1;&#x201D;&#x975E;&#x5E38;&#x7C7B;&#x4F3C;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5B8C;&#x5168;&#x53EF;&#x4EE5;&#x501F;&#x9274;&#x6B64;&#x524D;&#x7684;&#x4EE3;&#x7801;&#x3002;</p>
<ul>
<li>src/main/scala&#x4E0B;&#x521B;&#x5EFA;NetworkFlow.scala&#x6587;&#x4EF6;&#xFF0C;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#x5355;&#x4F8B;&#x5BF9;&#x8C61;&#x3002;&#x5B9A;&#x4E49;&#x6837;&#x4F8B;&#x7C7B;ApacheLogEvent&#xFF0C;&#x8FD9;&#x662F;&#x8F93;&#x5165;&#x7684;&#x65E5;&#x5FD7;&#x6570;&#x636E;&#x6D41;&#xFF1B;&#x53E6;&#x5916;&#x8FD8;&#x6709;UrlViewCount&#xFF0C;&#x8FD9;&#x662F;&#x7A97;&#x53E3;&#x64CD;&#x4F5C;&#x7EDF;&#x8BA1;&#x7684;&#x8F93;&#x51FA;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x3002;&#x5728;main&#x51FD;&#x6570;&#x4E2D;&#x521B;&#x5EFA;StreamExecutionEnvironment&#x5E76;&#x505A;&#x914D;&#x7F6E;&#xFF0C;&#x7136;&#x540E;&#x4ECE;apache.log&#x6587;&#x4EF6;&#x4E2D;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#xFF0C;&#x5E76;&#x5305;&#x88C5;&#x6210;ApacheLogEvent&#x7C7B;&#x578B;&#x3002;</li>
</ul>
<p>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x539F;&#x59CB;&#x65E5;&#x5FD7;&#x4E2D;&#x7684;&#x65F6;&#x95F4;&#x662F;&#x201C;dd/MM/yyyy:HH:mm:ss&#x201D;&#x7684;&#x5F62;&#x5F0F;&#xFF0C;&#x9700;&#x8981;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;DateTimeFormat&#x5C06;&#x5176;&#x8F6C;&#x6362;&#x4E3A;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x7684;&#x65F6;&#x95F4;&#x6233;&#x683C;&#x5F0F;&#xFF1A;</p>
<p>.map(line =&gt; {</p>
<p>val linearray = line.split(&quot; &quot;)</p>
<p>val sdf =newSimpleDateFormat(&quot;dd/MM/yyyy:HH:mm:ss&quot;) val timestamp = sdf.parse(linearray(3)).getTime ApacheLogEvent(linearray(0), linearray(2), timestamp,</p>
<p>linearray(5), linearray(6))</p>
<p>})</p>
<p>&#x5B8C;&#x6574;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><em>NetworkFlowAnalysis/src/main/scala/NetworkFlow.scala</em></p>
<p><img src="https://uploader.shimo.im/f/Oc9Q6H6hdLH8cqYZ.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p><strong>case class</strong>ApacheLogEvent(ip:<strong><strong>String, userId:</strong></strong>String, eventTime: Long, method:<em>**</em>String,</p>
<p>url:String)</p>
<p><strong>case class</strong>UrlViewCount(url:<em>**</em>String, windowEnd: Long, count: Long)</p>
<p><strong>object</strong>NetworkFlow{</p>
<p><strong>def</strong>main(args: Array[String]): Unit = {</p>
<p><strong>val</strong>env = StreamExecutionEnvironment.<em>getExecutionEnvironment<em>**</em></em>env.setStreamTimeCharacteristic(TimeCharacteristic.<em>EventTime</em>)</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/3Hp3cCHUlALCjWEA.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><img src="https://uploader.shimo.im/f/or5JZPriMwP3PLuJ.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><img src="https://uploader.shimo.im/f/PYDutdMB6zoYT5KM.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p>env.setParallelism(1)</p>
<p><strong>val</strong>stream = env</p>
<ul>
<li><em>&#x4EE5;<strong>window</strong>&#x4E0B;&#x4E3A;&#x4F8B;&#xFF0C;&#x9700;&#x66FF;&#x6362;&#x6210;&#x81EA;&#x5DF1;&#x7684;&#x8DEF;&#x5F84;</em></li>
</ul>
<p>.readTextFile(<strong>&quot;YOUR_PATH**</strong>\<strong><strong>resources</strong></strong>\<strong>**apache.log&quot;</strong>)</p>
<p>.map(line =&gt; {</p>
<p><strong>val</strong>linearray = line.split(<strong>&quot; &quot;</strong>)</p>
<p><strong>val</strong>simpleDateFormat =<strong>new</strong>SimpleDateFormat(<strong>&quot;dd/MM/yyyy:HH:mm:ss&quot;</strong>)</p>
<p><strong>val</strong>timestamp = simpleDateFormat.parse(linearray(3)).getTime</p>
<p><em>ApacheLogEvent</em>(linearray(0), linearray(2), timestamp, linearray(5),**linearray(6))</p>
<p>})</p>
<p>.assignTimestampsAndWatermarks(<strong>new</strong>BoundedOutOfOrdernessTimestampExtractor[ApacheLogEvent] (Time.<em>milliseconds</em>(1000)) {</p>
<p><strong>override def</strong>extractTimestamp(t: ApacheLogEvent): Long = {</p>
<p>t.eventTime</p>
<p>}</p>
<p>})</p>
<p>.filter( data =&gt; {</p>
<p><strong>val</strong>pattern = &quot;<strong>^((?!\.(css|js)$).)*$</strong>&quot;.r</p>
<p>(pattern findFirstIn data.url).nonEmpty</p>
<p>} )</p>
<p>.keyBy(&quot;url&quot;)</p>
<p>.timeWindow(Time.<em>minutes</em>(10), Time.<em>seconds</em>(5))</p>
<p>.aggregate(<strong>new</strong>CountAgg(),<strong>new</strong>WindowResultFunction())</p>
<p>.keyBy(1)</p>
<p>.process(<strong>new</strong>TopNHotUrls(5))</p>
<p>.print()</p>
<p>env.execute(<strong>&quot;Network Flow Job&quot;</strong>)</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/7mqRBiC5ySmUoFAw.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><img src="https://uploader.shimo.im/f/x64xMrLP6VRshW4G.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><img src="https://uploader.shimo.im/f/iJDVWEwaMxrLrDGd.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p>}</p>
<p><strong>class</strong>CountAgg<strong>extends</strong>AggregateFunction[ApacheLogEvent, Long, Long] {<strong>override def</strong>createAccumulator(): Long =<em>**</em>0L</p>
<p><strong>override def</strong>add(apacheLogEvent: ApacheLogEvent, acc: Long): Long = acc +<em>**</em>1</p>
<p><strong>override def</strong>getResult(acc: Long): Long = acc</p>
<p><strong>override def</strong>merge(acc1: Long, acc2: Long): Long = acc1 + acc2</p>
<p>}</p>
<p><strong>class</strong>WindowResultFunction<strong>extends</strong>WindowFunction[Long, UrlViewCount, Tuple,</p>
<p>TimeWindow] {</p>
<p><strong>override def</strong>apply(key: Tuple, window: TimeWindow, aggregateResult:<em>**</em>Iterable[Long],</p>
<p>collector: Collector[UrlViewCount]) : Unit = {</p>
<p><strong>val</strong>url:<strong><strong>String</strong></strong>= key.asInstanceOf[Tuple1[String]].<em>f0**</em>val**count = aggregateResult.iterator.next</p>
<p>collector.collect(<em>UrlViewCount</em>(url, window.getEnd, count))</p>
<p>}</p>
<p>}</p>
<p><strong>class</strong>TopNHotUrls(topsize: Int)<strong>extends</strong>KeyedProcessFunction[Tuple, UrlViewCount,<em>**</em>String] {</p>
<p><strong>private var*</strong>urlState<strong>*</strong>: ListState[UrlViewCount] = _</p>
<p><strong>override def</strong>open(parameters: Configuration): Unit = {</p>
<p><strong>super</strong>.open(parameters)</p>
<p><strong>val</strong>urlStateDesc =<strong>new</strong>ListStateDescriptor[UrlViewCount](<strong>&quot;urlState-state&quot;</strong>,</p>
<p><em>classOf</em>[UrlViewCount])</p>
<p><em>urlState</em>= getRuntimeContext.getListState(urlStateDesc)</p>
<p>}</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/n8tfgvCNsCgAG7VP.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><img src="https://uploader.shimo.im/f/iFACcRStlWIQjs4X.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p><strong>override def</strong>processElement(input: UrlViewCount, context:<em>**</em>KeyedProcessFunction[Tuple, UrlViewCount,String]#Context, collector: Collector[String]): Unit = {</p>
<ul>
<li><em>&#x6BCF;&#x6761;&#x6570;&#x636E;&#x90FD;&#x4FDD;&#x5B58;&#x5230;&#x72B6;&#x6001;&#x4E2D;</em></li>
</ul>
<p><em>urlState</em>.add(input)</p>
<p>context.timerService.registerEventTimeTimer(input.windowEnd +1)</p>
<p>}</p>
<p><strong>override def</strong>onTimer(timestamp: Long, ctx: KeyedProcessFunction[Tuple,</p>
<p>UrlViewCount,String]#OnTimerContext, out: Collector[String]): Unit = {</p>
<ul>
<li><em>&#x83B7;&#x53D6;&#x6536;&#x5230;&#x7684;&#x6240;&#x6709; URL &#x8BBF;&#x95EE;&#x91CF;</em></li>
</ul>
<p><strong>val</strong>allUrlViews: ListBuffer[UrlViewCount] = ListBuffer()</p>
<p><strong>import</strong>scala.collection.JavaConversions._</p>
<p><strong>for</strong>(urlView &lt;-<strong>*</strong>urlState*.get) {</p>
<p>allUrlViews += urlView</p>
<p>}</p>
<ul>
<li><em>&#x63D0;&#x524D;&#x6E05;&#x9664;&#x72B6;&#x6001;&#x4E2D;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x91CA;&#x653E;&#x7A7A;&#x95F4;</em></li>
</ul>
<p><em>urlState</em>.clear()</p>
<ul>
<li><em>&#x6309;&#x7167;&#x8BBF;&#x95EE;&#x91CF;&#x4ECE;&#x5927;&#x5230;&#x5C0F;&#x6392;&#x5E8F;</em></li>
</ul>
<p><strong>val</strong>sortedUrlViews = allUrlViews.sortBy(_.count)(<em>Ordering</em>.Long.reverse)</p>
<p>.take(<em>topSize</em>)</p>
<ul>
<li><em>&#x5C06;&#x6392;&#x540D;&#x4FE1;&#x606F;&#x683C;&#x5F0F;&#x5316;&#x6210;<strong>String,</strong>&#x4FBF;&#x4E8E;&#x6253;&#x5370;</em></li>
</ul>
<p><strong>var</strong>result:<strong><strong>StringBuilder</strong></strong>=<strong>new</strong>StringBuilder</p>
<p>result.append(<strong>&quot;====================================**</strong>\n<strong>**&quot;</strong>)</p>
<p>result.append(<strong>&quot;**</strong>&#x65F6;&#x95F4;<strong>**: &quot;</strong>).append(<strong>new</strong>Timestamp(timestamp -1)).append(<strong>&quot;**</strong>\n<strong>**&quot;</strong>)</p>
<p><strong>for</strong>(i &lt;- sortedUrlViews.indices) {</p>
<p><strong>val</strong>currentUrlView: UrlViewCount = sortedUrlViews(i)</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/odjbM0m5ePGMp0YZ.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><img src="https://uploader.shimo.im/f/WciX7hj8E3B17cSr.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p><em>// e.g.<strong>**No1</strong>&#xFF1A;<strong>URL</strong>=/blog/tags/firefox?flav=rss20<strong>&#x6D41;&#x91CF;</strong>=55</em></p>
<p>result.append(<strong>&quot;No&quot;</strong>).append(i+1).append(<strong>&quot;:&quot;</strong>)</p>
<p>.append(<strong>&quot;**</strong>URL=&quot;**).append(currentUrlView.url)</p>
<p>.append(<strong>&quot;**</strong>&#x6D41;&#x91CF;<strong>**=&quot;</strong>).append(currentUrlView.count).append(<strong>&quot;**</strong>\n<strong>**&quot;</strong>)</p>
<p>}</p>
<p>result.append(<strong>&quot;====================================**</strong>\n\n<strong>**&quot;</strong>)</p>
<ul>
<li><em>&#x63A7;&#x5236;&#x8F93;&#x51FA;&#x9891;&#x7387;&#xFF0C;&#x6A21;&#x62DF;&#x5B9E;&#x65F6;&#x6EDA;&#x52A8;&#x7ED3;&#x679C;</em></li>
</ul>
<p>Thread.<em>sleep</em>(1000)</p>
<p>out.collect(result.toString)</p>
<p>}</p>
<p>}</p>
<p>}</p>
<p>3.3&#x57FA;&#x4E8E;&#x57CB;&#x70B9;&#x65E5;&#x5FD7;&#x6570;&#x636E;&#x7684;&#x7F51;&#x7EDC;&#x6D41;&#x91CF;&#x7EDF;&#x8BA1;</p>
<p>&#x6211;&#x4EEC;&#x53D1;&#x73B0;&#xFF0C;&#x4ECE;web&#x670D;&#x52A1;&#x5668;log&#x4E2D;&#x5F97;&#x5230;&#x7684;url&#xFF0C;&#x5F80;&#x5F80;&#x66F4;&#x591A;&#x7684;&#x662F;&#x8BF7;&#x6C42;&#x67D0;&#x4E2A;&#x8D44;&#x6E90;&#x5730;&#x5740;</p>
<ul>
<li>/<em>.js&#x3001;/</em>.css&#xFF09;&#xFF0C;&#x5982;&#x679C;&#x8981;&#x9488;&#x5BF9;&#x9875;&#x9762;&#x8FDB;&#x884C;&#x7EDF;&#x8BA1;&#x5F80;&#x5F80;&#x8FD8;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x8FC7;&#x6EE4;&#x3002;&#x800C;&#x5728;&#x5B9E;&#x9645;&#x7535;&#x5546;&#x5E94;&#x7528;&#x4E2D;&#xFF0C;&#x76F8;&#x6BD4;&#x6BCF;&#x4E2A;&#x5355;&#x72EC;&#x9875;&#x9762;&#x7684;&#x8BBF;&#x95EE;&#x91CF;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x80FD;&#x66F4;&#x52A0;&#x5173;&#x5FC3;&#x6574;&#x4E2A;&#x7535;&#x5546;&#x7F51;&#x7AD9;&#x7684;&#x7F51;&#x7EDC;&#x6D41;&#x91CF;&#x3002;&#x8FD9;&#x4E2A;&#x6307;&#x6807;&#xFF0C;&#x9664;&#x4E86;&#x5408;&#x5E76;&#x4E4B;&#x524D;&#x6BCF;&#x4E2A;&#x9875;&#x9762;&#x7684;&#x7EDF;&#x8BA1;&#x7ED3;&#x679C;&#x4E4B;&#x5916;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x7EDF;&#x8BA1;&#x57CB;&#x70B9;&#x65E5;&#x5FD7;&#x6570;&#x636E;&#x4E2D;&#x7684;&#x201C;pv&#x201D;&#x884C;&#x4E3A;&#x6765;&#x5F97;&#x5230;&#x3002;</li>
</ul>
<p><strong>3.3.1**</strong>&#x7F51;&#x7AD9;&#x603B;&#x6D4F;&#x89C8;&#x91CF;&#xFF08;<strong><strong>PV</strong></strong>&#xFF09;&#x7684;&#x7EDF;&#x8BA1;**</p>
<p>&#x8861;&#x91CF;&#x7F51;&#x7AD9;&#x6D41;&#x91CF;&#x4E00;&#x4E2A;&#x6700;&#x7B80;&#x5355;&#x7684;&#x6307;&#x6807;&#xFF0C;&#x5C31;&#x662F;&#x7F51;&#x7AD9;&#x7684;&#x9875;&#x9762;&#x6D4F;&#x89C8;&#x91CF;&#xFF08;Page View&#xFF0C;PV&#xFF09;&#x3002;&#x7528;&#x6237;&#x6BCF;&#x6B21;&#x6253;&#x5F00;&#x4E00;&#x4E2A;&#x9875;&#x9762;&#x4FBF;&#x8BB0;&#x5F55;1&#x6B21;PV&#xFF0C;&#x591A;&#x6B21;&#x6253;&#x5F00;&#x540C;&#x4E00;&#x9875;&#x9762;&#x5219;&#x6D4F;&#x89C8;&#x91CF;&#x7D2F;&#x8BA1;&#x3002;&#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;PV&#x4E0E;&#x6765;&#x8BBF;&#x8005;&#x7684;&#x6570;&#x91CF;&#x6210;&#x6B63;&#x6BD4;&#xFF0C;&#x4F46;&#x662F;PV&#x5E76;&#x4E0D;&#x76F4;&#x63A5;&#x51B3;&#x5B9A;&#x9875;&#x9762;&#x7684;&#x771F;&#x5B9E;&#x6765;&#x8BBF;&#x8005;&#x6570;&#x91CF;&#xFF0C;&#x5982;&#x540C;&#x4E00;&#x4E2A;&#x6765;&#x8BBF;&#x8005;&#x901A;&#x8FC7;&#x4E0D;&#x65AD;&#x7684;&#x5237;&#x65B0;&#x9875;&#x9762;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x5236;&#x9020;&#x51FA;&#x975E;&#x5E38;&#x9AD8;&#x7684;PV&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x77E5;&#x9053;&#xFF0C;&#x7528;&#x6237;&#x6D4F;&#x89C8;&#x9875;&#x9762;&#x65F6;&#xFF0C;&#x4F1A;&#x4ECE;&#x6D4F;&#x89C8;&#x5668;&#x5411;&#x7F51;&#x7EDC;&#x670D;&#x52A1;&#x5668;&#x53D1;&#x51FA;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#xFF08;Request&#xFF09;&#xFF0C;&#x7F51;&#x7EDC;&#x670D;&#x52A1;&#x5668;&#x63A5;&#x5230;&#x8FD9;&#x4E2A;&#x8BF7;&#x6C42;&#x540E;&#xFF0C;&#x4F1A;&#x5C06;&#x8BE5;&#x8BF7;&#x6C42;&#x5BF9;&#x5E94;&#x7684;&#x4E00;&#x4E2A;&#x7F51;&#x9875;&#xFF08;Page&#xFF09;&#x53D1;&#x9001;&#x7ED9;&#x6D4F;&#x89C8;&#x5668;&#xFF0C;&#x4ECE;&#x800C;&#x4EA7;&#x751F;&#x4E86;&#x4E00;&#x4E2A;PV&#x3002;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x7684;&#x7EDF;&#x8BA1;&#x65B9;&#x6CD5;&#xFF0C;&#x53EF;&#x4EE5;&#x662F;&#x4ECE;web&#x670D;&#x52A1;&#x5668;&#x7684;&#x65E5;&#x5FD7;&#x4E2D;&#x53BB;&#x63D0;&#x53D6;&#x5BF9;&#x5E94;&#x7684;&#x9875;&#x9762;&#x8BBF;&#x95EE;&#x7136;&#x540E;&#x7EDF;&#x8BA1;&#xFF0C;&#x5C31;&#x5411;&#x4E0A;&#x4E00;&#x8282;&#x4E2D;&#x7684;&#x505A;&#x6CD5;&#x4E00;&#x6837;&#xFF1B;&#x4E5F;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4ECE;&#x57CB;&#x70B9;&#x65E5;&#x5FD7;&#x4E2D;&#x63D0;&#x53D6;&#x7528;&#x6237;&#x53D1;&#x6765;&#x7684;&#x9875;&#x9762;&#x8BF7;&#x6C42;&#xFF0C;&#x4ECE;&#x800C;&#x7EDF;&#x8BA1;&#x51FA;&#x603B;&#x6D4F;&#x89C8;&#x91CF;&#x3002;</p>
<p>&#x6240;&#x4EE5;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x7528;UserBehavior.csv&#x4F5C;&#x4E3A;&#x6570;&#x636E;&#x6E90;&#xFF0C;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x7F51;&#x7AD9;&#x603B;&#x6D4F;&#x89C8;&#x91CF;&#x7684;&#x7EDF;&#x8BA1;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x6EDA;&#x52A8;&#x65F6;&#x95F4;&#x7A97;&#x53E3;&#xFF0C;&#x5B9E;&#x65F6;&#x7EDF;&#x8BA1;&#x6BCF;&#x5C0F;&#x65F6;&#x5185;&#x7684;&#x7F51;&#x7AD9;PV&#x3002;</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/tCk3wtXljaeUMO2n.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<ul>
<li>src/main/scala&#x4E0B;&#x521B;&#x5EFA;PageView.scala&#x6587;&#x4EF6;&#xFF0C;&#x5177;&#x4F53;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</li>
</ul>
<p><em>NetworkFlowAnalysis/src/main/scala/PageView.scala</em></p>
<p><img src="https://uploader.shimo.im/f/6nW4JxXvjTuJtZIv.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p><strong>case class</strong>UserBehavior(userId: Long, itemId: Long, categoryId: Int, behavior:<em>**</em>String,</p>
<p>timestamp: Long)</p>
<p><strong>object</strong>PageView {</p>
<p><strong>def</strong>main(args: Array[String]): Unit = {</p>
<p><strong>val</strong>resourcesPath = getClass.getResource(<strong>&quot;/UserBehaviorTest.csv&quot;</strong>)</p>
<p><strong>val</strong>env = StreamExecutionEnvironment.<em>getExecutionEnvironment<em>**</em></em>env.setStreamTimeCharacteristic(TimeCharacteristic.<em>EventTime</em>) env.setParallelism(1)</p>
<p><strong>val</strong>stream = env.readTextFile(resourcesPath.getPath)</p>
<p>.map(data =&gt; {</p>
<p><strong>val</strong>dataArray = data.split(<strong>&quot;,&quot;</strong>)</p>
<p><em>UserBehavior</em>(dataArray(0).toLong, dataArray(1).toLong, dataArray(2).toInt,**dataArray(3), dataArray(4).toLong)</p>
<p>})</p>
<p>.assignAscendingTimestamps(_.timestamp *1000)</p>
<p>.filter(_.behavior ==<strong>&quot;pv&quot;</strong>)</p>
<p>.map(x =&gt; (<strong>&quot;pv&quot;</strong>,1))</p>
<p>.keyBy(_._1)</p>
<p>.timeWindow(Time.<em>seconds</em>(60*60))</p>
<p>.sum(1)</p>
<p>.print()</p>
<p>env.execute(<strong>&quot;Page View Job&quot;</strong>)</p>
<p>}</p>
<p>}</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/aYUFONMta3SjJ4xr.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><strong>3.3.2**</strong>&#x7F51;&#x7AD9;&#x72EC;&#x7ACB;&#x8BBF;&#x5BA2;&#x6570;&#xFF08;<strong><strong>UV</strong></strong>&#xFF09;&#x7684;&#x7EDF;&#x8BA1;**</p>
<p>&#x5728;&#x4E0A;&#x8282;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x7EDF;&#x8BA1;&#x7684;&#x662F;&#x6240;&#x6709;&#x7528;&#x6237;&#x5BF9;&#x9875;&#x9762;&#x7684;&#x6240;&#x6709;&#x6D4F;&#x89C8;&#x884C;&#x4E3A;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x540C;&#x4E00;&#x7528;&#x6237;&#x7684;&#x6D4F;&#x89C8;&#x884C;&#x4E3A;&#x4F1A;&#x88AB;&#x91CD;&#x590D;&#x7EDF;&#x8BA1;&#x3002;&#x800C;&#x5728;&#x5B9E;&#x9645;&#x5E94;&#x7528;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5F80;&#x5F80;&#x8FD8;&#x4F1A;&#x5173;&#x6CE8;&#xFF0C;&#x5728;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x5185;&#x5230;&#x5E95;&#x6709;&#x591A;&#x5C11;&#x4E0D;&#x540C;&#x7684;&#x7528;&#x6237;&#x8BBF;&#x95EE;&#x4E86;&#x7F51;&#x7AD9;&#x3002;</p>
<p>&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x7EDF;&#x8BA1;&#x6D41;&#x91CF;&#x7684;&#x91CD;&#x8981;&#x6307;&#x6807;&#x662F;&#x7F51;&#x7AD9;&#x7684;&#x72EC;&#x7ACB;&#x8BBF;&#x5BA2;&#x6570;&#xFF08;Unique Visitor&#xFF0C;UV&#xFF09;&#x3002;UV&#x6307;&#x7684;&#x662F;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#xFF08;&#x6BD4;&#x5982;&#x4E00;&#x5C0F;&#x65F6;&#xFF09;&#x5185;&#x8BBF;&#x95EE;&#x7F51;&#x7AD9;&#x7684;&#x603B;&#x4EBA;&#x6570;&#xFF0C;1&#x5929;&#x5185;&#x540C;&#x4E00;&#x8BBF;&#x5BA2;&#x7684;&#x591A;&#x6B21;&#x8BBF;&#x95EE;&#x53EA;&#x8BB0;&#x5F55;&#x4E3A;&#x4E00;&#x4E2A;&#x8BBF;&#x5BA2;&#x3002;&#x901A;&#x8FC7;IP&#x548C;cookie&#x4E00;&#x822C;&#x662F;&#x5224;&#x65AD;UV&#x503C;&#x7684;&#x4E24;&#x79CD;&#x65B9;&#x5F0F;&#x3002;&#x5F53;&#x5BA2;&#x6237;&#x7AEF;&#x7B2C;&#x4E00;&#x6B21;&#x8BBF;&#x95EE;&#x67D0;&#x4E2A;&#x7F51;&#x7AD9;&#x670D;&#x52A1;&#x5668;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x7F51;&#x7AD9;&#x670D;&#x52A1;&#x5668;&#x4F1A;&#x7ED9;&#x8FD9;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x7535;&#x8111;&#x53D1;&#x51FA;&#x4E00;&#x4E2A;Cookie&#xFF0C;&#x901A;&#x5E38;&#x653E;&#x5728;&#x8FD9;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#x7535;&#x8111;&#x7684;C&#x76D8;&#x5F53;&#x4E2D;&#x3002;&#x5728;&#x8FD9;&#x4E2A;Cookie&#x4E2D;&#x4F1A;&#x5206;&#x914D;&#x4E00;&#x4E2A;&#x72EC;&#x4E00;&#x65E0;&#x4E8C;&#x7684;&#x7F16;&#x53F7;&#xFF0C;&#x8FD9;&#x5176;&#x4E2D;&#x4F1A;&#x8BB0;&#x5F55;&#x4E00;&#x4E9B;&#x8BBF;&#x95EE;&#x670D;&#x52A1;&#x5668;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x5982;&#x8BBF;&#x95EE;&#x65F6;&#x95F4;&#xFF0C;&#x8BBF;&#x95EE;&#x4E86;&#x54EA;&#x4E9B;&#x9875;&#x9762;&#x7B49;&#x7B49;&#x3002;&#x5F53;&#x4F60;&#x4E0B;&#x6B21;&#x518D;&#x8BBF;&#x95EE;&#x8FD9;&#x4E2A;&#x670D;&#x52A1;&#x5668;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x5C31;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4ECE;&#x4F60;&#x7684;&#x7535;&#x8111;&#x4E2D;&#x627E;&#x5230;&#x4E0A;&#x4E00;&#x6B21;&#x653E;&#x8FDB;&#x53BB;&#x7684;Cookie&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x4E14;&#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x4E00;&#x4E9B;&#x66F4;&#x65B0;&#xFF0C;&#x4F46;&#x90A3;&#x4E2A;&#x72EC;&#x4E00;&#x65E0;&#x4E8C;&#x7684;&#x7F16;&#x53F7;&#x662F;&#x4E0D;&#x4F1A;&#x53D8;&#x7684;&#x3002;</p>
<p>&#x5F53;&#x7136;&#xFF0C;&#x5BF9;&#x4E8E;UserBehavior&#x6570;&#x636E;&#x6E90;&#x6765;&#x8BF4;&#xFF0C;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x53EF;&#x4EE5;&#x6839;&#x636E;userId&#x6765;&#x533A;&#x5206;&#x4E0D;&#x540C;&#x7684;&#x7528;&#x6237;&#x3002;</p>
<ul>
<li>src/main/scala&#x4E0B;&#x521B;&#x5EFA;UniqueVisitor.scala&#x6587;&#x4EF6;&#xFF0C;&#x5177;&#x4F53;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</li>
</ul>
<p><em>NetworkFlowAnalysis/src/main/scala/UniqueVisitor.scala</em></p>
<p><img src="https://uploader.shimo.im/f/aPmPy4Xa29EWTGDt.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p><strong>case class</strong>UvCount(windowEnd: Long, count: Long)</p>
<p><strong>object</strong>UniqueVisitor {</p>
<p><strong>def</strong>main(args: Array[String]): Unit = {</p>
<p><strong>val</strong>resourcesPath = getClass.getResource(<strong>&quot;/UserBehaviorTest.csv&quot;</strong>)<strong>val</strong>env = StreamExecutionEnvironment.<em>getExecutionEnvironment<em>**</em></em>env.setStreamTimeCharacteristic(TimeCharacteristic.<em>EventTime</em>) env.setParallelism(1)</p>
<p><strong>val</strong>stream = env</p>
<p>.readTextFile(resourcesPath.getPath)</p>
<p>.map(line =&gt; {</p>
<p><strong>val</strong>linearray = line.split(<strong>&quot;,&quot;</strong>)</p>
<p><em>UserBehavior</em>(linearray(0).toLong, linearray(1).toLong, linearray(2).toInt,</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/KfUkR4ITMCjQnp3Y.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><img src="https://uploader.shimo.im/f/5rwHf7ezLFYxuRla.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p>linearray(3), linearray(4).toLong)</p>
<p>})</p>
<p>.assignAscendingTimestamps(_.timestamp *1000)</p>
<p>.filter(_.behavior ==<strong>&quot;pv&quot;</strong>)</p>
<p>.timeWindowAll(Time.<em>seconds</em>(60*60))</p>
<p>.apply(<strong>new</strong>UvCountByWindow())</p>
<p>.print()</p>
<p>env.execute(<strong>&quot;Unique Visitor Job&quot;</strong>)</p>
<p>}</p>
<p>}</p>
<p><strong>class</strong>UvCountByWindow<strong>extends</strong>AllWindowFunction[UserBehavior, UvCount, TimeWindow] {<strong>override def</strong>apply(window: TimeWindow,</p>
<p>input:Iterable[UserBehavior],</p>
<p>out: Collector[UvCount]): Unit = {</p>
<p><strong>val</strong>s: collection.mutable.Set[Long] = collection.mutable.Set()</p>
<p><strong>var</strong>idSet =<strong>*</strong>Set*<a href="">Long</a></p>
<p><strong>for</strong>( userBehavior &lt;- input) {</p>
<p>idSet += userBehavior.userId</p>
<p>}</p>
<p>out.collect(<em>UvCount</em>(window.getEnd, idSet.size))</p>
<p>}</p>
<p>}</p>
<p><strong>3.3.3**</strong>&#x4F7F;&#x7528;&#x5E03;&#x9686;&#x8FC7;&#x6EE4;&#x5668;&#x7684;<strong><strong>UV</strong></strong>&#x7EDF;&#x8BA1;**</p>
<p>&#x5728;&#x4E0A;&#x8282;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x628A;&#x6240;&#x6709;&#x6570;&#x636E;&#x7684;userId&#x90FD;&#x5B58;&#x5728;&#x4E86;&#x7A97;&#x53E3;&#x8BA1;&#x7B97;&#x7684;&#x72B6;&#x6001;&#x91CC;&#xFF0C;&#x5728;&#x7A97;</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/0V2R0DboLykac6Ds.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p>&#x53E3;&#x6536;&#x96C6;&#x6570;&#x636E;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x72B6;&#x6001;&#x4F1A;&#x4E0D;&#x65AD;&#x589E;&#x5927;&#x3002;&#x4E00;&#x822C;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x53EA;&#x8981;&#x4E0D;&#x8D85;&#x51FA;&#x5185;&#x5B58;&#x7684;&#x627F;&#x53D7;&#x8303;&#x56F4;&#xFF0C;&#x8FD9;&#x79CD;&#x505A;&#x6CD5;&#x4E5F;&#x6CA1;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#xFF1B;&#x4F46;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x9047;&#x5230;&#x7684;&#x6570;&#x636E;&#x91CF;&#x5F88;&#x5927;&#x5462;&#xFF1F;</p>
<p>&#x628A;&#x6240;&#x6709;&#x6570;&#x636E;&#x6682;&#x5B58;&#x653E;&#x5230;&#x5185;&#x5B58;&#x91CC;&#xFF0C;&#x663E;&#x7136;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x597D;&#x6CE8;&#x610F;&#x3002;&#x6211;&#x4EEC;&#x4F1A;&#x60F3;&#x5230;&#xFF0C;&#x53EF;&#x4EE5;&#x5229;&#x7528;redis&#x8FD9;&#x79CD;&#x5185;&#x5B58;&#x7EA7;k-v&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x4E3A;&#x6211;&#x4EEC;&#x505A;&#x4E00;&#x4E2A;&#x7F13;&#x5B58;&#x3002;&#x4F46;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x9047;&#x5230;&#x7684;&#x60C5;&#x51B5;&#x975E;&#x5E38;&#x6781;&#x7AEF;&#xFF0C;&#x6570;&#x636E;&#x5927;&#x5230;&#x60CA;&#x4EBA;&#x5462;&#xFF1F;&#x6BD4;&#x5982;&#x4E0A;&#x4EBF;&#x7EA7;&#x7684;&#x7528;&#x6237;&#xFF0C;&#x8981;&#x53BB;&#x91CD;&#x8BA1;&#x7B97;UV&#x3002;</p>
<p>&#x5982;&#x679C;&#x653E;&#x5230;redis&#x4E2D;&#xFF0C;&#x4EBF;&#x7EA7;&#x7684;&#x7528;&#x6237;id&#xFF08;&#x6BCF;&#x4E2A;20&#x5B57;&#x8282;&#x5DE6;&#x53F3;&#x7684;&#x8BDD;&#xFF09;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x51E0;G&#x751A;&#x81F3;&#x51E0;&#x5341;G&#x7684;&#x7A7A;&#x95F4;&#x6765;&#x5B58;&#x50A8;&#x3002;&#x5F53;&#x7136;&#x653E;&#x5230;redis&#x4E2D;&#xFF0C;&#x7528;&#x96C6;&#x7FA4;&#x8FDB;&#x884C;&#x6269;&#x5C55;&#x4E5F;&#x4E0D;&#x662F;&#x4E0D;&#x53EF;&#x4EE5;&#xFF0C;&#x4F46;&#x660E;&#x663E;&#x4EE3;&#x4EF7;&#x592A;&#x5927;&#x4E86;&#x3002;</p>
<p>&#x4E00;&#x4E2A;&#x66F4;&#x597D;&#x7684;&#x60F3;&#x6CD5;&#x662F;&#xFF0C;&#x5176;&#x5B9E;&#x6211;&#x4EEC;&#x4E0D;&#x9700;&#x8981;&#x5B8C;&#x6574;&#x5730;&#x5B58;&#x50A8;&#x7528;&#x6237;ID&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x53EA;&#x8981;&#x77E5;&#x9053;&#x4ED6;&#x5728;&#x4E0D;&#x5728;&#x5C31;&#x884C;&#x4E86;&#x3002;&#x6240;&#x4EE5;&#x5176;&#x5B9E;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x538B;&#x7F29;&#x5904;&#x7406;&#xFF0C;&#x7528;&#x4E00;&#x4F4D;&#xFF08;bit&#xFF09;&#x5C31;&#x53EF;&#x4EE5;&#x8868;&#x793A;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#x7684;&#x72B6;&#x6001;&#x3002;&#x8FD9;&#x4E2A;&#x601D;&#x60F3;&#x7684;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x5C31;&#x662F;&#x5E03;&#x9686;&#x8FC7;&#x6EE4;&#x5668;&#xFF08;Bloom Filter&#xFF09;&#x3002;</p>
<p>&#x672C;&#x8D28;&#x4E0A;&#x5E03;&#x9686;&#x8FC7;&#x6EE4;&#x5668;&#x662F;&#x4E00;&#x79CD;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF0C;&#x6BD4;&#x8F83;&#x5DE7;&#x5999;&#x7684;&#x6982;&#x7387;&#x578B;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF08;probabilistic data structure&#xFF09;&#xFF0C;&#x7279;&#x70B9;&#x662F;&#x9AD8;&#x6548;&#x5730;&#x63D2;&#x5165;&#x548C;&#x67E5;&#x8BE2;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x544A;&#x8BC9;&#x4F60;&#x201C;&#x67D0;&#x6837;&#x4E1C;&#x897F;&#x4E00;&#x5B9A;&#x4E0D;&#x5B58;&#x5728;&#x6216;&#x8005;&#x53EF;&#x80FD;&#x5B58;&#x5728;&#x201D;&#x3002;</p>
<p>&#x5B83;&#x672C;&#x8EAB;&#x662F;&#x4E00;&#x4E2A;&#x5F88;&#x957F;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x5411;&#x91CF;&#xFF0C;&#x65E2;&#x7136;&#x662F;&#x4E8C;&#x8FDB;&#x5236;&#x7684;&#x5411;&#x91CF;&#xFF0C;&#x90A3;&#x4E48;&#x663E;&#x800C;&#x6613;&#x89C1;&#x7684;&#xFF0C;&#x5B58;&#x653E;&#x7684;&#x4E0D;&#x662F;0&#xFF0C;&#x5C31;&#x662F;1&#x3002;&#x76F8;&#x6BD4;&#x4E8E;&#x4F20;&#x7EDF;&#x7684;List&#x3001;Set&#x3001;Map&#x7B49;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF0C;&#x5B83;&#x66F4;&#x9AD8;&#x6548;&#x3001;&#x5360;&#x7528;&#x7A7A;&#x95F4;&#x66F4;&#x5C11;&#xFF0C;&#x4F46;&#x662F;&#x7F3A;&#x70B9;&#x662F;&#x5176;&#x8FD4;&#x56DE;&#x7684;&#x7ED3;&#x679C;&#x662F;&#x6982;&#x7387;&#x6027;&#x7684;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x786E;&#x5207;&#x7684;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x7684;&#x76EE;&#x6807;&#x5C31;&#x662F;&#xFF0C;&#x5229;&#x7528;&#x67D0;&#x79CD;&#x65B9;&#x6CD5;&#xFF08;&#x4E00;&#x822C;&#x662F;Hash&#x51FD;&#x6570;&#xFF09;&#x628A;&#x6BCF;&#x4E2A;&#x6570;&#x636E;&#xFF0C;&#x5BF9;&#x5E94;&#x5230;&#x4E00;&#x4E2A;&#x4F4D;&#x56FE;&#x7684;&#x67D0;&#x4E00;&#x4F4D;&#x4E0A;&#x53BB;&#xFF1B;&#x5982;&#x679C;&#x6570;&#x636E;&#x5B58;&#x5728;&#xFF0C;&#x90A3;&#x4E00;&#x4F4D;&#x5C31;&#x662F;1&#xFF0C;&#x4E0D;&#x5B58;&#x5728;&#x5219;&#x4E3A;0&#x3002;</p>
<p>&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x5C31;&#x6765;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x4E00;&#x4E0B;&#x3002;</p>
<p>&#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x7528;&#x5230;&#x4E86;redis&#x8FDE;&#x63A5;&#x5B58;&#x53D6;&#x6570;&#x636E;&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x52A0;&#x5165;redis&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x4F9D;&#x8D56;&#xFF1A;</p>
<p><img src="https://uploader.shimo.im/f/i5sHfIZq6DKHYcEG.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p>&lt;<strong>dependencies</strong>&gt;</p>
<p>&lt;<strong>dependency</strong>&gt;</p>
<p>&lt;<strong>groupId</strong>&gt;redis.clients&lt;/<strong>groupId</strong>&gt;</p>
<p>&lt;<strong>artifactId</strong>&gt;jedis&lt;/<strong>artifactId</strong>&gt;</p>
<p>&lt;<strong>version</strong>&gt;2.8.1&lt;/<strong>version</strong>&gt;</p>
<p>&lt;/<strong>dependency</strong>&gt;</p>
<p>&lt;/<strong>dependencies</strong>&gt;</p>
<ul>
<li>src/main/scala&#x4E0B;&#x521B;&#x5EFA;UniqueVisitor.scala&#x6587;&#x4EF6;&#xFF0C;&#x5177;&#x4F53;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</li>
</ul>
<p><em>NetworkFlowAnalysis/src/main/scala/UvWithBloom.scala</em></p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/ImCBS1yC2JPEUDf8.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><img src="https://uploader.shimo.im/f/sOvpWDgdGbPLxF2d.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p><strong>object</strong>UvWithBloomFilter {</p>
<p><strong>def</strong>main(args: Array[String]): Unit = {</p>
<p><strong>val</strong>env = StreamExecutionEnvironment.<em>getExecutionEnvironment<em>**</em></em>env.setStreamTimeCharacteristic(TimeCharacteristic.<em>EventTime</em>) env.setParallelism(1)</p>
<p><strong>val</strong>resourcesPath = getClass.getResource(<strong>&quot;/UserBehaviorTest.csv&quot;</strong>)</p>
<p><strong>val</strong>stream = env</p>
<p>.readTextFile(resourcesPath.getPath)</p>
<p>.map(data =&gt; {</p>
<p><strong>val</strong>dataArray = data.split(<strong>&quot;,&quot;</strong>)</p>
<p><em>UserBehavior</em>(dataArray(0).toLong, dataArray(1).toLong, dataArray(2).toInt,**dataArray(3), dataArray(4).toLong)</p>
<p>})</p>
<p>.assignAscendingTimestamps(_.timestamp *1000)</p>
<p>.filter(_.behavior ==<strong>&quot;pv&quot;</strong>)</p>
<p>.map(data =&gt; (<strong>&quot;dummyKey&quot;</strong>, data.userId))</p>
<p>.keyBy(_._1)</p>
<p>.timeWindow(Time.<em>seconds</em>(60*60))</p>
<p>.trigger(<strong>new</strong>MyTrigger())<em>//**&#x81EA;&#x5B9A;&#x4E49;&#x7A97;&#x53E3;&#x89E6;&#x53D1;&#x89C4;&#x5219;</em></p>
<p>.process(<strong>new</strong>UvCountWithBloom())<em>//**&#x81EA;&#x5B9A;&#x4E49;&#x7A97;&#x53E3;&#x5904;&#x7406;&#x89C4;&#x5219;</em></p>
<p>stream.print()</p>
<p>env.execute(<strong>&quot;Unique Visitor with bloom Job&quot;</strong>)</p>
<p>}</p>
<p>}</p>
<ul>
<li><em>&#x81EA;&#x5B9A;&#x4E49;&#x89E6;&#x53D1;&#x5668;</em></li>
</ul>
<p><strong>class</strong>MyTrigger()<strong>extends</strong>Trigger[(String, Long), TimeWindow] {</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/HwNUJgLye6oS4mgf.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><img src="https://uploader.shimo.im/f/YoPwJOt8sAkCjFBI.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><img src="https://uploader.shimo.im/f/9U37vzBvDwX17c7y.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p><strong>override def</strong>onEventTime(time: Long, window: TimeWindow, ctx:</p>
<p>Trigger.TriggerContext): TriggerResult = {</p>
<p>TriggerResult.<em>CONTINUE</em></p>
<p>}</p>
<p><strong>override def</strong>onProcessingTime(time: Long, window: TimeWindow, ctx:</p>
<p>Trigger.TriggerContext): TriggerResult = {</p>
<p>TriggerResult.<em>CONTINUE</em></p>
<p>}</p>
<p><strong>override def</strong>clear(window: TimeWindow, ctx: Trigger.TriggerContext): Unit = {</p>
<p>}</p>
<p><strong>override def</strong>onElement(element: (String, Long), timestamp: Long, window: TimeWindow,</p>
<p>ctx: Trigger.TriggerContext): TriggerResult = {</p>
<ul>
<li><em>&#x6BCF;&#x6765;&#x4E00;&#x6761;&#x6570;&#x636E;&#xFF0C;&#x5C31;&#x89E6;&#x53D1;&#x7A97;&#x53E3;&#x64CD;&#x4F5C;&#x5E76;&#x6E05;&#x7A7A;</em></li>
</ul>
<p>TriggerResult.<em>FIRE_AND_PURGE</em></p>
<p>}</p>
<p>}</p>
<ul>
<li><em>&#x81EA;&#x5B9A;&#x4E49;&#x7A97;&#x53E3;&#x5904;&#x7406;&#x51FD;&#x6570;</em></li>
</ul>
<p><strong>class</strong>UvCountWithBloom()<strong>extends</strong>ProcessWindowFunction[(String, Long), UvCount,<em>**</em>String,</p>
<p>TimeWindow] {</p>
<p><em>//<strong>&#x521B;&#x5EFA;</strong>redis**&#x8FDE;&#x63A5;</em></p>
<p><strong>lazy val*</strong>jedis<strong>*</strong>=<strong>new</strong>Jedis(<strong>&quot;localhost&quot;</strong>,<em>**</em>6379)</p>
<p><strong>lazy val*</strong>bloom<strong>*</strong>=<strong>new</strong>Bloom(1<strong><strong>&lt;&lt;</strong></strong>29)</p>
<p><strong>override def</strong>process(key:<strong><strong>String, context: Context, elements:</strong></strong>Iterable[(String,</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/d7SIdHju13FAg45S.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><img src="https://uploader.shimo.im/f/OMIJJrNSmBM6E3YA.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><img src="https://uploader.shimo.im/f/wcXdRA2iYLLEx6rZ.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p>Long)], out: Collector[UvCount]): Unit = {</p>
<p><strong>val</strong>storeKey = context.window.getEnd.toString</p>
<p><strong>var</strong>count =<em>**</em>0L</p>
<p><strong>if</strong>(<em>jedis</em>.hget(<strong>&quot;count&quot;</strong>, storeKey) !=<strong>null</strong>) {<strong><em>*count =</em>jedis*.hget(</strong>&quot;count&quot;**, storeKey).toLong</p>
<p>}</p>
<p><strong>val</strong>userId = elements.last._2.toString</p>
<p><strong>val</strong>offset =<strong>*</strong>bloom<em>.hash(userId,<em>*</em></em>61)</p>
<p><strong>val</strong>isExist =<strong>*</strong>jedis*.getbit(storeKey, offset)</p>
<p><strong>if</strong>(!isExist) {</p>
<p><em>jedis</em>.setbit(storeKey, offset,<strong>**true</strong>)</p>
<p><em>jedis</em>.hset(<strong>&quot;count&quot;</strong>, storeKey, (count +**1).toString)</p>
<p>out.collect(<em>UvCount</em>(storeKey.toLong, count +1))</p>
<p>}<strong>else</strong>{</p>
<p>out.collect(<em>UvCount</em>(storeKey.toLong, count))</p>
<p>}</p>
<p>}</p>
<p>}</p>
<ul>
<li><em>&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x5E03;&#x9686;&#x8FC7;&#x6EE4;&#x5668;</em></li>
</ul>
<p><strong>class</strong>Bloom(size: Long)<strong>extends</strong>Serializable {</p>
<p><strong>private val*</strong>cap<strong>*</strong>= size</p>
<p><strong>def</strong>hash(value:<em>**</em>String, seed: Int): Long = {</p>
<p><strong>var</strong>result =<em>**</em>0</p>
<p><strong>for</strong>(i &lt;-<strong><strong>0</strong></strong>until value.length) {</p>
<ul>
<li><em>&#x6700;&#x7B80;&#x5355;&#x7684;<strong>hash</strong>&#x7B97;&#x6CD5;&#xFF0C;&#x6BCF;&#x4E00;&#x4F4D;&#x5B57;&#x7B26;&#x7684;<strong>ascii</strong>&#x7801;&#x503C;&#xFF0C;&#x4E58;&#x4EE5;<strong>seed</strong>&#x4E4B;&#x540E;&#xFF0C;&#x505A;&#x53E0;&#x52A0;</em></li>
</ul>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/3kkVX6f1xFTPjsTR.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><img src="https://uploader.shimo.im/f/GVUaU6uUQCV52Key.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p>result = result * seed + value.charAt(i)</p>
<p>}</p>
<p>(<em>cap</em>-1) &amp; result</p>
<p>}</p>
<p>}</p>
<p>&#x7B2C;4&#x7AE0; &#x5E02;&#x573A;&#x8425;&#x9500;&#x5546;&#x4E1A;&#x6307;&#x6807;&#x7EDF;&#x8BA1;&#x5206;&#x6790;</p>
<p>4.1&#x6A21;&#x5757;&#x521B;&#x5EFA;&#x548C;&#x6570;&#x636E;&#x51C6;&#x5907;</p>
<p>&#x7EE7;&#x7EED;&#x5728;UserBehaviorAnalysis&#x4E0B;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;maven module&#x4F5C;&#x4E3A;&#x5B50;&#x9879;&#x76EE;&#xFF0C;&#x547D;&#x540D;&#x4E3A;MarketAnalysis&#x3002;</p>
<p>&#x8FD9;&#x4E2A;&#x6A21;&#x5757;&#x4E2D;&#x6211;&#x4EEC;&#x6CA1;&#x6709;&#x73B0;&#x6210;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x6240;&#x4EE5;&#x4F1A;&#x7528;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x6D4B;&#x8BD5;&#x6E90;&#x6765;&#x4EA7;&#x751F;&#x6D4B;&#x8BD5;&#x6570;&#x636E;&#x6D41;&#xFF0C;&#x6216;&#x8005;&#x76F4;&#x63A5;&#x7528;&#x751F;&#x6210;&#x6D4B;&#x8BD5;&#x6570;&#x636E;&#x6587;&#x4EF6;&#x3002;</p>
<p>4.2 APP&#x5E02;&#x573A;&#x63A8;&#x5E7F;&#x7EDF;&#x8BA1;</p>
<p>&#x968F;&#x7740;&#x667A;&#x80FD;&#x624B;&#x673A;&#x7684;&#x666E;&#x53CA;&#xFF0C;&#x5728;&#x5982;&#x4ECA;&#x7684;&#x7535;&#x5546;&#x7F51;&#x7AD9;&#x4E2D;&#x5DF2;&#x7ECF;&#x6709;&#x8D8A;&#x6765;&#x8D8A;&#x591A;&#x7684;&#x7528;&#x6237;&#x6765;&#x81EA;&#x79FB;&#x52A8;&#x7AEF;&#xFF0C;&#x76F8;&#x6BD4;&#x8D77;&#x4F20;&#x7EDF;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x767B;&#x5F55;&#x65B9;&#x5F0F;&#xFF0C;&#x624B;&#x673A;APP&#x6210;&#x4E3A;&#x4E86;&#x66F4;&#x591A;&#x7528;&#x6237;&#x8BBF;&#x95EE;&#x7535;&#x5546;&#x7F51;&#x7AD9;&#x7684;&#x9996;&#x9009;&#x3002;&#x5BF9;&#x4E8E;&#x7535;&#x5546;&#x4F01;&#x4E1A;&#x6765;&#x8BF4;&#xFF0C;&#x4E00;&#x822C;&#x4F1A;&#x901A;&#x8FC7;&#x5404;&#x79CD;&#x4E0D;&#x540C;&#x7684;&#x6E20;&#x9053;&#x5BF9;&#x81EA;&#x5DF1;&#x7684;APP&#x8FDB;&#x884C;&#x5E02;&#x573A;&#x63A8;&#x5E7F;&#xFF0C;&#x800C;&#x8FD9;&#x4E9B;&#x6E20;&#x9053;&#x7684;&#x7EDF;&#x8BA1;&#x6570;&#x636E;&#xFF08;&#x6BD4;&#x5982;&#xFF0C;&#x4E0D;&#x540C;&#x7F51;&#x7AD9;&#x4E0A;&#x5E7F;&#x544A;&#x94FE;&#x63A5;&#x7684;&#x70B9;&#x51FB;&#x91CF;&#x3001;APP&#x4E0B;&#x8F7D;&#x91CF;&#xFF09;&#x5C31;&#x6210;&#x4E86;&#x5E02;&#x573A;&#x8425;&#x9500;&#x7684;&#x91CD;&#x8981;&#x5546;&#x4E1A;&#x6307;&#x6807;&#x3002;</p>
<p>&#x9996; &#x5148; &#x6211; &#x4EEC; &#x8003; &#x5BDF; &#x5206; &#x6E20; &#x9053; &#x7684; &#x5E02; &#x573A; &#x63A8; &#x5E7F; &#x7EDF; &#x8BA1;&#x3002;&#x5728;src/main/scala&#x4E0B; &#x521B; &#x5EFA;AppMarketingByChannel.scala&#x6587;&#x4EF6;&#x3002;&#x7531;&#x4E8E;&#x6CA1;&#x6709;&#x73B0;&#x6210;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x81EA;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x6D4B;&#x8BD5;&#x6E90;&#x6765;&#x751F;&#x6210;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x7684;&#x4E8B;&#x4EF6;&#x6D41;&#x3002;</p>
<p><strong>4.2.1**</strong>&#x81EA;&#x5B9A;&#x4E49;&#x6D4B;&#x8BD5;&#x6570;&#x636E;&#x6E90;**</p>
<p>&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x6E90;&#x6570;&#x636E;&#x7684;&#x6837;&#x4F8B;&#x7C7B;MarketingUserBehavior&#xFF0C;&#x518D;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;SourceFunction&#xFF0C;&#x7528;&#x4E8E;&#x4EA7;&#x751F;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x6E90;&#x6570;&#x636E;&#xFF0C;&#x547D;&#x540D;&#x4E3A;SimulatedEventSource&#xFF1A;</p>
<p><img src="https://uploader.shimo.im/f/Gh4daEE6BGdg4jyE.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p><strong>case class</strong>MarketingUserBehavior(userId: Long, behavior:<strong><strong>String, channel:</strong></strong>String,</p>
<p>timestamp: Long)</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/MU96g60J5TCw3X88.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><img src="https://uploader.shimo.im/f/WaHBMejoXiFkWSH5.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p><strong>class</strong>SimulatedEventSource<strong>extends</strong>RichParallelSourceFunction[MarketingUserBehavior]</p>
<p>{</p>
<p><strong>var*</strong>running<strong>*</strong>=<strong>true</strong></p>
<p><strong>val*</strong>channelSet<em>:<strong><strong>Seq[String] =</strong></strong></em>Seq<em>(<strong>&quot;AppStore&quot;</strong>,<strong>**</strong>&quot;XiaomiStore&quot;<strong>,<em>**</em></strong>&quot;HuaweiStore&quot;<strong>,<em>**</em></strong>&quot;weibo&quot;<strong>,<em>**</em></strong>&quot;wechat&quot;<strong>,</strong>&quot;tieba&quot;*</em>)</p>
<p><strong>val*</strong>behaviorTypes<em>:<strong><strong>Seq[String] =</strong></strong></em>Seq<em>(<strong>&quot;BROWSE&quot;</strong>,<strong>**</strong>&quot;CLICK&quot;<strong>,<em>**</em></strong>&quot;PURCHASE&quot;<strong>,<em>**</em></strong>&quot;UNINSTALL&quot;*</em>)</p>
<p><strong>val*</strong>rand*: Random = Random</p>
<p><strong>override def</strong>run(ctx: SourceContext[MarketingUserBehavior]): Unit = {<strong>val</strong>maxElements = Long.<em>MaxValue</em></p>
<p><strong>var</strong>count =<em>**</em>0L</p>
<p><strong>while</strong>(<em>running<em>**</em></em>&amp;&amp; count &lt; maxElements) {</p>
<p><strong>val</strong>id = UUID.<em>randomUUID</em>().toString.toLong</p>
<p><strong>val</strong>behaviorType =<strong>*</strong>behaviorTypes<em>(</em>rand<em>.nextInt(</em>behaviorTypes*.size))</p>
<p><strong>val</strong>channel =<strong>*</strong>channelSet<em>(</em>rand<em>.nextInt(</em>channelSet*.size))</p>
<p><strong>val</strong>ts = System.<em>currentTimeMillis</em>()</p>
<p>ctx.collectWithTimestamp(<em>MarketingUserBehavior</em>(id, behaviorType, channel, ts),</p>
<p>ts)</p>
<p>count +=1</p>
<p>TimeUnit.<em>MILLISECONDS</em>.sleep(5L)</p>
<p>}</p>
<p>}</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/YywgU0976ydXKC85.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><img src="https://uploader.shimo.im/f/11QKDsWlbHlPSwoI.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p><strong>override def</strong>cancel(): Unit =<strong>*</strong>running<strong>*</strong>=<strong>false</strong></p>
<p>}</p>
<p><strong>4.2.2**</strong>&#x5206;&#x6E20;&#x9053;&#x7EDF;&#x8BA1;**</p>
<p>&#x53E6;&#x5916;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x7A97;&#x53E3;&#x5904;&#x7406;&#x7684;&#x8F93;&#x51FA;&#x7ED3;&#x679C;&#x6837;&#x4F8B;&#x7C7B;MarketingViewCount&#xFF0C;&#x5E76;&#x81EA;&#x5B9A;&#x4E49;</p>
<p>ProcessWindowFunction&#x8FDB;&#x884C;&#x5904;&#x7406;&#xFF0C;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="https://uploader.shimo.im/f/FdIlLT46OwhPCGLK.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p><strong>case class</strong>MarketingCountView(windowStart: Long, windowEnd: Long, channel:<em>**</em>String,</p>
<p>behavior:String, count: Long)</p>
<p><strong>object</strong>AppMarketingByChannel {</p>
<p><strong>def</strong>main(args: Array[String]): Unit = {</p>
<p><strong>val</strong>env = StreamExecutionEnvironment.<em>getExecutionEnvironment<em>**</em></em>env.setStreamTimeCharacteristic(TimeCharacteristic.<em>EventTime</em>) env.setParallelism(1)</p>
<p><strong>val</strong>stream: DataStream[MarketingUserBehavior] = env.addSource(<strong>new</strong>SimulatedEventSource)</p>
<p>.assignAscendingTimestamps(_.timestamp)</p>
<p>stream</p>
<p>.filter(_.behavior !=<strong>&quot;UNINSTALL&quot;</strong>)</p>
<p>.map(data =&gt; {</p>
<p>((data.channel, data.behavior),1L)</p>
<p>})</p>
<p>.keyBy(_._1)</p>
<p>.timeWindow(Time.<em>hours</em>(1), Time.<em>seconds</em>(1))</p>
<p>.process(<strong>new</strong>MarketingCountByChannel())</p>
<p>.print()</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/6jtOocZBAX1a06pn.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><img src="https://uploader.shimo.im/f/1bdeNsVynzn3jPbO.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p>env.execute(getClass.getSimpleName)</p>
<p>}</p>
<p>}</p>
<p><strong>class</strong>MarketingCountByChannel()<strong>extends</strong>ProcessWindowFunction[((String,<strong><strong>String),</strong></strong>Long), MarketingViewCount, (String,String), TimeWindow] {</p>
<p><strong>override def</strong>process(key: (String,<em>**</em>String),</p>
<p>context: Context,</p>
<p>elements:Iterable[((String,String), Long)],</p>
<p>out: Collector[MarketingViewCount]): Unit = {<strong>val</strong>startTs = context.window.getStart<strong>val</strong>endTs = context.window.getEnd</p>
<p><strong>val</strong>channel = key._1</p>
<p><strong>val</strong>behaviorType = key._2</p>
<p><strong>val</strong>count = elements.size</p>
<p>out.collect(<em>MarketingViewCount</em>(formatTs(startTs), formatTs(endTs), channel,</p>
<p>behaviorType, count) )</p>
<p>}</p>
<p><strong>private def</strong>formatTs (ts: Long) = {</p>
<p><strong>val</strong>df =<strong>new</strong>SimpleDateFormat (<strong>&quot;yyyy/MM/dd-HH:mm:ss&quot;</strong>)</p>
<p>df.format (<strong>new</strong>Date (ts) )</p>
<p>}</p>
<p>}</p>
<p><strong>4.2.3**</strong>&#x4E0D;&#x5206;&#x6E20;&#x9053;&#xFF08;&#x603B;&#x91CF;&#xFF09;&#x7EDF;&#x8BA1;**</p>
<p>&#x540C;&#x6837;&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x8003;&#x5BDF;&#x4E0D;&#x5206;&#x6E20;&#x9053;&#x7684;&#x5E02;&#x573A;&#x63A8;&#x5E7F;&#x7EDF;&#x8BA1;&#xFF0C;&#x8FD9;&#x6837;&#x5F97;&#x5230;&#x7684;&#x5C31;&#x662F;&#x6240;&#x6709;&#x6E20;&#x9053;&#x63A8;&#x5E7F;&#x7684;&#x603B;&#x91CF;&#x3002;&#x5728;src/main/scala&#x4E0B;&#x521B;&#x5EFA;AppMarketingStatistics.scala&#x6587;&#x4EF6;&#xFF0C;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="https://uploader.shimo.im/f/QEfkqlWLHDkrgprD.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p><strong>object</strong>AppMarketingStatistics {</p>
<p><strong>def</strong>main(args: Array[String]): Unit = {</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/EHH5w1yxyHv0WG7I.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><img src="https://uploader.shimo.im/f/xU4wWXVeljkUiKPP.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><img src="https://uploader.shimo.im/f/bOstpOOSLMveVIuO.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p><strong>val</strong>env = StreamExecutionEnvironment.<em>getExecutionEnvironment<em>**</em></em>env.setStreamTimeCharacteristic(TimeCharacteristic.<em>EventTime</em>) env.setParallelism(1)</p>
<p><strong>val</strong>stream: DataStream[MarketingUserBehavior] = env.addSource(<strong>new</strong>SimulatedEventSource)</p>
<p>.assignAscendingTimestamps(_.timestamp)</p>
<p>stream</p>
<p>.filter(_.behavior !=<strong>&quot;UNINSTALL&quot;</strong>)</p>
<p>.map(data =&gt; {</p>
<p>(<strong>&quot;dummyKey&quot;</strong>,1L)</p>
<p>})</p>
<p>.keyBy(_._1)</p>
<p>.timeWindow(Time.<em>hours</em>(1), Time.<em>seconds</em>(1))</p>
<p>.process(<strong>new</strong>MarketingCountTotal())</p>
<p>.print()</p>
<p>env.execute(getClass.getSimpleName)</p>
<p>}</p>
<p>}</p>
<p><strong>class</strong>MarketingCountTotal()<strong>extends</strong>ProcessWindowFunction[(String, Long),<em>**</em>MarketingViewCount,String, TimeWindow]{</p>
<p><strong>override def</strong>process(key:<strong><strong>String, context: Context, elements:</strong></strong>Iterable[(String,</p>
<p>Long)], out: Collector[MarketingViewCount]): Unit = {</p>
<p><strong>val</strong>startTs = context.window.getStart</p>
<p><strong>val</strong>endTs = context.window.getEnd</p>
<p><strong>val</strong>count = elements.size</p>
<p>out.collect(<em>MarketingViewCount</em>(formatTs(startTs), formatTs(endTs),<strong>&quot;total&quot;</strong>,</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/WX19PSQqjVRRPbDT.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><img src="https://uploader.shimo.im/f/9stlmrhViPrAh7x2.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p><strong>&quot;total&quot;</strong>, count) )</p>
<p>}</p>
<p><strong>private def</strong>formatTs (ts: Long) = {</p>
<p><strong>val</strong>df =<strong>new</strong>SimpleDateFormat (<strong>&quot;yyyy/MM/dd-HH:mm:ss&quot;</strong>)</p>
<p>df.format (<strong>new</strong>Date (ts) )</p>
<p>}</p>
<p>}</p>
<p>4.3&#x9875;&#x9762;&#x5E7F;&#x544A;&#x5206;&#x6790;</p>
<p>&#x7535;&#x5546;&#x7F51;&#x7AD9;&#x7684;&#x5E02;&#x573A;&#x8425;&#x9500;&#x5546;&#x4E1A;&#x6307;&#x6807;&#x4E2D;&#xFF0C;&#x9664;&#x4E86;&#x81EA;&#x8EAB;&#x7684;APP&#x63A8;&#x5E7F;&#xFF0C;&#x8FD8;&#x4F1A;&#x8003;&#x8651;&#x5230;&#x9875;&#x9762;&#x4E0A;&#x7684;&#x5E7F;&#x544A;&#x6295;&#x653E;&#xFF08;&#x5305;&#x62EC;&#x81EA;&#x5DF1;&#x7ECF;&#x8425;&#x7684;&#x4EA7;&#x54C1;&#x548C;&#x5176;&#x5B83;&#x7F51;&#x7AD9;&#x7684;&#x5E7F;&#x544A;&#xFF09;&#x3002;&#x6240;&#x4EE5;&#x5E7F;&#x544A;&#x76F8;&#x5173;&#x7684;&#x7EDF;&#x8BA1;&#x5206;&#x6790;&#xFF0C;&#x4E5F;&#x662F;&#x5E02;&#x573A;&#x8425;&#x9500;&#x7684;&#x91CD;&#x8981;&#x6307;&#x6807;&#x3002;</p>
<p>&#x5BF9;&#x4E8E;&#x5E7F;&#x544A;&#x7684;&#x7EDF;&#x8BA1;&#xFF0C;&#x6700;&#x7B80;&#x5355;&#x4E5F;&#x6700;&#x91CD;&#x8981;&#x7684;&#x5C31;&#x662F;&#x9875;&#x9762;&#x5E7F;&#x544A;&#x7684;&#x70B9;&#x51FB;&#x91CF;&#xFF0C;&#x7F51;&#x7AD9;&#x5F80;&#x5F80;&#x9700;&#x8981;&#x6839;&#x636E;&#x5E7F;&#x544A;&#x70B9;&#x51FB;&#x91CF;&#x6765;&#x5236;&#x5B9A;&#x5B9A;&#x4EF7;&#x7B56;&#x7565;&#x548C;&#x8C03;&#x6574;&#x63A8;&#x5E7F;&#x65B9;&#x5F0F;&#xFF0C;&#x800C;&#x4E14;&#x4E5F;&#x53EF;&#x4EE5;&#x501F;&#x6B64;&#x6536;&#x96C6;&#x7528;&#x6237;&#x7684;&#x504F;&#x597D;&#x4FE1;&#x606F;&#x3002;&#x66F4;&#x52A0;&#x5177;&#x4F53;&#x7684;&#x5E94;&#x7528;&#x662F;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x7528;&#x6237;&#x7684;&#x5730;&#x7406;&#x4F4D;&#x7F6E;&#x8FDB;&#x884C;&#x5212;&#x5206;&#xFF0C;&#x4ECE;&#x800C;&#x603B;&#x7ED3;&#x51FA;&#x4E0D;&#x540C;&#x7701;&#x4EFD;&#x7528;&#x6237;&#x5BF9;&#x4E0D;&#x540C;&#x5E7F;&#x544A;&#x7684;&#x504F;&#x597D;&#xFF0C;&#x8FD9;&#x6837;&#x66F4;&#x6709;&#x52A9;&#x4E8E;&#x5E7F;&#x544A;&#x7684;&#x7CBE;&#x51C6;&#x6295;&#x653E;&#x3002;</p>
<p><strong>4.3.1**</strong>&#x9875;&#x9762;&#x5E7F;&#x544A;&#x70B9;&#x51FB;&#x91CF;&#x7EDF;&#x8BA1;**</p>
<p>&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x5C31;&#x8FDB;&#x884C;&#x9875;&#x9762;&#x5E7F;&#x544A;&#x6309;&#x7167;&#x7701;&#x4EFD;&#x5212;&#x5206;&#x7684;&#x70B9;&#x51FB;&#x91CF;&#x7684;&#x7EDF;&#x8BA1;&#x3002;&#x5728;src/main/scala&#x4E0B;&#x521B;&#x5EFA;AdStatisticsByGeo.scala&#x6587;&#x4EF6;&#x3002;&#x540C;&#x6837;&#x7531;&#x4E8E;&#x6CA1;&#x6709;&#x73B0;&#x6210;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x6211;&#x4EEC;&#x5B9A;&#x4E49;&#x4E00;&#x4E9B;&#x6D4B;&#x8BD5;&#x6570;&#x636E;&#xFF0C;&#x653E;&#x5728;AdClickLog.csv&#x4E2D;&#xFF0C;&#x7528;&#x6765;&#x751F;&#x6210;&#x7528;&#x6237;&#x70B9;&#x51FB;&#x5E7F;&#x544A;&#x884C;&#x4E3A;&#x7684;&#x4E8B;&#x4EF6;&#x6D41;&#x3002;</p>
<p>&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x6211;&#x4EEC;&#x9996;&#x5148;&#x5B9A;&#x4E49;&#x6E90;&#x6570;&#x636E;&#x7684;&#x6837;&#x4F8B;&#x7C7B;AdClickLog&#xFF0C;&#x4EE5;&#x53CA;&#x8F93;&#x51FA;&#x7EDF;&#x8BA1;&#x6570;&#x636E;&#x7684;&#x6837;&#x4F8B;</p>
<ul>
<li>CountByProvince&#x3002;&#x4E3B;&#x51FD;&#x6570;&#x4E2D;&#x5148;&#x4EE5;province&#x8FDB;&#x884C;keyBy&#xFF0C;&#x7136;&#x540E;&#x5F00;&#x4E00;&#x5C0F;&#x65F6;&#x7684;&#x65F6;&#x95F4;&#x7A97;&#x53E3;&#xFF0C;&#x6ED1;&#x52A8;&#x8DDD;&#x79BB;&#x4E3A;5&#x79D2;&#xFF0C;&#x7EDF;&#x8BA1;&#x7A97;&#x53E3;&#x5185;&#x7684;&#x70B9;&#x51FB;&#x4E8B;&#x4EF6;&#x6570;&#x91CF;&#x3002;&#x5177;&#x4F53;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;&#x5982;&#x4E0B;&#xFF1A;</li>
</ul>
<p><img src="https://uploader.shimo.im/f/sF8lVFZXhlc0HNSU.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p><strong>case class</strong>AdClickLog(userId: Long, adId: Long, province:<strong><strong>String, city:</strong></strong>String,</p>
<p>timestamp: Long)</p>
<p><strong>case class</strong>CountByProvince(windowEnd:<strong><strong>String, province:</strong></strong>String, count: Long)</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/RP9MiRX5zizNUyfK.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><img src="https://uploader.shimo.im/f/LqJRK9lzDX1DeoXa.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><img src="https://uploader.shimo.im/f/61VHNH3myHaknJI6.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p><strong>object</strong>AdStatisticsByGeo {</p>
<p><strong>def</strong>main(args: Array[String]): Unit = {</p>
<p><strong>val</strong>env = StreamExecutionEnvironment.<em>getExecutionEnvironment<em>**</em></em>env.setStreamTimeCharacteristic(TimeCharacteristic.<em>EventTime</em>) env.setParallelism(1)</p>
<p><strong>val</strong>adLogStream: DataStream[AdClickLog] =<strong>**env.readTextFile(</strong>&quot;YOURPATH<strong><strong>\</strong></strong>resources<strong><strong>\</strong></strong>AdClickLog.csv&quot;**)</p>
<p>.map(data =&gt; {</p>
<p><strong>val</strong>dataArray = data.split(<strong>&quot;,&quot;</strong>)</p>
<p><em>AdClickLog</em>(dataArray(0).toLong, dataArray(1).toLong, dataArray(2),</p>
<p>dataArray(3), dataArray(4).toLong)</p>
<p>})</p>
<p>.assignAscendingTimestamps(_.timestamp *1000L)</p>
<p><strong>val</strong>adCountStream = adLogStream</p>
<p>.keyBy(_.province)</p>
<p>.timeWindow(Time.<em>minutes</em>(60), Time.<em>seconds</em>(5))</p>
<p>.aggregate(<strong>new</strong>CountAgg(),<strong>new</strong>CountResult())</p>
<p>.print()</p>
<p>env.execute(<strong>&quot;ad statistics job&quot;</strong>)</p>
<p>}</p>
<p>}</p>
<p><strong>class</strong>CountAgg()<strong>extends</strong>AggregateFunction[AdClickLog, Long, Long]{</p>
<p><strong>override def</strong>add(value: AdClickLog, accumulator: Long): Long = accumulator +<em>**</em>1L</p>
<p><strong>override def</strong>createAccumulator(): Long =<em>**</em>0L</p>
<p><strong>override def</strong>getResult(accumulator: Long): Long = accumulator</p>
<p><strong>override def</strong>merge(a: Long, b: Long): Long = a + b</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/p8Aij0PkR7Us1hOF.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><img src="https://uploader.shimo.im/f/WbZyRemAMCh46TS5.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p>}</p>
<p><strong>class</strong>CountResult()<strong>extends</strong>WindowFunction[Long, CountByProvince,<strong>**String, TimeWindow]{</strong>override def<strong>apply(key:**</strong>String, window: TimeWindow, input:<em>**</em>Iterable[Long], out:</p>
<p>Collector[CountByProvince]): Unit = {</p>
<p>out.collect(<em>CountByProvince</em>(formatTs(window.getEnd), key, input.iterator.next()))</p>
<p>}</p>
<p><strong>private def</strong>formatTs (ts: Long) = {</p>
<p><strong>val</strong>df =<strong>new</strong>SimpleDateFormat (<strong>&quot;yyyy/MM/dd-HH:mm:ss&quot;</strong>)</p>
<p>df.format (<strong>new</strong>Date (ts) )</p>
<p>}</p>
<p>}</p>
<p><strong>4.3.2**</strong>&#x9ED1;&#x540D;&#x5355;&#x8FC7;&#x6EE4;**</p>
<p>&#x4E0A;&#x8282;&#x6211;&#x4EEC;&#x8FDB;&#x884C;&#x7684;&#x70B9;&#x51FB;&#x91CF;&#x7EDF;&#x8BA1;&#xFF0C;&#x540C;&#x4E00;&#x7528;&#x6237;&#x7684;&#x91CD;&#x590D;&#x70B9;&#x51FB;&#x662F;&#x4F1A;&#x53E0;&#x52A0;&#x8BA1;&#x7B97;&#x7684;&#x3002;&#x5728;&#x5B9E;&#x9645;&#x573A;&#x666F;&#x4E2D;&#xFF0C;&#x540C;&#x4E00;&#x7528;&#x6237;&#x786E;&#x5B9E;&#x53EF;&#x80FD;&#x53CD;&#x590D;&#x70B9;&#x5F00;&#x540C;&#x4E00;&#x4E2A;&#x5E7F;&#x544A;&#xFF0C;&#x8FD9;&#x4E5F;&#x8BF4;&#x660E;&#x4E86;&#x7528;&#x6237;&#x5BF9;&#x5E7F;&#x544A;&#x66F4;&#x5927;&#x7684;&#x5174;&#x8DA3;&#xFF1B;&#x4F46;&#x662F;&#x5982;&#x679C;&#x7528;&#x6237;&#x5728;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x975E;&#x5E38;&#x9891;&#x7E41;&#x5730;&#x70B9;&#x51FB;&#x5E7F;&#x544A;&#xFF0C;&#x8FD9;&#x663E;&#x7136;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x6B63;&#x5E38;&#x884C;&#x4E3A;&#xFF0C;&#x6709;&#x5237;&#x70B9;&#x51FB;&#x91CF;&#x7684;&#x5ACC;&#x7591;&#x3002;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5BF9;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x5185;&#xFF08;&#x6BD4;&#x5982;&#x4E00;&#x5929;&#x5185;&#xFF09;&#x7684;&#x7528;&#x6237;&#x70B9;&#x51FB;&#x884C;&#x4E3A;&#x8FDB;&#x884C;&#x7EA6;&#x675F;&#xFF0C;&#x5982;&#x679C;&#x5BF9;&#x540C;&#x4E00;&#x4E2A;&#x5E7F;&#x544A;&#x70B9;&#x51FB;&#x8D85;&#x8FC7;&#x4E00;&#x5B9A;&#x9650;&#x989D;&#xFF08;&#x6BD4;&#x5982;100&#x6B21;&#xFF09;&#xFF0C;&#x5E94;&#x8BE5;&#x628A;&#x8BE5;&#x7528;&#x6237;&#x52A0;&#x5165;&#x9ED1;&#x540D;&#x5355;&#x5E76;&#x62A5;&#x8B66;&#xFF0C;&#x6B64;&#x540E;&#x5176;&#x70B9;&#x51FB;&#x884C;&#x4E3A;&#x4E0D;&#x5E94;&#x8BE5;&#x518D;&#x7EDF;&#x8BA1;&#x3002;</p>
<p>&#x5177;&#x4F53;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="https://uploader.shimo.im/f/bIIsbFN6bvkWmmxF.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p><strong>case class</strong>AdClickLog(userId: Long, adId: Long, province:<strong><strong>String, city:</strong></strong>String,</p>
<p>timestamp: Long)</p>
<p><strong>case class</strong>CountByProvince(windowEnd:<strong><strong>String, province:</strong></strong>String, count: Long)</p>
<p><strong>case class</strong>BlackListWarning(userId: Long, adId: Long, msg:<em>**</em>String)</p>
<p><strong>object</strong>AdStatisticsByGeo {</p>
<p><strong>val*</strong>blackListOutputTag<strong>*</strong>=<strong>new</strong>OutputTag<a href="**%22blacklist%22**">BlackListWarning</a></p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/Gr133DHjSTIrxJ2O.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><img src="https://uploader.shimo.im/f/Y0FWznoHvPPviS8B.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><img src="https://uploader.shimo.im/f/kmQVs2ARIXd5nA1D.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p><strong>def</strong>main(args: Array[String]): Unit = {</p>
<p><strong>val</strong>env = StreamExecutionEnvironment.<em>getExecutionEnvironment</em></p>
<p>env.setStreamTimeCharacteristic(TimeCharacteristic.<em>EventTime</em>)</p>
<p>env.setParallelism(1)</p>
<p><strong>val</strong>adLogStream: DataStream[AdClickLog] =</p>
<p>env.readTextFile(<strong>&quot;D:**</strong>\<strong><strong>Projects</strong></strong>\<strong><strong>BigData</strong></strong>\<strong><strong>UserBehaviorAnalysis</strong></strong>\<strong><strong>MarketAnalysis</strong></strong>\<strong><strong>src</strong></strong>**</p>
<p><strong>**</strong>main<strong><strong>\</strong></strong>resources<strong><strong>\</strong></strong>AdClickLog.csv&quot;**)</p>
<p>.map(data =&gt; {</p>
<p><strong>val</strong>dataArray = data.split(<strong>&quot;,&quot;</strong>)</p>
<p><em>AdClickLog</em>(dataArray(0).toLong, dataArray(1).toLong, dataArray(2),**dataArray(3), dataArray(4).toLong)</p>
<p>})</p>
<p>.assignAscendingTimestamps(_.timestamp *1000L)</p>
<p><strong>val</strong>filterBlackListStream = adLogStream</p>
<p>.keyBy(logData =&gt; (logData.userId, logData.adId))</p>
<p>.process(<strong>new</strong>FilterBlackListUser(100))</p>
<p><strong>val</strong>adCountStream = filterBlackListStream</p>
<p>.keyBy(_.province)</p>
<p>.timeWindow(Time.<em>minutes</em>(60), Time.<em>seconds</em>(5))</p>
<p>.aggregate(<strong>new</strong>countAgg(),<strong>new</strong>countResult())</p>
<p>.print()</p>
<p>filterBlackListStream.getSideOutput(<em>blackListOutputTag</em>)</p>
<p>.print(<strong>&quot;black list&quot;</strong>)</p>
<p>env.execute(<strong>&quot;ad statistics job&quot;</strong>)</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/ajFadFFBSYtGeoic.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><img src="https://uploader.shimo.im/f/bKM4KUU7mvOdk4Xj.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><img src="https://uploader.shimo.im/f/YA0THMVffr3v2IUw.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p>}</p>
<p><strong>class</strong>FilterBlackListUser(maxCount: Long)<strong>extends</strong>KeyedProcessFunction[(Long, Long),</p>
<p>AdClickLog, AdClickLog] {</p>
<ul>
<li><em>&#x4FDD;&#x5B58;&#x5F53;&#x524D;&#x7528;&#x6237;&#x5BF9;&#x5F53;&#x524D;&#x5E7F;&#x544A;&#x7684;&#x70B9;&#x51FB;&#x91CF;</em></li>
</ul>
<p><strong>lazy val*</strong>countState<em>: ValueState[Long] = getRuntimeContext.getState(<em>*new</em></em></p>
<p>ValueStateDescriptor<a href="**%22count-state%22**,*classOf*[Long]">Long</a>)</p>
<ul>
<li><em>&#x6807;&#x8BB0;&#x5F53;&#x524D;&#xFF08;&#x7528;&#x6237;&#xFF0C;&#x5E7F;&#x544A;&#xFF09;&#x4F5C;&#x4E3A;<strong>key</strong>&#x662F;&#x5426;&#x7B2C;&#x4E00;&#x6B21;&#x53D1;&#x9001;&#x5230;&#x9ED1;&#x540D;&#x5355;</em></li>
</ul>
<p><strong>lazy val*</strong>firstSent<em>: ValueState[Boolean] = getRuntimeContext.getState(<em>*new</em></em></p>
<p>ValueStateDescriptor<a href="**%22firstsent-state%22**,*classOf*[Boolean]">Boolean</a>)</p>
<ul>
<li><em>&#x4FDD;&#x5B58;&#x5B9A;&#x65F6;&#x5668;&#x89E6;&#x53D1;&#x7684;&#x65F6;&#x95F4;&#x6233;&#xFF0C;&#x5C4A;&#x65F6;&#x6E05;&#x7A7A;&#x91CD;&#x7F6E;&#x72B6;&#x6001;</em></li>
</ul>
<p><strong>lazy val*</strong>resetTime<em>: ValueState[Long] = getRuntimeContext.getState(<strong>new</strong>ValueStateDescriptor[Long](<strong>&quot;resettime-state&quot;</strong>,</em>classOf*[Long]))</p>
<p><strong>override def</strong>processElement(value: AdClickLog, ctx: KeyedProcessFunction[(Long,</p>
<p>Long), AdClickLog, AdClickLog]#Context, out: Collector[AdClickLog]): Unit = {<strong>val</strong>curCount =<strong>*</strong>countState*.value()</p>
<ul>
<li><em>&#x5982;&#x679C;&#x662F;&#x7B2C;&#x4E00;&#x6B21;&#x5904;&#x7406;&#xFF0C;&#x6CE8;&#x518C;&#x4E00;&#x4E2A;&#x5B9A;&#x65F6;&#x5668;&#xFF0C;&#x6BCF;&#x5929;<strong>00</strong>&#xFF1A;<strong>00</strong>&#x89E6;&#x53D1;&#x6E05;&#x9664;</em></li>
</ul>
<p><strong>if</strong>( curCount ==<strong><strong>0</strong></strong>){</p>
<p><strong>val</strong>ts = (ctx.timerService().currentProcessingTime() / (24<em>60</em>60<em>1000) +<em>**</em>1) </em></p>
<p>(24<em>60</em>60*1000)</p>
<p><em>resetTime</em>.update(ts)</p>
<p>ctx.timerService().registerProcessingTimeTimer(ts)</p>
<p>}</p>
<ul>
<li><em>&#x5982;&#x679C;&#x8BA1;&#x6570;&#x5DF2;&#x7ECF;&#x8D85;&#x8FC7;&#x4E0A;&#x9650;&#xFF0C;&#x5219;&#x52A0;&#x5165;&#x9ED1;&#x540D;&#x5355;&#xFF0C;&#x7528;&#x4FA7;&#x8F93;&#x51FA;&#x6D41;&#x8F93;&#x51FA;&#x62A5;&#x8B66;&#x4FE1;&#x606F;</em></li>
</ul>
<p><strong>if</strong>( curCount &gt; maxCount ){</p>
<p><strong>if</strong>( !<em>firstSent</em>.value() ){</p>
<p><em>firstSent</em>.update(<strong>true</strong>)</p>
<p>ctx.output(<em>blackListOutputTag</em>,<em>BlackListWarning</em>(value.userId, value.adId,</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/udOQAlC0kAoZLbQG.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><img src="https://uploader.shimo.im/f/NNs6FAmsCSqfnCt7.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><img src="https://uploader.shimo.im/f/SEv2tbNEshaZwRa9.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p><strong>&quot;Click over &quot;</strong>+ maxCount +<strong>&quot; times today.&quot;</strong>) )</p>
<p>}</p>
<p><strong>return</strong></p>
<p>}</p>
<ul>
<li><em>&#x70B9;&#x51FB;&#x8BA1;&#x6570;&#x52A0;**1</em></li>
</ul>
<p><em>countState</em>.update(curCount +**1)</p>
<p>out.collect( value )</p>
<p>}</p>
<p><strong>override def</strong>onTimer(timestamp: Long, ctx: KeyedProcessFunction[(Long, Long),</p>
<p>AdClickLog, AdClickLog]#OnTimerContext, out: Collector[AdClickLog]): Unit = {</p>
<p><strong>if</strong>( timestamp ==<strong>*</strong>resetTime*.value() ){</p>
<p><em>firstSent</em>.clear()</p>
<p><em>countState</em>.clear()</p>
<p>}</p>
<p>}</p>
<p>}</p>
<p>}</p>
<p><strong>class</strong>countAgg()<strong>extends</strong>AggregateFunction[AdClickLog, Long, Long] {</p>
<p><strong>override def</strong>add(value: AdClickLog, accumulator: Long): Long = accumulator +<em>**</em>1L</p>
<p><strong>override def</strong>createAccumulator(): Long =<em>**</em>0L</p>
<p><strong>override def</strong>getResult(accumulator: Long): Long = accumulator</p>
<p><strong>override def</strong>merge(a: Long, b: Long): Long = a + b</p>
<p>}</p>
<p><strong>class</strong>countResult()<strong>extends</strong>WindowFunction[Long, CountByProvince,<em>**</em>String, TimeWindow]</p>
<p>{</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/RXwtVZzdnUTVKINv.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><img src="https://uploader.shimo.im/f/61q60YFw1MmeHO1d.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p><strong>override def</strong>apply(key:<strong><strong>String, window: TimeWindow, input:</strong></strong>Iterable[Long], out:</p>
<p>Collector[CountByProvince]): Unit = {</p>
<p>out.collect(<em>CountByProvince</em>(formatTs(window.getEnd), key, input.iterator.next()))</p>
<p>}</p>
<p><strong>private def</strong>formatTs(ts: Long) = {</p>
<p><strong>val</strong>df =<strong>new</strong>SimpleDateFormat(<strong>&quot;yyyy/MM/dd-HH:mm:ss&quot;</strong>)</p>
<p>df.format(<strong>new</strong>Date(ts))</p>
<p>}</p>
<p>}</p>
<p>&#x7B2C;5&#x7AE0; &#x6076;&#x610F;&#x767B;&#x5F55;&#x76D1;&#x63A7;</p>
<p>5.1&#x6A21;&#x5757;&#x521B;&#x5EFA;&#x548C;&#x6570;&#x636E;&#x51C6;&#x5907;</p>
<p>&#x7EE7;&#x7EED;&#x5728;UserBehaviorAnalysis&#x4E0B;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;maven module&#x4F5C;&#x4E3A;&#x5B50;&#x9879;&#x76EE;&#xFF0C;&#x547D;&#x540D;&#x4E3A;LoginFailDetect&#x3002;&#x5728;&#x8FD9;&#x4E2A;&#x5B50;&#x6A21;&#x5757;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x4F1A;&#x7528;&#x5230;flink&#x7684;CEP&#x5E93;&#x6765;&#x5B9E;&#x73B0;&#x4E8B;&#x4EF6;&#x6D41;&#x7684;&#x6A21;&#x5F0F;&#x5339;&#x914D;&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x5728;pom&#x6587;&#x4EF6;&#x4E2D;&#x5F15;&#x5165;CEP&#x7684;&#x76F8;&#x5173;&#x4F9D;&#x8D56;&#xFF1A;</p>
<p><img src="https://uploader.shimo.im/f/p0tYA8k9VIfehy6L.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p>&lt;<strong>dependency</strong>&gt;</p>
<p>&lt;<strong>groupId</strong>&gt;org.apache.flink&lt;/<strong>groupId</strong>&gt;</p>
<p>&lt;<strong>artifactId</strong>&gt;flink-cep-scala_${scala.binary.version}&lt;/<strong>artifactId</strong>&gt;</p>
<p>&lt;<strong>version</strong>&gt;${flink.version}&lt;/<strong>version</strong>&gt;</p>
<p>&lt;/<strong>dependency</strong>&gt;</p>
<p>&#x540C;&#x6837;&#xFF0C;&#x5728;src/main/&#x76EE;&#x5F55;&#x4E0B;&#xFF0C;&#x5C06;&#x9ED8;&#x8BA4;&#x6E90;&#x6587;&#x4EF6;&#x76EE;&#x5F55;java&#x6539;&#x540D;&#x4E3A;scala&#x3002;</p>
<p>5.2&#x4EE3;&#x7801;&#x5B9E;&#x73B0;</p>
<p>&#x5BF9;&#x4E8E;&#x7F51;&#x7AD9;&#x800C;&#x8A00;&#xFF0C;&#x7528;&#x6237;&#x767B;&#x5F55;&#x5E76;&#x4E0D;&#x662F;&#x9891;&#x7E41;&#x7684;&#x4E1A;&#x52A1;&#x64CD;&#x4F5C;&#x3002;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#x77ED;&#x65F6;&#x95F4;&#x5185;&#x9891;&#x7E41;&#x767B;&#x5F55;&#x5931;&#x8D25;&#xFF0C;&#x5C31;&#x6709;&#x53EF;&#x80FD;&#x662F;&#x51FA;&#x73B0;&#x4E86;&#x7A0B;&#x5E8F;&#x7684;&#x6076;&#x610F;&#x653B;&#x51FB;&#xFF0C;&#x6BD4;&#x5982;&#x5BC6;&#x7801;&#x66B4;&#x529B;&#x7834;&#x89E3;&#x3002;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x8003;&#x8651;&#xFF0C;&#x5E94;&#x8BE5;&#x5BF9;&#x7528;&#x6237;&#x7684;&#x767B;&#x5F55;&#x5931;&#x8D25;&#x52A8;&#x4F5C;&#x8FDB;&#x884C;&#x7EDF;&#x8BA1;&#xFF0C;&#x5177;&#x4F53;&#x6765;&#x8BF4;&#xFF0C;&#x5982;&#x679C;&#x540C;&#x4E00;&#x7528;&#x6237;&#xFF08;&#x53EF;&#x4EE5;&#x662F;&#x4E0D;&#x540C;IP&#xFF09;</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/uJC3Pu3gbj1Bx9CN.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<ul>
<li>2&#x79D2;&#x4E4B;&#x5185;&#x8FDE;&#x7EED;&#x4E24;&#x6B21;&#x767B;&#x5F55;&#x5931;&#x8D25;&#xFF0C;&#x5C31;&#x8BA4;&#x4E3A;&#x5B58;&#x5728;&#x6076;&#x610F;&#x767B;&#x5F55;&#x7684;&#x98CE;&#x9669;&#xFF0C;&#x8F93;&#x51FA;&#x76F8;&#x5173;&#x7684;&#x4FE1;&#x606F;&#x8FDB;&#x884C;&#x62A5;&#x8B66;&#x63D0;&#x793A;&#x3002;&#x8FD9;&#x662F;&#x7535;&#x5546;&#x7F51;&#x7AD9;&#x3001;&#x4E5F;&#x662F;&#x51E0;&#x4E4E;&#x6240;&#x6709;&#x7F51;&#x7AD9;&#x98CE;&#x63A7;&#x7684;&#x57FA;&#x672C;&#x4E00;&#x73AF;&#x3002;</li>
</ul>
<p><strong>5.2.1**</strong>&#x72B6;&#x6001;&#x7F16;&#x7A0B;**</p>
<p>&#x7531;&#x4E8E;&#x540C;&#x6837;&#x5F15;&#x5165;&#x4E86;&#x65F6;&#x95F4;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x60F3;&#x5230;&#xFF0C;&#x6700;&#x7B80;&#x5355;&#x7684;&#x65B9;&#x6CD5;&#x5176;&#x5B9E;&#x4E0E;&#x4E4B;&#x524D;&#x7684;&#x70ED;&#x95E8;&#x7EDF;&#x8BA1;&#x7C7B;&#x4F3C;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x6309;&#x7167;&#x7528;&#x6237;ID&#x5206;&#x6D41;&#xFF0C;&#x7136;&#x540E;&#x9047;&#x5230;&#x767B;&#x5F55;&#x5931;&#x8D25;&#x7684;&#x4E8B;&#x4EF6;&#x65F6;&#x5C06;&#x5176;&#x4FDD;&#x5B58;&#x5728;ListState&#x4E2D;&#xFF0C;&#x7136;&#x540E;&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;&#x5B9A;&#x65F6;&#x5668;&#xFF0C;2&#x79D2;&#x540E;&#x89E6;&#x53D1;&#x3002;&#x5B9A;&#x65F6;&#x5668;&#x89E6;&#x53D1;&#x65F6;&#x68C0;&#x67E5;&#x72B6;&#x6001;&#x4E2D;&#x7684;&#x767B;&#x5F55;&#x5931;&#x8D25;&#x4E8B;&#x4EF6;&#x4E2A;&#x6570;&#xFF0C;&#x5982;&#x679C;&#x5927;&#x4E8E;&#x7B49;&#x4E8E;2&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x8F93;&#x51FA;&#x62A5;&#x8B66;&#x4FE1;&#x606F;&#x3002;</p>
<ul>
<li>src/main/scala&#x4E0B;&#x521B;&#x5EFA;LoginFail.scala&#x6587;&#x4EF6;&#xFF0C;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#x5355;&#x4F8B;&#x5BF9;&#x8C61;&#x3002;&#x5B9A;&#x4E49;&#x6837;&#x4F8B;&#x7C7B;</li>
</ul>
<p>LoginEvent&#xFF0C;&#x8FD9;&#x662F;&#x8F93;&#x5165;&#x7684;&#x767B;&#x5F55;&#x4E8B;&#x4EF6;&#x6D41;&#x3002;&#x767B;&#x5F55;&#x6570;&#x636E;&#x672C;&#x5E94;&#x8BE5;&#x4ECE;UserBehavior&#x65E5;&#x5FD7;&#x91CC;&#x63D0;&#x53D6;&#xFF0C;&#x7531;&#x4E8E;UserBehavior.csv&#x4E2D;&#x6CA1;&#x6709;&#x505A;&#x76F8;&#x5173;&#x57CB;&#x70B9;&#xFF0C;&#x6211;&#x4EEC;&#x4ECE;&#x53E6;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;LoginLog.csv&#x4E2D;&#x8BFB;&#x53D6;</p>
<p>&#x767B;&#x5F55;&#x6570;&#x636E;&#x3002;</p>
<p>&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><em>LoginFailDetect/src/main/scala/LoginFail.scala</em></p>
<p><img src="https://uploader.shimo.im/f/ktF31wKydDsGxBFX.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p><strong>case class</strong>LoginEvent(userId: Long, ip:<strong><strong>String, eventType:</strong></strong>String, eventTime: Long)</p>
<p><strong>object</strong>LoginFail {</p>
<p><strong>def</strong>main(args: Array[String]): Unit = {</p>
<p><strong>val</strong>env = StreamExecutionEnvironment.<em>getExecutionEnvironment<em>**</em></em>env.setStreamTimeCharacteristic(TimeCharacteristic.<em>EventTime</em>) env.setParallelism(1)</p>
<p><strong>val</strong>loginEventStream = env.readTextFile(<strong>&quot;YOUR_PATH\resources**</strong>\<strong>**LoginLog.csv&quot;</strong>)</p>
<p>.map( data =&gt; {</p>
<p>val dataArray = data.split(<strong>&quot;,&quot;</strong>)</p>
<p><em>LoginEvent</em>(dataArray(0).toLong, dataArray(1), dataArray(2),**dataArray(3).toLong)</p>
<p>})</p>
<p>.assignTimestampsAndWatermarks(<strong>new</strong></p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/LLe8uvFdcgiEqFEn.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><img src="https://uploader.shimo.im/f/BvlIAaKTs3HPWUOD.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p>BoundedOutOfOrdernessTimestampExtractor[ApacheLogEvent] (Time.<em>milliseconds</em>(3000)) {</p>
<p><strong>override def</strong>extractTimestamp(element: ApacheLogEvent): Long ={<em>**</em>element.eventTime *1000L</p>
<p>}</p>
<p>})</p>
<p>.keyBy(_.userId)</p>
<p>.process(<strong>new</strong>MatchFunction())</p>
<p>.print()</p>
<p>env.execute(<strong>&quot;Login Fail Detect Job&quot;</strong>)</p>
<p>}</p>
<p><strong>class</strong>MatchFunction<strong>extends</strong>KeyedProcessFunction[Long, LoginEvent, LoginEvent] {</p>
<ul>
<li><em>&#x5B9A;&#x4E49;&#x72B6;&#x6001;&#x53D8;&#x91CF;</em></li>
</ul>
<p><strong>lazy val*</strong>loginState<em>: ListState[LoginEvent] = getRuntimeContext.getListState(<strong>new</strong>ListStateDescriptor[LoginEvent](<strong>&quot;saved login&quot;</strong>,<em>**</em></em>classOf*[LoginEvent]))</p>
<p><strong>override def</strong>processElement(login: LoginEvent,</p>
<p>context: KeyedProcessFunction[Long, LoginEvent,</p>
<p>LoginEvent]#Context, out: Collector[LoginEvent]): Unit = {</p>
<p><strong>if</strong>(login.eventType ==<strong>**</strong>&quot;fail&quot;**) {</p>
<p><em>loginState</em>.add(login)</p>
<p>}</p>
<ul>
<li><em>&#x6CE8;&#x518C;&#x5B9A;&#x65F6;&#x5668;&#xFF0C;&#x89E6;&#x53D1;&#x4E8B;&#x4EF6;&#x8BBE;&#x5B9A;&#x4E3A;<strong>2</strong>&#x79D2;&#x540E;</em></li>
</ul>
<p>context.timerService.registerEventTimeTimer(login.eventTime <em>1000+2</em>1000)</p>
<p>}</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/AeEeastuvkHn7dtx.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><img src="https://uploader.shimo.im/f/4etjMgYvJZaIseWW.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p><strong>override def</strong>onTimer(timestamp: Long,</p>
<p>ctx: KeyedProcessFunction[Long, LoginEvent,</p>
<p>LoginEvent]#OnTimerContext, out: Collector[LoginEvent]): Unit = {</p>
<p><strong>val</strong>allLogins: ListBuffer[LoginEvent] = ListBuffer()</p>
<p><strong>import</strong>scala.collection.JavaConversions._</p>
<p><strong>for</strong>(login &lt;-<strong>*</strong>loginState*.get) {</p>
<p>allLogins += login</p>
<p>}</p>
<p><em>loginState</em>.clear()</p>
<p><strong>if</strong>(allLogins.length &gt;<em>**</em>1) {</p>
<p>out.collect(allLogins.head)</p>
<p>}</p>
<p>}</p>
<p>}</p>
<p>}</p>
<p><strong>5.2.2**</strong>&#x72B6;&#x6001;&#x7F16;&#x7A0B;&#x7684;&#x6539;&#x8FDB;**</p>
<p>&#x4E0A;&#x4E00;&#x8282;&#x7684;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;&#x4E2D;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x76F4;&#x63A5;&#x628A;&#x6BCF;&#x6B21;&#x767B;&#x5F55;&#x5931;&#x8D25;&#x7684;&#x6570;&#x636E;&#x5B58;&#x8D77;&#x6765;&#x3001;&#x8BBE;&#x7F6E;&#x5B9A;&#x65F6;&#x5668;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x540E;&#x518D;&#x8BFB;&#x53D6;&#xFF0C;&#x8FD9;&#x79CD;&#x505A;&#x6CD5;&#x5C3D;&#x7BA1;&#x7B80;&#x5355;&#xFF0C;&#x4F46;&#x548C;&#x6211;&#x4EEC;&#x5F00;&#x59CB;&#x7684;&#x9700;&#x6C42;&#x8FD8;&#x662F;&#x7565;&#x6709;&#x5DEE;&#x5F02;&#x7684;&#x3002;&#x8FD9;&#x79CD;&#x505A;&#x6CD5;&#x53EA;&#x80FD;&#x9694;2&#x79D2;&#x4E4B;&#x540E;&#x53BB;&#x5224;&#x65AD;&#x4E00;&#x4E0B;&#x8FD9;&#x671F;&#x95F4;&#x662F;&#x5426;&#x6709;&#x591A;&#x6B21;&#x5931;&#x8D25;&#x767B;&#x5F55;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5728;&#x4E00;&#x6B21;&#x767B;&#x5F55;&#x5931;&#x8D25;&#x4E4B;&#x540E;&#x3001;&#x518D;&#x4E00;&#x6B21;&#x767B;&#x5F55;&#x5931;&#x8D25;&#x65F6;&#x5C31;&#x7ACB;&#x523B;&#x62A5;&#x8B66;&#x3002;&#x8FD9;&#x4E2A;&#x9700;&#x6C42;&#x5982;&#x679C;&#x4E25;&#x683C;&#x5B9E;&#x73B0;&#x8D77;&#x6765;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;&#x8981;&#x5224;&#x65AD;&#x4EFB;&#x610F;&#x7D27;&#x90BB;&#x7684;&#x4E8B;&#x4EF6;&#xFF0C;&#x662F;&#x5426;&#x7B26;&#x5408;&#x67D0;&#x79CD;&#x6A21;&#x5F0F;&#x3002;</p>
<p>&#x4E8E;&#x662F;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x60F3;&#x5230;&#xFF0C;&#x8FD9;&#x4E2A;&#x9700;&#x6C42;&#x5176;&#x5B9E;&#x53EF;&#x4EE5;&#x4E0D;&#x7528;&#x5B9A;&#x65F6;&#x5668;&#x89E6;&#x53D1;&#xFF0C;&#x76F4;&#x63A5;&#x5728;&#x72B6;&#x6001;&#x4E2D;&#x5B58;&#x53D6;&#x4E0A;&#x4E00;&#x6B21;&#x767B;&#x5F55;&#x5931;&#x8D25;&#x7684;&#x4E8B;&#x4EF6;&#xFF0C;&#x6BCF;&#x6B21;&#x90FD;&#x505A;&#x5224;&#x65AD;&#x548C;&#x6BD4;&#x5BF9;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x6700;&#x521D;&#x7684;&#x9700;&#x6C42;&#x3002;</p>
<p>&#x4E0A;&#x8282;&#x7684;&#x4EE3;&#x7801;MatchFunction&#x4E2D;&#x5220;&#x6389;onTimer&#xFF0C;processElement&#x6539;&#x4E3A;&#xFF1A;</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/vSMbDDPqUTAr23sA.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><img src="https://uploader.shimo.im/f/jgULgC8ubkyK8QTt.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p><strong>override def</strong>processElement(value: LoginEvent, ctx: KeyedProcessFunction[Long,</p>
<p>LoginEvent, Warning]#Context, out: Collector[Warning]): Unit = {</p>
<ul>
<li><em>&#x9996;&#x5148;&#x6309;&#x7167;<strong>type</strong>&#x505A;&#x7B5B;&#x9009;&#xFF0C;&#x5982;&#x679C;<strong>success</strong>&#x76F4;&#x63A5;&#x6E05;&#x7A7A;&#xFF0C;&#x5982;&#x679C;<strong>fail</strong>&#x518D;&#x505A;&#x5904;&#x7406;</em></li>
</ul>
<p><strong>if</strong>( value.eventType ==<strong>**</strong>&quot;fail&quot;<strong>**</strong>){</p>
<ul>
<li><em>&#x5982;&#x679C;&#x5DF2;&#x7ECF;&#x6709;&#x767B;&#x5F55;&#x5931;&#x8D25;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x5224;&#x65AD;&#x662F;&#x5426;&#x5728;&#x4E24;&#x79D2;&#x5185;</em></li>
</ul>
<p><strong>val</strong>iter =<strong>*</strong>loginState*.get().iterator()</p>
<p><strong>if</strong>( iter.hasNext ){</p>
<p><strong>val</strong>firstFail = iter.next()</p>
<ul>
<li><em>&#x5982;&#x679C;&#x4E24;&#x6B21;&#x767B;&#x5F55;&#x5931;&#x8D25;&#x65F6;&#x95F4;&#x95F4;&#x9694;&#x5C0F;&#x4E8E;<strong>2</strong>&#x79D2;&#xFF0C;&#x8F93;&#x51FA;&#x62A5;&#x8B66;</em></li>
</ul>
<p><strong>if</strong>( value.eventTime &lt; firstFail.eventTime +<strong><strong>2</strong></strong>){</p>
<p>out.collect(<em>Warning</em>( value.userId, firstFail.eventTime, value.eventTime,<strong>&quot;login fail in 2 seconds.&quot;</strong>) )</p>
<p>}</p>
<ul>
<li><em>&#x628A;&#x6700;&#x8FD1;&#x4E00;&#x6B21;&#x7684;&#x767B;&#x5F55;&#x5931;&#x8D25;&#x6570;&#x636E;&#xFF0C;&#x66F4;&#x65B0;&#x5199;&#x5165;<strong>state</strong>&#x4E2D;</em></li>
</ul>
<p><strong>val</strong>failList =<strong>new</strong>util.ArrayList<a href="">LoginEvent</a></p>
<p>failList.add(value)</p>
<p><em>loginState</em>.update( failList )</p>
<p>}<strong>else</strong>{</p>
<ul>
<li><em>&#x5982;&#x679C;<strong>state</strong>&#x4E2D;&#x6CA1;&#x6709;&#x767B;&#x5F55;&#x5931;&#x8D25;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x90A3;&#x5C31;&#x76F4;&#x63A5;&#x6DFB;&#x52A0;&#x8FDB;&#x53BB;</em></li>
</ul>
<p><em>loginState</em>.add(value)</p>
<p>}</p>
<p>}<strong>else*</strong>loginState*.clear()</p>
<p>}</p>
<p><strong>5.2.3 CEP**</strong>&#x7F16;&#x7A0B;**</p>
<p>&#x4E0A;&#x4E00;&#x8282;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x5BF9;&#x72B6;&#x6001;&#x7F16;&#x7A0B;&#x7684;&#x6539;&#x8FDB;&#xFF0C;&#x53BB;&#x6389;&#x4E86;&#x5B9A;&#x65F6;&#x5668;&#xFF0C;&#x5728;process function&#x4E2D;&#x505A;&#x4E86;&#x66F4;&#x591A;&#x7684;&#x903B;&#x8F91;&#x5904;&#x7406;&#xFF0C;&#x5B9E;&#x73B0;&#x4E86;&#x6700;&#x521D;&#x7684;&#x9700;&#x6C42;&#x3002;&#x4E0D;&#x8FC7;&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x91CC;&#x6709;&#x5F88;&#x591A;&#x7684;&#x6761;&#x4EF6;&#x5224;&#x65AD;&#xFF0C;&#x800C;&#x6211;&#x4EEC;&#x76EE;&#x524D;&#x4EC5;&#x4EC5;&#x5B9E;&#x73B0;&#x7684;&#x662F;&#x68C0;&#x6D4B;&#x201C;&#x8FDE;&#x7EED;2&#x6B21;&#x767B;&#x5F55;&#x5931;&#x8D25;&#x201D;&#xFF0C;&#x8FD9;&#x662F;&#x6700;&#x7B80;&#x5355;&#x7684;&#x60C5;&#x5F62;&#x3002;&#x5982;&#x679C;&#x9700;&#x8981;&#x68C0;&#x6D4B;</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/bYxYczOZR4xRUzfq.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p>&#x66F4;&#x591A;&#x6B21;&#xFF0C;&#x5185;&#x90E8;&#x903B;&#x8F91;&#x663E;&#x7136;&#x4F1A;&#x53D8;&#x5F97;&#x975E;&#x5E38;&#x590D;&#x6742;&#x3002;&#x90A3;&#x6709;&#x4EC0;&#x4E48;&#x65B9;&#x5F0F;&#x53EF;&#x4EE5;&#x65B9;&#x4FBF;&#x5730;&#x5B9E;&#x73B0;&#x5462;&#xFF1F;</p>
<p>&#x5F88;&#x5E78;&#x8FD0;&#xFF0C;flink&#x4E3A;&#x6211;&#x4EEC;&#x63D0;&#x4F9B;&#x4E86;CEP&#xFF08;Complex Event Processing&#xFF0C;&#x590D;&#x6742;&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#xFF09;&#x5E93;&#xFF0C;&#x7528;&#x4E8E;&#x5728;&#x6D41;&#x4E2D;&#x7B5B;&#x9009;&#x7B26;&#x5408;&#x67D0;&#x79CD;&#x590D;&#x6742;&#x6A21;&#x5F0F;&#x7684;&#x4E8B;&#x4EF6;&#x3002;&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x5C31;&#x57FA;&#x4E8E;CEP&#x6765;&#x5B8C;&#x6210;&#x8FD9;&#x4E2A;&#x6A21;&#x5757;&#x7684;&#x5B9E;&#x73B0;&#x3002;</p>
<ul>
<li>src/main/scala&#x4E0B;&#x7EE7;&#x7EED;&#x521B;&#x5EFA;LoginFailWithCep.scala&#x6587;&#x4EF6;&#xFF0C;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#x5355;&#x4F8B;&#x5BF9;&#x8C61;&#x3002;&#x6837;&#x4F8B;&#x7C7B;LoginEvent&#x7531;&#x4E8E;&#x5728;LoginFail.scala&#x5DF2;&#x7ECF;&#x5B9A;&#x4E49;&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x540C;&#x4E00;&#x4E2A;&#x6A21;&#x5757;&#x4E2D;&#x5C31;&#x4E0D;&#x9700;&#x8981;&#x518D;&#x5B9A;&#x4E49;&#x4E86;&#x3002;</li>
</ul>
<p>&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><em>LoginFailDetect/src/main/scala/LoginFailWithCep.scala</em></p>
<p><img src="https://uploader.shimo.im/f/WlK2uSAPkYTa5hoi.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p><strong>object</strong>LoginFailWithCep {</p>
<p><strong>def</strong>main(args: Array[String]): Unit = {</p>
<p><strong>val</strong>env = StreamExecutionEnvironment.<em>getExecutionEnvironment<em>**</em></em>env.setStreamTimeCharacteristic(TimeCharacteristic.<em>EventTime</em>) env.setParallelism(1)</p>
<p><strong>val</strong>loginEventStream = env.readTextFile(<strong>&quot;YOUR_PATH\resources**</strong>\<strong>**LoginLog.csv&quot;</strong>)</p>
<p>.map( data =&gt; {</p>
<p>val dataArray = data.split(<strong>&quot;,&quot;</strong>)</p>
<p><em>LoginEvent</em>(dataArray(0).toLong, dataArray(1), dataArray(2),**dataArray(3).toLong)</p>
<p>})</p>
<p>.assignTimestampsAndWatermarks(<strong>new</strong>BoundedOutOfOrdernessTimestampExtractor[ApacheLogEvent] (Time.<em>milliseconds</em>(3000)) {</p>
<p><strong>override def</strong>extractTimestamp(element: ApacheLogEvent): Long ={<em>**</em>element.eventTime *1000L</p>
<p>}</p>
<p>})</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/Yc1MsBVP5rSh6TOP.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><img src="https://uploader.shimo.im/f/w4QCVamFos9d1B1V.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<ul>
<li><em>&#x5B9A;&#x4E49;&#x5339;&#x914D;&#x6A21;&#x5F0F;</em></li>
</ul>
<p><strong>val</strong>loginFailPattern = Pattern.<em>begin</em><a href="**%22begin%22**">LoginEvent</a></p>
<p>.where(_.eventType ==<strong>&quot;fail&quot;</strong>)</p>
<p>.next(<strong>&quot;next&quot;</strong>)</p>
<p>.where(_.eventType ==<strong>&quot;fail&quot;</strong>)</p>
<p>.within(Time.<em>seconds</em>(2))</p>
<ul>
<li><em>&#x5728;&#x6570;&#x636E;&#x6D41;&#x4E2D;&#x5339;&#x914D;&#x51FA;&#x5B9A;&#x4E49;&#x597D;&#x7684;&#x6A21;&#x5F0F;</em></li>
</ul>
<p><strong>val</strong>patternStream = CEP.<em>pattern</em>(loginEventStream.keyBy(_.userId),<em>**</em>loginFailPattern)</p>
<p><em>// .select<strong>&#x65B9;&#x6CD5;&#x4F20;&#x5165;&#x4E00;&#x4E2A;</strong>pattern select function<strong>&#xFF0C;&#x5F53;&#x68C0;&#x6D4B;&#x5230;&#x5B9A;&#x4E49;&#x597D;&#x7684;&#x6A21;&#x5F0F;&#x5E8F;&#x5217;&#x65F6;&#x5C31;&#x4F1A;&#x8C03;&#x7528;**</strong></em>val**loginFailDataStream = patternStream</p>
<p>.select((pattern: Map[String,Iterable[LoginEvent]]) =&gt; {</p>
<p><strong>val</strong>first = pattern.getOrElse(<strong>&quot;begin&quot;</strong>,<strong>null</strong>).iterator.next()</p>
<p><strong>val</strong>second = pattern.getOrElse(<strong>&quot;next&quot;</strong>,<strong>null</strong>).iterator.next()</p>
<p>(second.userId, second.ip, second.eventType)</p>
<p>})</p>
<ul>
<li><em>&#x5C06;&#x5339;&#x914D;&#x5230;&#x7684;&#x7B26;&#x5408;&#x6761;&#x4EF6;&#x7684;&#x4E8B;&#x4EF6;&#x6253;&#x5370;&#x51FA;&#x6765;</em></li>
</ul>
<p>loginFailDataStream.print()</p>
<p>env.execute(<strong>&quot;Login Fail Detect Job&quot;</strong>)</p>
<p>}</p>
<p>}</p>
<p>&#x7B2C;6&#x7AE0; &#x8BA2;&#x5355;&#x652F;&#x4ED8;&#x5B9E;&#x65F6;&#x76D1;&#x63A7;</p>
<p>&#x5728;&#x7535;&#x5546;&#x7F51;&#x7AD9;&#x4E2D;&#xFF0C;&#x8BA2;&#x5355;&#x7684;&#x652F;&#x4ED8;&#x4F5C;&#x4E3A;&#x76F4;&#x63A5;&#x4E0E;&#x8425;&#x9500;&#x6536;&#x5165;&#x6302;&#x94A9;&#x7684;&#x4E00;&#x73AF;&#xFF0C;&#x5728;&#x4E1A;&#x52A1;&#x6D41;&#x7A0B;&#x4E2D;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x3002;&#x5BF9;&#x4E8E;&#x8BA2;&#x5355;&#x800C;&#x8A00;&#xFF0C;&#x4E3A;&#x4E86;&#x6B63;&#x786E;&#x63A7;&#x5236;&#x4E1A;&#x52A1;&#x6D41;&#x7A0B;&#xFF0C;&#x4E5F;&#x4E3A;&#x4E86;&#x589E;&#x52A0;&#x7528;&#x6237;&#x7684;&#x652F;&#x4ED8;&#x610F;&#x613F;&#xFF0C;&#x7F51;&#x7AD9;&#x4E00;&#x822C;&#x4F1A;&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;&#x652F;&#x4ED8;&#x5931;&#x6548;&#x65F6;&#x95F4;&#xFF0C;&#x8D85;&#x8FC7;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x4E0D;&#x652F;&#x4ED8;&#x7684;&#x8BA2;&#x5355;&#x5C31;&#x4F1A;&#x88AB;&#x53D6;&#x6D88;&#x3002;&#x53E6;&#x5916;&#xFF0C;</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/ePD8cHTrE3h1LESx.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p>&#x5BF9;&#x4E8E;&#x8BA2;&#x5355;&#x7684;&#x652F;&#x4ED8;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x5E94;&#x4FDD;&#x8BC1;&#x7528;&#x6237;&#x652F;&#x4ED8;&#x7684;&#x6B63;&#x786E;&#x6027;&#xFF0C;&#x8FD9;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x7B2C;&#x4E09;&#x65B9;&#x652F;&#x4ED8;&#x5E73;&#x53F0;&#x7684;&#x4EA4;&#x6613;&#x6570;&#x636E;&#x6765;&#x505A;&#x4E00;&#x4E2A;&#x5B9E;&#x65F6;&#x5BF9;&#x8D26;&#x3002;&#x5728;&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x5185;&#x5BB9;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x5B9E;&#x73B0;&#x8FD9;&#x4E24;&#x4E2A;&#x9700;&#x6C42;&#x3002;</p>
<p>6.1&#x6A21;&#x5757;&#x521B;&#x5EFA;&#x548C;&#x6570;&#x636E;&#x51C6;&#x5907;</p>
<p>&#x540C;&#x6837;&#x5730;&#xFF0C;&#x5728;UserBehaviorAnalysis&#x4E0B;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;maven module&#x4F5C;&#x4E3A;&#x5B50;&#x9879;&#x76EE;&#xFF0C;&#x547D;&#x540D;</p>
<ul>
<li>OrderTimeoutDetect&#x3002;&#x5728;&#x8FD9;&#x4E2A;&#x5B50;&#x6A21;&#x5757;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x540C;&#x6837;&#x5C06;&#x4F1A;&#x7528;&#x5230;flink&#x7684;CEP&#x5E93;&#x6765;&#x5B9E;&#x73B0;&#x4E8B;&#x4EF6;&#x6D41;&#x7684;&#x6A21;&#x5F0F;&#x5339;&#x914D;&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x5728;pom&#x6587;&#x4EF6;&#x4E2D;&#x5F15;&#x5165;CEP&#x7684;&#x76F8;&#x5173;&#x4F9D;&#x8D56;&#xFF1A;</li>
</ul>
<p><img src="https://uploader.shimo.im/f/jUqDESfnVO9BkriF.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p>&lt;<strong>dependency</strong>&gt;</p>
<p>&lt;<strong>groupId</strong>&gt;org.apache.flink&lt;/<strong>groupId</strong>&gt;</p>
<p>&lt;<strong>artifactId</strong>&gt;flink-cep-scala_${scala.binary.version}&lt;/<strong>artifactId</strong>&gt;</p>
<p>&lt;<strong>version</strong>&gt;${flink.version}&lt;/<strong>version</strong>&gt;</p>
<p>&lt;/<strong>dependency</strong>&gt;</p>
<p>&#x540C;&#x6837;&#xFF0C;&#x5728;src/main/&#x76EE;&#x5F55;&#x4E0B;&#xFF0C;&#x5C06;&#x9ED8;&#x8BA4;&#x6E90;&#x6587;&#x4EF6;&#x76EE;&#x5F55;java&#x6539;&#x540D;&#x4E3A;scala&#x3002;</p>
<p>6.2&#x4EE3;&#x7801;&#x5B9E;&#x73B0;</p>
<p>&#x5728;&#x7535;&#x5546;&#x5E73;&#x53F0;&#x4E2D;&#xFF0C;&#x6700;&#x7EC8;&#x521B;&#x9020;&#x6536;&#x5165;&#x548C;&#x5229;&#x6DA6;&#x7684;&#x662F;&#x7528;&#x6237;&#x4E0B;&#x5355;&#x8D2D;&#x4E70;&#x7684;&#x73AF;&#x8282;&#xFF1B;&#x66F4;&#x5177;&#x4F53;&#x4E00;&#x70B9;&#xFF0C;&#x662F;&#x7528;&#x6237;&#x771F;&#x6B63;&#x5B8C;&#x6210;&#x652F;&#x4ED8;&#x52A8;&#x4F5C;&#x7684;&#x65F6;&#x5019;&#x3002;&#x7528;&#x6237;&#x4E0B;&#x5355;&#x7684;&#x884C;&#x4E3A;&#x53EF;&#x4EE5;&#x8868;&#x660E;&#x7528;&#x6237;&#x5BF9;&#x5546;&#x54C1;&#x7684;&#x9700;&#x6C42;&#xFF0C;&#x4F46;&#x5728;&#x73B0;&#x5B9E;&#x4E2D;&#xFF0C;&#x5E76;&#x4E0D;&#x662F;&#x6BCF;&#x6B21;&#x4E0B;&#x5355;&#x90FD;&#x4F1A;&#x88AB;&#x7528;&#x6237;&#x7ACB;&#x523B;&#x652F;&#x4ED8;&#x3002;&#x5F53;&#x62D6;&#x5EF6;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x540E;&#xFF0C;&#x7528;&#x6237;&#x652F;&#x4ED8;&#x7684;&#x610F;&#x613F;&#x4F1A;&#x964D;&#x4F4E;&#x3002;&#x6240;&#x4EE5;&#x4E3A;&#x4E86;&#x8BA9;&#x7528;&#x6237;&#x66F4;&#x6709;&#x7D27;&#x8FEB;&#x611F;&#x4ECE;&#x800C;&#x63D0;&#x9AD8;&#x652F;&#x4ED8;&#x8F6C;&#x5316;&#x7387;&#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x4E3A;&#x4E86;&#x9632;&#x8303;&#x8BA2;&#x5355;&#x652F;&#x4ED8;&#x73AF;&#x8282;&#x7684;&#x5B89;&#x5168;&#x98CE;&#x9669;&#xFF0C;&#x7535;&#x5546;&#x7F51;&#x7AD9;&#x5F80;&#x5F80;&#x4F1A;&#x5BF9;&#x8BA2;&#x5355;&#x72B6;&#x6001;&#x8FDB;&#x884C;&#x76D1;&#x63A7;&#xFF0C;&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;&#x5931;&#x6548;&#x65F6;&#x95F4;&#xFF08;&#x6BD4;&#x5982;15&#x5206;&#x949F;&#xFF09;&#xFF0C;&#x5982;&#x679C;&#x4E0B;&#x5355;&#x540E;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x4ECD;&#x672A;&#x652F;&#x4ED8;&#xFF0C;&#x8BA2;&#x5355;&#x5C31;&#x4F1A;&#x88AB;&#x53D6;&#x6D88;&#x3002;</p>
<p><strong>6.2.1**</strong>&#x4F7F;&#x7528;<strong><strong>CEP</strong></strong>&#x5B9E;&#x73B0;**</p>
<p>&#x6211;&#x4EEC;&#x9996;&#x5148;&#x8FD8;&#x662F;&#x5229;&#x7528;CEP&#x5E93;&#x6765;&#x5B9E;&#x73B0;&#x8FD9;&#x4E2A;&#x529F;&#x80FD;&#x3002;&#x6211;&#x4EEC;&#x5148;&#x5C06;&#x4E8B;&#x4EF6;&#x6D41;&#x6309;&#x7167;&#x8BA2;&#x5355;&#x53F7;orderId&#x5206;&#x6D41;&#xFF0C;&#x7136;&#x540E;&#x5B9A;&#x4E49;&#x8FD9;&#x6837;&#x7684;&#x4E00;&#x4E2A;&#x4E8B;&#x4EF6;&#x6A21;&#x5F0F;&#xFF1A;&#x5728;15&#x5206;&#x949F;&#x5185;&#xFF0C;&#x4E8B;&#x4EF6;&#x201C;create&#x201D;&#x4E0E;&#x201C;pay&#x201D;&#x975E;&#x4E25;&#x683C;&#x7D27;&#x90BB;&#xFF1A;</p>
<p>valorderPayPattern = Pattern.begin<a href="%22begin%22">OrderEvent</a></p>
<p>.where(_.eventType ==&quot;create&quot;)</p>
<p>.followedBy(&quot;follow&quot;)</p>
<p>.where(_.eventType ==&quot;pay&quot;)</p>
<p>.within(Time.seconds(5))</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/KRdondG14J0vuCEw.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p>&#x8FD9;&#x6837;&#x8C03;&#x7528;.select&#x65B9;&#x6CD5;&#x65F6;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x540C;&#x65F6;&#x83B7;&#x53D6;&#x5230;&#x5339;&#x914D;&#x51FA;&#x7684;&#x4E8B;&#x4EF6;&#x548C;&#x8D85;&#x65F6;&#x672A;&#x5339;&#x914D;&#x7684;&#x4E8B;&#x4EF6;</p>
<p>&#x4E86;&#x3002;</p>
<pre class="language-"><code>* src/main/scala&#x4E0B;&#x7EE7;&#x7EED;&#x521B;&#x5EFA;OrderTimeout.scala&#x6587;&#x4EF6;&#xFF0C;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#x5355;&#x4F8B;&#x5BF9;&#x8C61;&#x3002;&#x5B9A;&#x4E49;&#x6837;&#x4F8B;&#x7C7B;OrderEvent&#xFF0C;&#x8FD9;&#x662F;&#x8F93;&#x5165;&#x7684;&#x8BA2;&#x5355;&#x4E8B;&#x4EF6;&#x6D41;&#xFF1B;&#x53E6;&#x5916;&#x8FD8;&#x6709;OrderResult&#xFF0C;&#x8FD9;&#x662F;&#x8F93;&#x51FA;&#x663E;
</code></pre><ul>
<li>&#x7684;&#x8BA2;&#x5355;&#x72B6;&#x6001;&#x7ED3;&#x679C;&#x3002;&#x8BA2;&#x5355;&#x6570;&#x636E;&#x4E5F;&#x672C;&#x5E94;&#x8BE5;&#x4ECE;UserBehavior&#x65E5;&#x5FD7;&#x91CC;&#x63D0;&#x53D6;&#xFF0C;&#x7531;&#x4E8E;</li>
</ul>
<p>UserBehavior.csv&#x4E2D;&#x6CA1;&#x6709;&#x505A;&#x76F8;&#x5173;&#x57CB;&#x70B9;&#xFF0C;&#x6211;&#x4EEC;&#x4ECE;&#x53E6;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;OrderLog.csv&#x4E2D;&#x8BFB;&#x53D6;&#x767B;&#x5F55;&#x6570;</p>
<p>&#x636E;&#x3002;</p>
<p>&#x5B8C;&#x6574;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><em>OrderTimeoutDetect/src/main/scala/OrderTimeout.scala</em></p>
<p><img src="https://uploader.shimo.im/f/LnL0CofGXjuX8mWJ.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p><strong>case class</strong>OrderEvent(orderId: Long, eventType:<em>**</em>String, eventTime: Long)</p>
<p><strong>case class</strong>OrderResult(orderId: Long, eventType:<em>**</em>String)</p>
<p><strong>object</strong>OrderTimeout {</p>
<p><strong>def</strong>main(args: Array[String]): Unit = {</p>
<p><strong>val</strong>env = StreamExecutionEnvironment.<em>getExecutionEnvironment</em></p>
<p>env.setParallelism(1)</p>
<p>env.setStreamTimeCharacteristic(TimeCharacteristic.<em>EventTime</em>)</p>
<p><strong>val</strong>orderEventStream = env.readTextFile(<strong>&quot;YOUR_PATH\resources**</strong>\<strong>**OrderLog.csv&quot;</strong>)</p>
<p>.map( data =&gt; {</p>
<p>val dataArray = data.split(<strong>&quot;,&quot;</strong>)</p>
<p><em>OrderEvent</em>(dataArray(0).toLong, dataArray(1), dataArray(3).toLong)</p>
<p>})</p>
<p>.assignAscendingTimestamps(_.eventTime *1000)</p>
<ul>
<li><em>&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x5E26;&#x5339;&#x914D;&#x65F6;&#x95F4;&#x7A97;&#x53E3;&#x7684;&#x6A21;&#x5F0F;</em></li>
</ul>
<p><strong>val</strong>orderPayPattern = Pattern.<em>begin</em><a href="**%22begin%22**">OrderEvent</a></p>
<p>.where(_.eventType ==<strong>&quot;create&quot;</strong>)</p>
<p>.followedBy(<strong>&quot;follow&quot;</strong>)</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/5fhxhai6mQ4leVtC.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><img src="https://uploader.shimo.im/f/vaDppMFhM3dFYL7O.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><img src="https://uploader.shimo.im/f/pSh9ZTzbabt6rPzs.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p>.where(_.eventType ==<strong>&quot;pay&quot;</strong>)</p>
<p>.within(Time.<em>minutes</em>(15))</p>
<ul>
<li><em>&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x8F93;&#x51FA;&#x6807;&#x7B7E;</em></li>
</ul>
<p><strong>val</strong>orderTimeoutOutput =<strong>*</strong>OutputTag<em>[OrderResult](<em>*&quot;orderTimeout&quot;</em></em>)</p>
<ul>
<li><em>&#x8BA2;&#x5355;&#x4E8B;&#x4EF6;&#x6D41;&#x6839;&#x636E;<strong>orderId</strong>&#x5206;&#x6D41;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x6BCF;&#x4E00;&#x6761;&#x6D41;&#x4E2D;&#x5339;&#x914D;&#x51FA;&#x5B9A;&#x4E49;&#x597D;&#x7684;&#x6A21;&#x5F0F;</em></li>
</ul>
<p><strong>val</strong>patternStream = CEP.<em>pattern</em>(orderEventStream.keyBy(<strong>&quot;orderId&quot;</strong>),</p>
<p>orderPayPattern)</p>
<p><strong>val</strong>completedResult = patternStream.select(orderTimeoutOutput) {</p>
<ul>
<li><em>&#x5BF9;&#x4E8E;&#x5DF2;&#x8D85;&#x65F6;&#x7684;&#x90E8;&#x5206;&#x6A21;&#x5F0F;&#x5339;&#x914D;&#x7684;&#x4E8B;&#x4EF6;&#x5E8F;&#x5217;&#xFF0C;&#x4F1A;&#x8C03;&#x7528;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;</em></li>
</ul>
<p>(pattern: Map[String,Iterable[OrderEvent]], timestamp: Long) =&gt; {</p>
<p><strong>val</strong>createOrder = pattern.get(<strong>&quot;begin&quot;</strong>)</p>
<p><em>OrderResult</em>(createOrder.get.iterator.next().orderId,<strong>**&quot;timeout&quot;</strong>)</p>
<p>}</p>
<p>} {</p>
<pre class="language-"><code>* *&#x68C0;&#x6D4B;&#x5230;&#x5B9A;&#x4E49;&#x597D;&#x7684;&#x6A21;&#x5F0F;&#x5E8F;&#x5217;&#x65F6;&#xFF0C;&#x5C31;&#x4F1A;&#x8C03;&#x7528;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;*
</code></pre><p>pattern: Map[String,Iterable[OrderEvent]] =&gt; {</p>
<p><strong>val</strong>payOrder = pattern.get(<strong>&quot;follow&quot;</strong>)</p>
<p><em>OrderResult</em>(payOrder.get.iterator.next().orderId,<strong>**&quot;success&quot;</strong>)</p>
<p>}</p>
<p>}</p>
<ul>
<li><em>&#x62FF;&#x5230;&#x540C;&#x4E00;&#x8F93;&#x51FA;&#x6807;&#x7B7E;&#x4E2D;&#x7684;<strong>timeout</strong>&#x5339;&#x914D;&#x7ED3;&#x679C;&#xFF08;&#x6D41;&#xFF09;</em></li>
</ul>
<p><strong>val</strong>timeoutResult = completedResult.getSideOutput(orderTimeoutOutput)</p>
<p>completedResult.print()</p>
<p>timeoutResult.print()</p>
<p>env.execute(<strong>&quot;Order Timeout Detect Job&quot;</strong>)</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/wY2sY8ckkVbrmM80.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><img src="https://uploader.shimo.im/f/d6wDhF0ff1kkxmx4.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p>}</p>
<p>}</p>
<p><strong>6.2.2**</strong>&#x4F7F;&#x7528;<strong><strong>Process Function</strong></strong>&#x5B9E;&#x73B0;**</p>
<p>&#x6211;&#x4EEC;&#x540C;&#x6837;&#x53EF;&#x4EE5;&#x5229;&#x7528;Process Function&#xFF0C;&#x81EA;&#x5B9A;&#x4E49;&#x5B9E;&#x73B0;&#x68C0;&#x6D4B;&#x8BA2;&#x5355;&#x8D85;&#x65F6;&#x7684;&#x529F;&#x80FD;&#x3002;&#x4E3A;&#x4E86;&#x7B80;&#x5316;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x8003;&#x8651;&#x8D85;&#x65F6;&#x62A5;&#x8B66;&#x7684;&#x60C5;&#x5F62;&#xFF0C;&#x5728;pay&#x4E8B;&#x4EF6;&#x8D85;&#x65F6;&#x672A;&#x53D1;&#x751F;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8F93;&#x51FA;&#x8D85;&#x65F6;&#x62A5;&#x8B66;&#x4FE1;&#x606F;&#x3002;</p>
<p>&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x601D;&#x8DEF;&#x662F;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x8BA2;&#x5355;&#x7684;create&#x4E8B;&#x4EF6;&#x5230;&#x6765;&#x540E;&#x6CE8;&#x518C;&#x5B9A;&#x65F6;&#x5668;&#xFF0C;15&#x5206;&#x949F;&#x540E;&#x89E6;&#x53D1;&#xFF1B;&#x7136;&#x540E;&#x518D;&#x7528;&#x4E00;&#x4E2A;&#x5E03;&#x5C14;&#x7C7B;&#x578B;&#x7684;Value&#x72B6;&#x6001;&#x6765;&#x4F5C;&#x4E3A;&#x6807;&#x8BC6;&#x4F4D;&#xFF0C;&#x8868;&#x660E;pay&#x4E8B;&#x4EF6;&#x662F;&#x5426;&#x53D1;&#x751F;&#x8FC7;&#x3002;&#x5982;&#x679C;pay&#x4E8B;&#x4EF6;&#x5DF2;&#x7ECF;&#x53D1;&#x751F;&#xFF0C;&#x72B6;&#x6001;&#x88AB;&#x7F6E;&#x4E3A;true&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x4E0D;&#x518D;&#x9700;&#x8981;&#x505A;&#x4EC0;&#x4E48;&#x64CD;&#x4F5C;&#xFF1B;&#x800C;&#x5982;&#x679C;pay&#x4E8B;&#x4EF6;&#x4E00;&#x76F4;&#x6CA1;&#x6765;&#xFF0C;&#x72B6;&#x6001;&#x4E00;&#x76F4;&#x4E3A;false&#xFF0C;&#x5230;&#x5B9A;&#x65F6;&#x5668;&#x89E6;&#x53D1;&#x65F6;&#xFF0C;&#x5C31;&#x5E94;&#x8BE5;&#x8F93;&#x51FA;&#x8D85;&#x65F6;&#x62A5;&#x8B66;&#x4FE1;&#x606F;&#x3002;</p>
<p>&#x5177;&#x4F53;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><em>OrderTimeoutDetect/src/main/scala/OrderTimeoutWithoutCep.scala</em></p>
<p><img src="https://uploader.shimo.im/f/rSWwfBr4Y9KSnvDt.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p><strong>object</strong>OrderTimeoutWithoutCep {</p>
<p><strong>def</strong>main(args: Array[String]): Unit = {</p>
<p><strong>val</strong>env = StreamExecutionEnvironment.<em>getExecutionEnvironment<em>**</em></em>env.setStreamTimeCharacteristic(TimeCharacteristic.<em>EventTime</em>) env.setParallelism(1)</p>
<p><strong>val</strong>orderEventStream = env.readTextFile(<strong>&quot;YOUR_PATH\resources**</strong>\<strong>**OrderLog.csv&quot;</strong>)</p>
<p>.map( data =&gt; {</p>
<p>val dataArray = data.split(<strong>&quot;,&quot;</strong>)</p>
<p><em>OrderEvent</em>(dataArray(0).toLong, dataArray(1), dataArray(3).toLong)</p>
<p>})</p>
<p>.assignAscendingTimestamps(_.eventTime *1000)</p>
<p>.keyBy(_.orderId)</p>
<ul>
<li><em>&#x81EA;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;<strong>process function</strong>&#xFF0C;&#x8FDB;&#x884C;<strong>order</strong>&#x7684;&#x8D85;&#x65F6;&#x68C0;&#x6D4B;&#xFF0C;&#x8F93;&#x51FA;&#x8D85;&#x65F6;&#x62A5;&#x8B66;&#x4FE1;&#x606F;</em></li>
</ul>
<p><strong>val</strong>timeoutWarningStream = orderEventStream</p>
<p>.process(<strong>new</strong>OrderTimeoutAlert)</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/TeKu0c62H5dTlSEU.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><img src="https://uploader.shimo.im/f/ZtwqSGdHnytpCEWg.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><img src="https://uploader.shimo.im/f/CPrxPYUM3vneUs0k.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p>timeoutWarningStream.print()</p>
<p>env.execute()</p>
<p>}</p>
<p><strong>class</strong>OrderTimeoutAlert<strong>extends</strong>KeyedProcessFunction[Long, OrderEvent, OrderResult]</p>
<p>{</p>
<p><strong>lazy val*</strong>isPayedState<em>: ValueState[Boolean] = getRuntimeContext.getState(<em>*new</em></em></p>
<p>ValueStateDescriptor<a href="**%22ispayed-state%22**,*classOf*[Boolean]">Boolean</a>)</p>
<p><strong>override def</strong>processElement(value: OrderEvent, ctx: KeyedProcessFunction[Long,</p>
<p>OrderEvent, OrderResult]#Context, out: Collector[OrderResult]): Unit = {</p>
<p><strong>val</strong>isPayed =<strong>*</strong>isPayedState*.value()</p>
<p><strong>if</strong>(value.eventType ==<strong>**</strong>&quot;create&quot;<strong>**</strong>&amp;&amp; !isPayed) {</p>
<p>ctx.timerService().registerEventTimeTimer(value.eventTime <em>1000L+15</em>60*</p>
<p>1000L)</p>
<p>}<strong>else if</strong>(value.eventType ==<strong>&quot;pay&quot;</strong>) {<em>isPayedState</em>.update(<strong>true</strong>)</p>
<p>}</p>
<p>}</p>
<p><strong>override def</strong>onTimer(timestamp: Long, ctx: KeyedProcessFunction[Long, OrderEvent,</p>
<p>OrderResult]#OnTimerContext, out: Collector[OrderResult]): Unit = {</p>
<p><strong>val</strong>isPayed =<strong>*</strong>isPayedState*.value()</p>
<p><strong>if</strong>(!isPayed) {</p>
<p>out.collect(<em>OrderResult</em>(ctx.getCurrentKey,<strong>&quot;order timeout&quot;</strong>))</p>
<p>}</p>
<p><em>isPayedState</em>.clear()</p>
<p>}</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/QVXkR9HYxz4r8oG3.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><img src="https://uploader.shimo.im/f/O98qd50CqNv6GPWK.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p>}</p>
<p>}</p>
<p>6.3&#x6765;&#x81EA;&#x4E24;&#x6761;&#x6D41;&#x7684;&#x8BA2;&#x5355;&#x4EA4;&#x6613;&#x5339;&#x914D;</p>
<p>&#x5BF9;&#x4E8E;&#x8BA2;&#x5355;&#x652F;&#x4ED8;&#x4E8B;&#x4EF6;&#xFF0C;&#x7528;&#x6237;&#x652F;&#x4ED8;&#x5B8C;&#x6210;&#x5176;&#x5B9E;&#x5E76;&#x4E0D;&#x7B97;&#x5B8C;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x5F97;&#x786E;&#x8BA4;&#x5E73;&#x53F0;&#x8D26;&#x6237;&#x4E0A;&#x662F;&#x5426;&#x5230;&#x8D26;&#x4E86;&#x3002;&#x800C;&#x5F80;&#x5F80;&#x8FD9;&#x4F1A;&#x6765;&#x81EA;&#x4E0D;&#x540C;&#x7684;&#x65E5;&#x5FD7;&#x4FE1;&#x606F;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x8981;&#x540C;&#x65F6;&#x8BFB;&#x5165;&#x4E24;&#x6761;&#x6D41;&#x7684;&#x6570;&#x636E;&#x6765;&#x505A;&#x5408;&#x5E76;&#x5904;&#x7406;&#x3002;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x5229;&#x7528;connect&#x5C06;&#x4E24;&#x6761;&#x6D41;&#x8FDB;&#x884C;&#x8FDE;&#x63A5;&#xFF0C;&#x7136;&#x540E;&#x7528;&#x81EA;&#x5B9A;&#x4E49;&#x7684;CoProcessFunction&#x8FDB;&#x884C;&#x5904;&#x7406;&#x3002;</p>
<p>&#x5177;&#x4F53;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><em>TxMatchDetect/src/main/scala/TxMatch</em></p>
<p><img src="https://uploader.shimo.im/f/bDnUR9HCZquRc7Ar.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p><strong>case class</strong>OrderEvent( orderId: Long, eventType:<strong><strong>String, txId:</strong></strong>String, eventTime: Long )</p>
<p><strong>case class</strong>ReceiptEvent( txId:<strong><strong>String, payChannel:</strong></strong>String, eventTime: Long )</p>
<p><strong>object</strong>TxMatch {</p>
<p><strong>val*</strong>unmatchedPays<strong>*</strong>=<strong>new</strong>OutputTag<a href="**%22unmatchedPays%22**">OrderEvent</a></p>
<p><strong>val*</strong>unmatchedReceipts<strong>*</strong>=<strong>new</strong>OutputTag<a href="**%22unmatchedReceipts%22**">ReceiptEvent</a></p>
<p><strong>def</strong>main(args: Array[String]): Unit = {</p>
<p><strong>val</strong>env = StreamExecutionEnvironment.<em>getExecutionEnvironment</em></p>
<p>env.setParallelism(1)</p>
<p>env.setStreamTimeCharacteristic(TimeCharacteristic.<em>EventTime</em>)</p>
<p><strong>val</strong>orderEventStream = env.readTextFile(<strong>&quot;YOUR_PATH\resources**</strong>\<strong>**OrderLog.csv&quot;</strong>)</p>
<p>.map( data =&gt; {</p>
<p>val dataArray = data.split(<strong>&quot;,&quot;</strong>)</p>
<p><em>OrderEvent</em>(dataArray(0).toLong, dataArray(1), dataArray(2),</p>
<p>dataArray(3).toLong)</p>
<p>})</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/Q9gYLljafDqO9zND.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><img src="https://uploader.shimo.im/f/aUOKw9Ff2Gkn9sZD.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p>.filter(_.txId !=<strong>&quot;&quot;</strong>)</p>
<p>.assignAscendingTimestamps(_.eventTime *1000L)</p>
<p>.keyBy(_.txId)</p>
<p><strong>val</strong>receiptEventStream = env.readTextFile(<strong>&quot;YOUR_PATH\resources**</strong>\<strong>**ReceiptLog.csv&quot;</strong>)</p>
<p>.map( data =&gt; {</p>
<p>val dataArray = data.split(<strong>&quot;,&quot;</strong>)</p>
<p><em>ReceiptEvent</em>(dataArray(0), dataArray(1), dataArray(2).toLong)</p>
<p>})</p>
<p>.assignAscendingTimestamps(_.eventTime *1000L)</p>
<p>.keyBy(_.txId)</p>
<p><strong>val</strong>processedStream = orderEventStream</p>
<p>.connect(receiptEventStream)</p>
<p>.process(<strong>new</strong>TxMatchDetection)</p>
<p>processedStream.getSideOutput(<em>unmatchedPays</em>).print(<strong>&quot;unmatched pays&quot;</strong>)</p>
<p>processedStream.getSideOutput(<em>unmatchedReceipts</em>).print(<strong>&quot;unmatched receipts&quot;</strong>)</p>
<p>processedStream.print(<strong>&quot;processed&quot;</strong>)</p>
<p>env.execute()</p>
<p>}</p>
<p><strong>class</strong>TxMatchDetection<strong>extends</strong>CoProcessFunction[OrderEvent, ReceiptEvent,<em>**</em>(OrderEvent, ReceiptEvent)]{</p>
<p><strong>lazy val*</strong>payState<em>: ValueState[OrderEvent] = getRuntimeContext.getState(<em>*new</em></em></p>
<p>ValueStateDescriptor<a href="**%22pay-state%22**,*classOf*[OrderEvent]">OrderEvent</a> )</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/QdBumF41aJRjUtJI.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><img src="https://uploader.shimo.im/f/b2EDECbyo9OLukO6.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><img src="https://uploader.shimo.im/f/9blvTyZE7G57qzMS.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p><strong>lazy val*</strong>receiptState<em>: ValueState[ReceiptEvent] = getRuntimeContext.getState(<strong>new</strong>ValueStateDescriptor[ReceiptEvent](<strong>&quot;receipt-state&quot;</strong>,</em>classOf*[ReceiptEvent]) )</p>
<p><strong>override def</strong>processElement1(pay: OrderEvent, ctx: CoProcessFunction[OrderEvent,</p>
<p>ReceiptEvent, (OrderEvent, ReceiptEvent)]#Context, out: Collector[(OrderEvent,</p>
<p>ReceiptEvent)]): Unit = {</p>
<p><strong>val</strong>receipt =<strong>*</strong>receiptState*.value()</p>
<p><strong>if</strong>( receipt !=<strong>null</strong>){</p>
<p><em>receiptState</em>.clear()</p>
<p>out.collect((pay, receipt))</p>
<p>}<strong>else</strong>{</p>
<p><em>payState</em>.update(pay)</p>
<p>ctx.timerService().registerEventTimeTimer(pay.eventTime *1000L)</p>
<p>}</p>
<p>}</p>
<p><strong>override def</strong>processElement2(receipt: ReceiptEvent, ctx:<em>**</em>CoProcessFunction[OrderEvent, ReceiptEvent, (OrderEvent, ReceiptEvent)]#Context, out: Collector[(OrderEvent, ReceiptEvent)]): Unit = {</p>
<p><strong>val</strong>payment =<strong>*</strong>payState*.value()</p>
<p><strong>if</strong>( payment !=<strong>null</strong>){</p>
<p><em>payState</em>.clear()</p>
<p>out.collect((payment, receipt))</p>
<p>}<strong>else</strong>{<em>receiptState</em>.update(receipt)</p>
<p>ctx.timerService().registerEventTimeTimer(receipt.eventTime *1000L)</p>
<p>}</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/LTyO30gDw2qrEipG.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><img src="https://uploader.shimo.im/f/9pvWdRCAL4DeTWCd.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p>}</p>
<p><strong>override def</strong>onTimer(timestamp: Long, ctx: CoProcessFunction[OrderEvent,</p>
<p>ReceiptEvent, (OrderEvent, ReceiptEvent)]#OnTimerContext, out: Collector[(OrderEvent,</p>
<p>ReceiptEvent)]): Unit = {</p>
<p><strong>if</strong>(<strong>*</strong>payState<em>.value() !=<em>*null</em></em>){</p>
<p>ctx.output(<em>unmatchedPays</em>,<em>payState</em>.value())</p>
<p>}</p>
<p><strong>if</strong>(<strong>*</strong>receiptState<em>.value() !=<em>*null</em></em>){</p>
<p>ctx.output(<em>unmatchedReceipts</em>,<em>receiptState</em>.value())</p>
<p>}</p>
<p><em>payState</em>.clear()</p>
<p><em>receiptState</em>.clear()</p>
<p>}</p>
<p>}</p>
<p>}</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/TM6syG41bMMRpPg9.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p>&#x9644;&#x5F55; &#x7535;&#x5546;&#x5E38;&#x89C1;&#x6307;&#x6807;&#x6C47;&#x603B;</p>
<ol>
<li>&#x7535;&#x5546;&#x6307;&#x6807;&#x6574;&#x7406;</li>
</ol>
<p><img src="https://uploader.shimo.im/f/YJZoQknkHvJMptgl.png!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/Gs6Qvsh8IjtDbsOR.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><img src="https://uploader.shimo.im/f/djOcKw9MgGfISSUI.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p>&#x73B0;&#x5728;&#x7684;&#x7535;&#x5B50;&#x5546;&#x52A1;&#xFF1A;</p>
<p>1&#x3001;&#x5927;&#x591A;&#x4E70;&#x5BB6;&#x901A;&#x8FC7;&#x641C;&#x7D22;&#x627E;&#x5230;&#x6240;&#x4E70;&#x7269;&#x54C1;&#xFF0C;&#x800C;&#x975E;&#x7535;&#x5546;&#x7F51;&#x7AD9;&#x7684;&#x5185;&#x90E8;&#x5BFC;&#x822A;&#xFF0C;&#x641C;&#x7D22;&#x5173;&#x952E;&#x5B57;&#x66F4;&#x4E3A;&#x91CD;&#x8981;&#xFF1B;</p>
<p>2&#x3001;&#x7535;&#x5546;&#x5546;&#x5BB6;&#x901A;&#x8FC7;&#x63A8;&#x8350;&#x5F15;&#x64CE;&#x6765;&#x9884;&#x6D4B;&#x4E70;&#x5BB6;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x7684;&#x5546;&#x54C1;&#x3002;&#x63A8;&#x8350;&#x5F15;&#x64CE;&#x4EE5;&#x5386;&#x53F2;&#x4E0A;&#x5177;&#x6709;&#x7C7B;&#x4F3C;&#x8D2D;</p>
<p>&#x4E70;&#x8BB0;&#x5F55;&#x7684;&#x4E70;&#x5BB6;&#x6570;&#x636E;&#x4EE5;&#x53CA;&#x7528;&#x6237;&#x81EA;&#x8EAB;&#x7684;&#x8D2D;&#x4E70;&#x8BB0;&#x5F55;&#x4E3A;&#x57FA;&#x7840;&#xFF0C;&#x5411;&#x7528;&#x6237;&#x63D0;&#x4F9B;&#x63A8;&#x8350;&#x4FE1;&#x606F;&#xFF1B;</p>
<p>3&#x3001;&#x7535;&#x5546;&#x5546;&#x5BB6;&#x65F6;&#x523B;&#x4F18;&#x5316;&#x7F51;&#x7AD9;&#x6027;&#x80FD;&#xFF0C;&#x5982; A/B Test &#x5212;&#x5206;&#x6765;&#x8BBF;&#x6D41;&#x91CF;&#xFF0C;&#x5E76;&#x533A;&#x522B;&#x5BF9;&#x5F85;&#x6765;&#x6E90;&#x4E0D;&#x540C;&#x7684;&#x8BBF;</p>
<p>&#x5BA2;&#xFF0C;&#x8FDB;&#x800C;&#x627E;&#x5230;&#x6700;&#x4F18;&#x7684;&#x4EA7;&#x54C1;&#x3001;&#x5185;&#x5BB9;&#x548C;&#x4EF7;&#x683C;&#xFF1B;</p>
<p>4&#x3001;&#x8D2D;&#x4E70;&#x6D41;&#x7A0B;&#x65E9;&#x5728;&#x4E70;&#x5BB6;&#x8BBF;&#x95EE;&#x7F51;&#x7AD9;&#x524D;&#xFF0C;&#x5373;&#x5728;&#x793E;&#x4EA4;&#x7F51;&#x7EDC;&#x3001;&#x90AE;&#x4EF6;&#x4EE5;&#x53CA;&#x5728;&#x7EBF;&#x793E;&#x533A;&#x4E2D;&#x4FBF;&#x5DF2;&#x5F00;&#x59CB;&#xFF0C;&#x5373;</p>
<p>&#x957F;&#x6F0F;&#x6597;&#x6D41;&#x7A0B;&#xFF08;&#x4EE5;&#x4E00;&#x6761;&#x63A8;&#x6587;&#x3001;&#x4E00;&#x6BB5;&#x89C6;&#x9891;&#x6216;&#x4E00;&#x4E2A;&#x94FE;&#x63A5;&#x5F00;&#x59CB;&#xFF0C;&#x4EE5;&#x8D2D;&#x4E70;&#x4EA4;&#x6613;&#x7ED3;&#x675F;&#xFF09;&#x3002;</p>
<p>&#x76F8;&#x5173;&#x6570;&#x636E;&#x6307;&#x6807;&#xFF1A;&#x5173;&#x952E;&#x8BCD;&#x548C;&#x641C;&#x7D22;&#x8BCD;&#x3001;&#x63A8;&#x8350;&#x63A5;&#x53D7;&#x7387;&#x3001;&#x90AE;&#x4EF6;&#x5217;&#x8868;/&#x77ED;&#x4FE1;&#x94FE;&#x63A5;&#x70B9;&#x5165;&#x7387;</p>
<ol>
<li>&#x7535;&#x5546;8&#x7C7B;&#x57FA;&#x672C;&#x6307;&#x6807;</li>
</ol>
<p>1&#xFF09;&#x603B;&#x4F53;&#x8FD0;&#x8425;&#x6307;&#x6807;&#xFF1A;&#x4ECE;&#x6D41;&#x91CF;&#x3001;&#x8BA2;&#x5355;&#x3001;&#x603B;&#x4F53;&#x9500;&#x552E;&#x4E1A;&#x7EE9;&#x3001;&#x6574;&#x4F53;&#x6307;&#x6807;&#x8FDB;&#x884C;&#x628A;&#x63A7;&#xFF0C;&#x8D77;&#x7801;&#x5BF9;&#x8FD0;&#x8425;&#x7684;</p>
<p>&#x7535;&#x5546;&#x5E73;&#x53F0;&#x6709;&#x4E2A;&#x5927;&#x81F4;&#x4E86;&#x89E3;&#xFF0C;&#x5230;&#x5E95;&#x8FD0;&#x8425;&#x7684;&#x600E;&#x4E48;&#x6837;&#xFF0C;&#x662F;&#x4E8F;&#x662F;&#x8D5A;&#x3002;</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/3KN7cDYTHJHsEapj.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><img src="https://uploader.shimo.im/f/ndSdsXMlDzljZIsQ.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p>2&#xFF09;&#x7AD9;&#x6D41;&#x91CF;&#x6307;&#x6807;&#xFF1A;&#x5373;&#x5BF9;&#x8BBF;&#x95EE;&#x4F60;&#x7F51;&#x7AD9;&#x7684;&#x8BBF;&#x5BA2;&#x8FDB;&#x884C;&#x5206;&#x6790;&#xFF0C;&#x57FA;&#x4E8E;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#x53EF;&#x4EE5;&#x5BF9;&#x7F51;&#x9875;&#x8FDB;&#x884C;&#x6539;&#x8FDB;&#xFF0C;&#x4EE5;&#x53CA;&#x5BF9;&#x8BBF;&#x5BA2;&#x7684;&#x884C;&#x4E3A;&#x8FDB;&#x884C;&#x5206;&#x6790;&#x7B49;&#x7B49;&#x3002;</p>
<p><img src="https://uploader.shimo.im/f/WKVJk6t3GW4t687E.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p>3&#xFF09;&#x9500;&#x552E;&#x8F6C;&#x5316;&#x6307;&#x6807;&#xFF1A;&#x5206;&#x6790;&#x4ECE;&#x4E0B;&#x5355;&#x5230;&#x652F;&#x4ED8;&#x6574;&#x4E2A;&#x8FC7;&#x7A0B;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x5E2E;&#x52A9;&#x4F60;&#x63D0;&#x5347;&#x5546;&#x54C1;&#x8F6C;&#x5316;&#x7387;&#x3002;&#x4E5F;&#x53EF;&#x4EE5;&#x5BF9;&#x4E00;&#x4E9B;&#x9891;&#x7E41;&#x5F02;&#x5E38;&#x7684;&#x6570;&#x636E;&#x5C55;&#x5F00;&#x5206;&#x6790;&#x3002;</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/vvofCcNzZbumv5oC.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><img src="https://uploader.shimo.im/f/2EJLWSrif8SOWvQ6.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p>4&#xFF09;&#x5BA2;&#x6237;&#x4EF7;&#x503C;&#x6307;&#x6807;&#xFF1A;&#x8FD9;&#x91CC;&#x4E3B;&#x8981;&#x5C31;&#x662F;&#x5206;&#x6790;&#x5BA2;&#x6237;&#x7684;&#x4EF7;&#x503C;&#xFF0C;&#x53EF;&#x4EE5;&#x5EFA;&#x7ACB; RFM &#x4EF7;&#x503C;&#x6A21;&#x578B;&#xFF0C;&#x627E;&#x51FA;&#x90A3;&#x4E9B;</p>
<p>&#x6709;&#x4EF7;&#x503C;&#x7684;&#x5BA2;&#x6237;&#xFF0C;&#x7CBE;&#x51C6;&#x8425;&#x9500;&#x7B49;&#x7B49;&#x3002;</p>
<p><img src="https://uploader.shimo.im/f/41k1mHizuNdtE0LF.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/ZapnsoAlm1QKt5wQ.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p>5&#xFF09;&#x5546;&#x54C1;&#x7C7B;&#x6307;&#x6807;&#xFF1A;&#x4E3B;&#x8981;&#x5206;&#x6790;&#x5546;&#x54C1;&#x7684;&#x79CD;&#x7C7B;&#xFF0C;&#x90A3;&#x4E9B;&#x5546;&#x54C1;&#x5356;&#x5F97;&#x597D;&#xFF0C;&#x5E93;&#x5B58;&#x60C5;&#x51B5;&#xFF0C;&#x4EE5;&#x53CA;&#x53EF;&#x4EE5;&#x5EFA;&#x7ACB;&#x5173;</p>
<p>&#x8054;&#x6A21;&#x578B;&#xFF0C;&#x5206;&#x6790;&#x90A3;&#x4E9B;&#x5546;&#x54C1;&#x540C;&#x65F6;&#x9500;&#x552E;&#x7684;&#x51E0;&#x7387;&#x6BD4;&#x8F83;&#x9AD8;&#xFF0C;&#x800C;&#x8FDB;&#x884C;&#x6346;&#x7ED1;&#x9500;&#x552E;&#xFF0C;&#x6709;&#x70B9;&#x50CF;&#x5564;&#x9152;&#x548C;&#x5C3F;&#x5E03;&#x7684;&#x6545;&#x4E8B;&#x3002;</p>
<p><img src="https://uploader.shimo.im/f/PgOJUVEadjxbvFjv.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p>6&#xFF09;&#x5E02;&#x573A;&#x8425;&#x9500;&#x6D3B;&#x52A8;&#x6307;&#x6807;&#xFF0C;&#x4E3B;&#x8981;&#x76D1;&#x63A7;&#x67D0;&#x6B21;&#x6D3B;&#x52A8;&#x7ED9;&#x7535;&#x5546;&#x7F51;&#x7AD9;&#x5E26;&#x6765;&#x7684;&#x6548;&#x679C;&#xFF0C;&#x4EE5;&#x53CA;&#x76D1;&#x63A7;&#x5E7F;&#x544A;&#x7684;&#x6295;&#x653E;&#x6307;&#x6807;&#x3002;</p>
<p><img src="https://uploader.shimo.im/f/NrD3PPQykVgT1sxP.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p>7&#xFF09;&#x98CE;&#x63A7;&#x7C7B;&#x6307;&#x6807;&#xFF1A;&#x5206;&#x6790;&#x5356;&#x5BB6;&#x8BC4;&#x8BBA;&#xFF0C;&#x4EE5;&#x53CA;&#x6295;&#x8BC9;&#x60C5;&#x51B5;&#xFF0C;&#x53D1;&#x73B0;&#x95EE;&#x9898;&#xFF0C;&#x6539;&#x6B63;&#x95EE;&#x9898;</p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<p><img src="https://uploader.shimo.im/f/vRiCEfl9DJpy3SK7.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"><strong>&#x5C1A;&#x7845;&#x8C37;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x4E4B;&#x7535;&#x5546;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x5206;&#x6790;</strong></p>
<p><strong>&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;</strong></p>
<p><img src="https://uploader.shimo.im/f/KQbFjSEliASE5VkM.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p>8&#xFF09;&#x5E02;&#x573A;&#x7ADE;&#x4E89;&#x6307;&#x6807;&#xFF1A;&#x4E3B;&#x8981;&#x5206;&#x6790;&#x5E02;&#x573A;&#x4EFD;&#x989D;&#x4EE5;&#x53CA;&#x7F51;&#x7AD9;&#x6392;&#x540D;&#xFF0C;&#x8FDB;&#x4E00;&#x6B65;&#x8FDB;&#x884C;&#x8C03;&#x6574;</p>
<p><img src="https://uploader.shimo.im/f/5Ms2CbhrZJLEnJRO.jpeg!thumbnail?fileGuid=KS75NqqdepUj8f3V" alt="&#x56FE;&#x7247;"></p>
<p>&#x66F4;&#x591A;Java &#x2013;&#x5927;&#x6570;&#x636E;&#x2013;&#x524D;&#x7AEF;&#x2013;python&#x4EBA;&#x5DE5;&#x667A;&#x80FD;&#x8D44;&#x6599;&#x4E0B;&#x8F7D;&#xFF0C;&#x53EF;&#x767E;&#x5EA6;&#x8BBF;&#x95EE;&#xFF1A;&#x5C1A;&#x7845;&#x8C37;&#x5B98;&#x7F51;</p>
<footer class="page-footer"><span class="copyright">Copyright &#xA9; liufeihua.com 2021 all right reserved&#xFF0C;powered by Gitbook</span><span class="footer-modification">&#x8BE5;&#x6587;&#x4EF6;&#x4FEE;&#x8BA2;&#x65F6;&#x95F4;&#xFF1A;
2021-04-10 21:52:19
</span></footer>
<script>console.log("plugin-popup....");document.onclick = function(e){ e.target.tagName === "IMG" && window.open(e.target.src,e.target.src)}</script><style>img{cursor:pointer}</style>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="./" class="navigation navigation-prev navigation-unique" aria-label="Previous page: flink">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"1.电商用户行为数据分析","level":"1.5.1","depth":2,"previous":{"title":"flink","level":"1.5","depth":1,"path":"flink/README.md","ref":"flink/README.md","articles":[{"title":"1.电商用户行为数据分析","level":"1.5.1","depth":2,"path":"flink/电商用户行为数据分析.md","ref":"flink/电商用户行为数据分析.md","articles":[]}]},"dir":"ltr"},"config":{"plugins":["chapter-fold","theme-comscore","back-to-top-button","code","tbfed-pagefooter","page-treeview","pageview-count","popup","prism","-highlight","hide-element"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"tbfed-pagefooter":{"copyright":"Copyright &copy liufeihua.com 2021","modify_label":"该文件修订时间：","modify_format":"YYYY-MM-DD HH:mm:ss"},"page-treeview":{"collapsed":false,"copyright":"Copyright © aleen42","minHeaderCount":"1","minHeaderDeep":"1"},"chapter-fold":{},"prism":{"css":["prismjs/themes/prism-okaidia.css"]},"search":{},"popup":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"code":{"copyButtons":true},"hide-element":{"elements":[".gitbook-link"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-comscore":{},"back-to-top-button":{},"pageview-count":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","author":"liufeihua","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"日常笔记","language":"zh-hans","gitbook":"*","description":"日常笔记"},"file":{"path":"flink/电商用户行为数据分析.md","mtime":"2021-04-10T13:52:19.387Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2021-04-11T00:04:16.743Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-chapter-fold/chapter-fold.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-pageview-count/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-hide-element/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-theme-comscore/test.js"></script>
        
    

    </body>
</html>

